<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>unicorn_binance_websocket_api.manager &#8212; unicorn-binance-websocket-api 2.6.1 documentation</title><meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=92fd9be5" />
    <link rel="stylesheet" type="text/css" href="../../_static/pydoctheme.css?v=fdf8e9ae" />
    
    <script src="../../_static/documentation_options.js?v=6efca38a"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /><link rel="shortcut icon" type="image/png" href="../../_static/lucit.png" />
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    
    <script
        src='//eu.fw-cdn.com/10659511/361973.js'
        chat='true'>
    </script>
    
            <script type="text/javascript" src="../../_static/copybutton.js"></script>
            <script type="text/javascript" src="../../_static/menu.js"></script> 
  </head>
<body>
<div class="mobile-nav">
    <input type="checkbox" id="menuToggler" class="toggler__input" aria-controls="navigation"
           aria-pressed="false" aria-expanded="false" role="button" aria-label="Menu" />
    <label for="menuToggler" class="toggler__label">
        <span></span>
    </label>
    <nav class="nav-content" role="navigation">
        <form role="search" class="search" action="../../search.html" method="get">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" class="search-icon">
                <path fill-rule="nonzero"
                        d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 001.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 00-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 005.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" fill="#444"></path>
            </svg>
            <input type="text" name="q" aria-label="Quick search"/>
            <input type="submit" value="Go"/>
        </form>
    </nav>
    <div class="menu-wrapper">
        <nav class="menu" role="navigation" aria-label="main navigation">
            <p class="logo">
                <div style="text-align: center;">
                    <a href="https://www.lucit.tech"><img src="https://www.lucit.tech/files/images/logos/LUCIT-LOGO.png"></a><br>
                    <a href="https://shop.lucit.services/software/unicorn-binance-suite" style="font-size: 0.85em;font-weight: 900">Get a UNICORN Binance Suite License!</a><br>
                    <br>
                    <a href="https://github.com/LUCIT-Systems-and-Development" target="_blank" style="text-decoration:none;"><img src="../../_static/icons8-github-20.png"></a>
                    <a href="https://fb.me/lucit.systems.and.development" target="_blank" style="text-decoration:none;"><img src="../../_static/icons8-facebook-20.png"></a>
                    <a href="https://twitter.com/LUCIT_SysDev" target="_blank" style="text-decoration:none;"><img src="../../_static/icons8-twitter-20.png"></a>
                    <a href="https://www.linkedin.com/company/lucit-systems-and-development" target="_blank" style="text-decoration:none;"><img src="../../_static/icons8-linkedin-20.png"></a>
                    <a href="https://www.xing.com/pages/lucit-systems-and-development" target="_blank" style="text-decoration:none;"><img src="../../_static/icons8-xing-20.png"></a>
                    <a href="https://medium.lucit.tech" target="_blank" style="text-decoration:none;"><img src="../../_static/icons8-medium-monogram-20.png"></a>
                    <a href="https://www.youtube.com/channel/UCp57u8vaPqEWQTlfpYn-KnQ" target="_blank" style="text-decoration:none;"><img src="../../_static/icons8-youtube-20.png"></a>
                </div>
            </p>
<div id="searchbox" style="display: block" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<div role="note" aria-label="source code">
    <h3>GitHub</h3>
    <ul class="this-page-menu">
      <li><a href="https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api">Show Source</a></li>
      
<li>
<a class="github-button" href="https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api"
   data-icon="octicon-star" data-show-count="true"
   aria-label="Star LUCIT-Systems-and-Development/unicorn-binance-websocket-api on GitHub">Star</a>
<br />
<a class="github-button" href="https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api/subscription"
   data-icon="octicon-eye" data-show-count="true"
   aria-label="Watch LUCIT-Systems-and-Development/unicorn-binance-websocket-api on GitHub">Watch</a>
<br />
<a class="github-button" href="https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api/fork"
   data-icon="octicon-repo-forked" data-show-count="true"
   aria-label="Fork LUCIT-Systems-and-Development/unicorn-binance-websocket-api on GitHub">Fork</a>
<br />
<a class="github-button" href="https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api/issues"
   data-icon="octicon-issue-opened"
   data-show-count="true" aria-label="Issue LUCIT-Systems-and-Development/unicorn-binance-websocket-api on GitHub">Issue</a>
    
</li>

    </ul>
</div>
        </nav>
    </div>
</div>
  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
              
                  
                  
              <li><img src="../../_static/lucit.png" alt="LUCIT Logo"
                       style="vertical-align: middle; margin-top: -1px"/></li>
              <li><a href="https://docs.lucit.tech">Docs Index</a> | </li>
              <li><a href="https://www.lucit.tech/unicorn-binance-websocket-api.html">unicorn-binance-websocket-api</a> &#187;</li>
                  
              
              
              <a href="../../index.html">Docs</a> &#187;
              
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">unicorn_binance_websocket_api.manager</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../../search.html" method="get">
          <input placeholder="Quick search" aria-label="Quick search" type="text" name="q" />
          <input type="submit" value="Go" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
                     |
                </li>
            
      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for unicorn_binance_websocket_api.manager</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">#</span>
<span class="c1"># File: unicorn_binance_websocket_api/manager.py</span>
<span class="c1">#</span>
<span class="c1"># Part of ‘UNICORN Binance WebSocket API’</span>
<span class="c1"># Project website: https://www.lucit.tech/unicorn-binance-websocket-api.html</span>
<span class="c1"># Github: https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api</span>
<span class="c1"># Documentation: https://unicorn-binance-websocket-api.docs.lucit.tech</span>
<span class="c1"># PyPI: https://pypi.org/project/unicorn-binance-websocket-api</span>
<span class="c1"># LUCIT Online Shop: https://shop.lucit.services/software</span>
<span class="c1">#</span>
<span class="c1"># License: LSOSL - LUCIT Synergetic Open Source License</span>
<span class="c1"># https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api/blob/master/LICENSE</span>
<span class="c1">#</span>
<span class="c1"># Author: LUCIT Systems and Development</span>
<span class="c1">#</span>
<span class="c1"># Copyright (c) 2019-2024, LUCIT Systems and Development (https://www.lucit.tech)</span>
<span class="c1"># All rights reserved.</span>

<span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">colorama</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">cython</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">psutil</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">import</span> <span class="nn">ujson</span> <span class="k">as</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">websockets</span>
<span class="kn">from</span> <span class="nn">.licensing_manager</span> <span class="kn">import</span> <span class="n">LucitLicensingManager</span><span class="p">,</span> <span class="n">NoValidatedLucitLicense</span>
<span class="kn">from</span> <span class="nn">unicorn_binance_rest_api</span> <span class="kn">import</span> <span class="n">BinanceRestApiManager</span><span class="p">,</span> <span class="n">BinanceAPIException</span>
<span class="kn">from</span> <span class="nn">.connection_settings</span> <span class="kn">import</span> <span class="n">CEX_EXCHANGES</span><span class="p">,</span> <span class="n">DEX_EXCHANGES</span><span class="p">,</span> <span class="n">CONNECTION_SETTINGS</span>
<span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.restclient</span> <span class="kn">import</span> <span class="n">BinanceWebSocketApiRestclient</span>
<span class="kn">from</span> <span class="nn">.restserver</span> <span class="kn">import</span> <span class="n">BinanceWebSocketApiRestServer</span>
<span class="kn">from</span> <span class="nn">.sockets</span> <span class="kn">import</span> <span class="n">BinanceWebSocketApiSocket</span>
<span class="kn">from</span> <span class="nn">.api</span> <span class="kn">import</span> <span class="n">BinanceWebSocketApiApi</span>
<span class="kn">from</span> <span class="nn">cheroot</span> <span class="kn">import</span> <span class="n">wsgi</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">flask_restful</span> <span class="kn">import</span> <span class="n">Api</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Callable</span>
<span class="k">try</span><span class="p">:</span>
    <span class="c1"># python &lt;=3.7 support</span>
    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Literal</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Literal</span>

<span class="n">__app_name__</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;unicorn-binance-websocket-api&quot;</span>
<span class="n">__version__</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;2.6.1.dev&quot;</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;unicorn_binance_websocket_api&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="BinanceWebSocketApiManager">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager">[docs]</a>
<span class="k">class</span> <span class="nc">BinanceWebSocketApiManager</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An unofficial Python API to use the Binance Websocket API`s (com+testnet, com-margin+testnet,</span>
<span class="sd">    com-isolated_margin+testnet, com-futures+testnet, us, dex/chain+testnet) in an easy, fast, flexible,</span>
<span class="sd">    robust and fully-featured way.</span>
<span class="sd">K</span>
<span class="sd">    This library supports two different kind of websocket endpoints:</span>

<span class="sd">        - CEX (Centralized exchange): binance.com, binance.vision, binance.je, binance.us, trbinance.com</span>

<span class="sd">        - DEX (Decentralized exchange): binance.org</span>

<span class="sd">    Binance.com websocket API documentation:</span>

<span class="sd">        - https://github.com/binance/binance-spot-api-docs/blob/master/web-socket-streams.md</span>

<span class="sd">        - https://binance-docs.github.io/apidocs/futures/en/#user-data-streams</span>

<span class="sd">        - https://binance-docs.github.io/apidocs/spot/en/#user-data-streams</span>

<span class="sd">    Binance.vision (Testnet) websocket API documentation:</span>

<span class="sd">        - https://testnet.binance.vision/</span>

<span class="sd">    Binance.us websocket API documentation:</span>

<span class="sd">        - https://docs.binance.us/#introduction</span>

<span class="sd">    TRBinance.com websocket API documentation:</span>

<span class="sd">        - https://www.trbinance.com/apidocs/#general-wss-information</span>

<span class="sd">    Binance.org websocket API documentation:</span>

<span class="sd">        - https://docs.binance.org/api-reference/dex-api/ws-connection.html</span>

<span class="sd">    :param process_asyncio_queue: Insert your Asyncio function into the same AsyncIO loop in which the websocket data</span>
<span class="sd">                                  is received. This method guarantees the fastest possible asynchronous processing of</span>
<span class="sd">                                  the data in the correct receiving sequence.</span>
<span class="sd">                                  https://unicorn-binance-websocket-api.docs.lucit.tech/readme.html#or-await-the-webstream-data-in-an-asyncio-coroutine</span>
<span class="sd">    :type process_asyncio_queue: Optional[Callable]</span>
<span class="sd">    :param process_stream_data: Provide a function/method to process the received webstream data (callback). The function</span>
<span class="sd">                                will be called instead of</span>
<span class="sd">                                `add_to_stream_buffer() &lt;unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.add_to_stream_buffer&gt;`_</span>
<span class="sd">                                like `process_stream_data(stream_data, stream_buffer_name)` where</span>
<span class="sd">                                `stream_data` contains the raw_stream_data. If not provided, the raw stream_data will</span>
<span class="sd">                                get stored in the stream_buffer or provided to a specific callback function of</span>
<span class="sd">                                `create_stream()`! `How to read from stream_buffer!</span>
<span class="sd">                                &lt;https://unicorn-binance-websocket-api.docs.lucit.tech/README.html#and-4-more-lines-to-print-the-receives&gt;`_</span>
<span class="sd">    :type process_stream_data: Optional[Callable]</span>
<span class="sd">    :param process_stream_data_async: Provide an asyncio function/method to process the received webstream data (callback). The function</span>
<span class="sd">                                will be called instead of</span>
<span class="sd">                                `add_to_stream_buffer() &lt;unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.add_to_stream_buffer&gt;`_</span>
<span class="sd">                                like `process_stream_data(stream_data, stream_buffer_name)` where</span>
<span class="sd">                                `stream_data` contains the raw_stream_data. If not provided, the raw stream_data will</span>
<span class="sd">                                get stored in the stream_buffer or provided to a specific callback function of</span>
<span class="sd">                                `create_stream()`! `How to read from stream_buffer!</span>
<span class="sd">                                &lt;https://unicorn-binance-websocket-api.docs.lucit.tech/README.html#and-4-more-lines-to-print-the-receives&gt;`_</span>
<span class="sd">    :type process_stream_data_async: Optional[Callable]</span>
<span class="sd">    :param exchange: Select binance.com, binance.com-testnet, binance.com-margin, binance.com-margin-testnet,</span>
<span class="sd">                     binance.com-isolated_margin, binance.com-isolated_margin-testnet, binance.com-futures,</span>
<span class="sd">                     binance.com-futures-testnet, binance.com-coin_futures, binance.us, trbinance.com,</span>
<span class="sd">                     binance.org, binance.org-testnet (default: binance.com)</span>
<span class="sd">    :type exchange: str</span>
<span class="sd">    :param warn_on_update: set to `False` to disable the update warning of UBWA and also in UBRA used as submodule.</span>
<span class="sd">    :type warn_on_update: bool</span>
<span class="sd">    :param restart_timeout: A stream restart must be successful within this time, otherwise a new restart will be</span>
<span class="sd">                            initialized. Default is 6 seconds.</span>
<span class="sd">    :type restart_timeout: int</span>
<span class="sd">    :param show_secrets_in_logs: set to True to show secrets like listen_key, api_key or api_secret in log file</span>
<span class="sd">                                 (default=False)</span>
<span class="sd">    :type show_secrets_in_logs: bool</span>
<span class="sd">    :param output_default: set to &quot;dict&quot; to convert the received raw data to a python dict, set to &quot;UnicornFy&quot; to</span>
<span class="sd">                           convert with `UnicornFy &lt;https://github.com/LUCIT-Systems-and-Development/unicorn-fy&gt;`_ -  otherwise</span>
<span class="sd">                           with the default setting &quot;raw_data&quot; the output remains unchanged and gets delivered as</span>
<span class="sd">                           received from the endpoints. Change this for a specific stream with the `output` parameter</span>
<span class="sd">                           of `create_stream()` and `replace_stream()`</span>
<span class="sd">    :type output_default: str</span>
<span class="sd">    :param enable_stream_signal_buffer: set to True to enable the</span>
<span class="sd">                                        `stream_signal_buffer &lt;https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api/wiki/%60stream_signal_buffer%60&gt;`_</span>
<span class="sd">                                        and receive information about</span>
<span class="sd">                                        disconnects and reconnects to manage a restore of the lost data during the</span>
<span class="sd">                                        interruption or to recognize your bot got blind.</span>
<span class="sd">    :type enable_stream_signal_buffer: bool</span>
<span class="sd">    :param disable_colorama: set to True to disable the use of `colorama &lt;https://pypi.org/project/colorama/&gt;`_</span>
<span class="sd">    :type disable_colorama: bool</span>
<span class="sd">    :param stream_buffer_maxlen: Set a max len for the generic `stream_buffer`. This parameter can also be used within</span>
<span class="sd">                                 `create_stream()` for a specific `stream_buffer`.</span>
<span class="sd">    :type stream_buffer_maxlen: int or None</span>
<span class="sd">    :param process_stream_signals: Provide a function/method to process the received stream signals. The function is running inside an asyncio loop and will be</span>
<span class="sd">                                   called instead of</span>
<span class="sd">                                   `add_to_stream_signal_buffer() &lt;unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.add_to_stream_signal_buffer&gt;`_</span>
<span class="sd">                                   like `process_stream_data(signal_type=False, stream_id=False, data_record=False)`.</span>
<span class="sd">    :type process_stream_signals: function</span>
<span class="sd">    :param auto_data_cleanup_stopped_streams: The parameter &quot;auto_data_cleanup_stopped_streams=True&quot; can be used to</span>
<span class="sd">                                              inform the UBWA instance that all remaining data of a stopped stream</span>
<span class="sd">                                              should be automatically and completely deleted.</span>
<span class="sd">    :type auto_data_cleanup_stopped_streams: bool</span>
<span class="sd">    :param close_timeout_default: The `close_timeout` parameter defines a maximum wait time in seconds for</span>
<span class="sd">                                completing the closing handshake and terminating the TCP connection.</span>
<span class="sd">                                This parameter is passed through to the `websockets.client.connect()</span>
<span class="sd">                                &lt;https://websockets.readthedocs.io/en/stable/topics/design.html?highlight=close_timeout#closing-handshake&gt;`_</span>
<span class="sd">    :type close_timeout_default: int</span>
<span class="sd">    :param ping_interval_default: Once the connection is open, a `Ping frame` is sent every</span>
<span class="sd">                                `ping_interval` seconds. This serves as a keepalive. It helps keeping</span>
<span class="sd">                                the connection open, especially in the presence of proxies with short</span>
<span class="sd">                                timeouts on inactive connections. Set `ping_interval` to `None` to</span>
<span class="sd">                                disable this behavior.</span>
<span class="sd">                                This parameter is passed through to the `websockets.client.connect()</span>
<span class="sd">                                &lt;https://websockets.readthedocs.io/en/stable/topics/timeouts.html?highlight=ping_interval#keepalive-in-websock ets&gt;`_</span>
<span class="sd">    :type ping_interval_default: int</span>
<span class="sd">    :param ping_timeout_default: If the corresponding `Pong frame` isn&#39;t received within</span>
<span class="sd">                               `ping_timeout` seconds, the connection is considered unusable and is closed with</span>
<span class="sd">                               code 1011. This ensures that the remote endpoint remains responsive. Set</span>
<span class="sd">                               `ping_timeout` to `None` to disable this behavior.</span>
<span class="sd">                               This parameter is passed through to the `websockets.client.connect()</span>
<span class="sd">                               &lt;https://websockets.readthedocs.io/en/stable/topics/timeouts.html?highlight=ping_timeout#keepalive-in-websockets&gt;`_</span>
<span class="sd">    :type ping_timeout_default: int</span>
<span class="sd">    :param high_performance: Set to True makes `create_stream()` a non-blocking function</span>
<span class="sd">    :type high_performance:  bool</span>
<span class="sd">    :param debug: If True the lib adds additional information to logging outputs</span>
<span class="sd">    :type debug:  bool</span>
<span class="sd">    :param restful_base_uri: Override `restful_base_uri`. Example: `https://127.0.0.1`</span>
<span class="sd">    :type restful_base_uri:  str</span>
<span class="sd">    :param websocket_base_uri: Override `websocket_base_uri`. Example: `ws://127.0.0.1:8765/`</span>
<span class="sd">    :type websocket_base_uri:  str</span>
<span class="sd">    :param websocket_api_base_uri: Override `websocket_api_base_uri`. Example: `ws://127.0.0.1:8765/`</span>
<span class="sd">    :type websocket_api_base_uri:  str</span>
<span class="sd">    :param max_subscriptions_per_stream: Override the `max_subscriptions_per_stream` value. Example: 1024</span>
<span class="sd">    :type max_subscriptions_per_stream:  int</span>
<span class="sd">    :param exchange_type: Override the exchange type. Valid options are: &#39;cex&#39;, &#39;dex&#39;</span>
<span class="sd">    :type exchange_type:  str</span>
<span class="sd">    :param socks5_proxy_server: Set this to activate the usage of a socks5 proxy. Example: &#39;127.0.0.1:9050&#39;</span>
<span class="sd">    :type socks5_proxy_server:  str</span>
<span class="sd">    :param socks5_proxy_user: Set this to activate the usage of a socks5 proxy user. Example: &#39;alice&#39;</span>
<span class="sd">    :type socks5_proxy_user:  str</span>
<span class="sd">    :param socks5_proxy_pass: Set this to activate the usage of a socks5 proxy password.</span>
<span class="sd">    :type socks5_proxy_pass:  str</span>
<span class="sd">    :param socks5_proxy_ssl_verification: Set to `False` to disable SSL server verification. Default is `True`.</span>
<span class="sd">    :type socks5_proxy_ssl_verification:  bool</span>
<span class="sd">    :param lucit_api_secret: The `api_secret` of your UNICORN Binance Suite license from</span>
<span class="sd">                             https://shop.lucit.services/software/unicorn-binance-suite</span>
<span class="sd">    :type lucit_api_secret:  str</span>
<span class="sd">    :param lucit_license_ini: Specify the path including filename to the config file (ex: `~/license_a.ini`). If not</span>
<span class="sd">                              provided lucitlicmgr tries to load a `lucit_license.ini` from `/home/oliver/.lucit/`.</span>
<span class="sd">    :type lucit_license_ini:  str</span>
<span class="sd">    :param lucit_license_profile: The license profile to use. Default is &#39;LUCIT&#39;.</span>
<span class="sd">    :type lucit_license_profile:  str</span>
<span class="sd">    :param lucit_license_token: The `license_token` of your UNICORN Binance Suite license from</span>
<span class="sd">                                https://shop.lucit.services/software/unicorn-binance-suite</span>
<span class="sd">    :type lucit_license_token:  str</span>
<span class="sd">    :param ubra_manager: Provide a shared unicorn_binance_rest_api.manager instance</span>
<span class="sd">    :type ubra_manager: BinanceRestApiManager</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">process_stream_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">process_stream_data_async</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">process_asyncio_queue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">exchange</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;binance.com&quot;</span><span class="p">,</span>
                 <span class="n">warn_on_update</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">restart_timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
                 <span class="n">show_secrets_in_logs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">output_default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;dict&#39;</span><span class="p">,</span> <span class="s1">&#39;raw_data&#39;</span><span class="p">,</span> <span class="s1">&#39;UnicornFy&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;raw_data&quot;</span><span class="p">,</span>
                 <span class="n">enable_stream_signal_buffer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">disable_colorama</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">stream_buffer_maxlen</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">process_stream_signals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">close_timeout_default</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                 <span class="n">ping_interval_default</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
                 <span class="n">ping_timeout_default</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                 <span class="n">high_performance</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">debug</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">restful_base_uri</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">websocket_base_uri</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">websocket_api_base_uri</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">max_subscriptions_per_stream</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">exchange_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;cex&#39;</span><span class="p">,</span> <span class="s1">&#39;dex&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">socks5_proxy_server</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">socks5_proxy_user</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">socks5_proxy_pass</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">socks5_proxy_ssl_verification</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">auto_data_cleanup_stopped_streams</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">lucit_api_secret</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">lucit_license_ini</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">lucit_license_profile</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">lucit_license_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">ubra_manager</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BinanceRestApiManager</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="p">):</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">__app_name__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">__version__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_manager_request</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_data_cleanup_stopped_streams</span> <span class="o">=</span> <span class="n">auto_data_cleanup_stopped_streams</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New instance of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_user_agent</span><span class="p">()</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="s1">&#39;compiled&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">cython</span><span class="o">.</span><span class="n">compiled</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;source&#39;</span><span class="si">}</span><span class="s2"> on &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">())</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">platform</span><span class="o">.</span><span class="n">release</span><span class="p">())</span><span class="si">}</span><span class="s2"> for exchange </span><span class="si">{</span><span class="n">exchange</span><span class="si">}</span><span class="s2"> started ...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Debug is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ubra</span> <span class="o">=</span> <span class="n">ubra_manager</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lucit_api_secret</span> <span class="o">=</span> <span class="n">lucit_api_secret</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lucit_license_ini</span> <span class="o">=</span> <span class="n">lucit_license_ini</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lucit_license_profile</span> <span class="o">=</span> <span class="n">lucit_license_profile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lucit_license_token</span> <span class="o">=</span> <span class="n">lucit_license_token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">llm</span> <span class="o">=</span> <span class="n">LucitLicensingManager</span><span class="p">(</span><span class="n">api_secret</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lucit_api_secret</span><span class="p">,</span>
                                         <span class="n">license_ini</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lucit_license_ini</span><span class="p">,</span>
                                         <span class="n">license_profile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lucit_license_profile</span><span class="p">,</span>
                                         <span class="n">license_token</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lucit_license_token</span><span class="p">,</span>
                                         <span class="n">parent_shutdown_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stop_manager</span><span class="p">,</span>
                                         <span class="n">program_used</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                         <span class="n">needed_license_type</span><span class="o">=</span><span class="s2">&quot;UNICORN-BINANCE-SUITE&quot;</span><span class="p">,</span>
                                         <span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">licensing_exception</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm</span><span class="o">.</span><span class="n">get_license_exception</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">licensing_exception</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoValidatedLucitLicense</span><span class="p">(</span><span class="n">licensing_exception</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">disable_colorama</span> <span class="o">=</span> <span class="n">disable_colorama</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">disable_colorama</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initiating `colorama_</span><span class="si">{</span><span class="n">colorama</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">)</span>
            <span class="n">colorama</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using `websockets_</span><span class="si">{</span><span class="n">websockets</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specific_process_asyncio_queue</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specific_process_stream_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specific_process_stream_data_async</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_asyncio_queue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_stream_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_stream_data_async</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">process_asyncio_queue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using `asyncio_queue` ...&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_asyncio_queue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="n">process_asyncio_queue</span>
        <span class="k">elif</span> <span class="n">process_stream_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using `process_stream_data` ...&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_stream_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="n">process_stream_data</span>
        <span class="k">elif</span> <span class="n">process_stream_data_async</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using `process_stream_data_async` ...&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_stream_data_async</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="n">process_stream_data_async</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using `stream_buffer` ...&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">process_stream_signals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># no special method to process stream signals provided, so we use add_to_stream_signal_buffer:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_stream_signals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_to_stream_signal_buffer</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using `stream_signal_buffer`&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># use the provided method to process stream signals:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_stream_signals</span> <span class="o">=</span> <span class="n">process_stream_signals</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using `process_stream_signals` ...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_stream_signal_buffer</span> <span class="o">=</span> <span class="n">enable_stream_signal_buffer</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_stream_signal_buffer</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Enabled `stream_signal_buffer` ...&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span> <span class="o">=</span> <span class="n">exchange</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">exchange</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">CONNECTION_SETTINGS</span><span class="p">:</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Unknown exchange &#39;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">exchange</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;! List of supported exchanges: &quot;</span> \
                        <span class="sa">f</span><span class="s2">&quot;https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api/wiki/&quot;</span> \
                        <span class="sa">f</span><span class="s2">&quot;Binance-websocket-endpoint-configuration-overview&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop_manager</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">UnknownExchange</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">max_subscriptions_per_stream</span> <span class="o">=</span> <span class="n">max_subscriptions_per_stream</span> <span class="ow">or</span> <span class="n">CONNECTION_SETTINGS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">websocket_base_uri</span> <span class="o">=</span> <span class="n">websocket_base_uri</span> <span class="ow">or</span> <span class="n">CONNECTION_SETTINGS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">websocket_api_base_uri</span> <span class="o">=</span> <span class="n">websocket_api_base_uri</span> <span class="ow">or</span> <span class="n">CONNECTION_SETTINGS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restful_base_uri</span> <span class="o">=</span> <span class="n">restful_base_uri</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exchange_type</span> <span class="o">=</span> <span class="n">exchange_type</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange_type</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span> <span class="ow">in</span> <span class="n">DEX_EXCHANGES</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">exchange_type</span> <span class="o">=</span> <span class="s2">&quot;dex&quot;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span> <span class="ow">in</span> <span class="n">CEX_EXCHANGES</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">exchange_type</span> <span class="o">=</span> <span class="s2">&quot;cex&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.is_exchange_type() - Can not determine exchange type for&quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;exchange=</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">)</span><span class="si">}</span><span class="s2">, resetting to default &#39;cex&#39;&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">exchange_type</span> <span class="o">=</span> <span class="s2">&quot;cex&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using exchange_type &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">exchange_type</span><span class="si">}</span><span class="s2">&#39; ...&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">socks5_proxy_server</span> <span class="o">=</span> <span class="n">socks5_proxy_server</span>
        <span class="k">if</span> <span class="n">socks5_proxy_server</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">socks5_proxy_address</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">socks5_proxy_user</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">socks5_proxy_pass</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">socks5_proxy_port</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Prepare Socks Proxy usage</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">socks5_proxy_ssl_verification</span> <span class="o">=</span> <span class="n">socks5_proxy_ssl_verification</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">socks5_proxy_user</span> <span class="o">=</span> <span class="n">socks5_proxy_user</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">socks5_proxy_pass</span> <span class="o">=</span> <span class="n">socks5_proxy_pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">socks5_proxy_address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">socks5_proxy_port</span> <span class="o">=</span> <span class="n">socks5_proxy_server</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
            <span class="n">websocket_ssl_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLContext</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">socks5_proxy_ssl_verification</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">websocket_ssl_context</span><span class="o">.</span><span class="n">verify_mode</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">CERT_NONE</span>
                <span class="n">websocket_ssl_context</span><span class="o">.</span><span class="n">check_hostname</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">websocket_ssl_context</span> <span class="o">=</span> <span class="n">websocket_ssl_context</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">asyncio_queue</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_subscriptions_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binance_api_status</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                   <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                   <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dex_user_address</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_loops</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequent_checks_list</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequent_checks_list_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">receiving_speed_average</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">receiving_speed_peak</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                     <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">high_performance</span> <span class="o">=</span> <span class="n">high_performance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keep_max_received_last_second_entries</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keepalive_streams_list</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_entry_added_to_stream_buffer</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_monitoring_check</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_update_check_github</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_update_check_github</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_update_check_github_check_command</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listen_key_refresh_interval</span> <span class="o">=</span> <span class="mi">15</span><span class="o">*</span><span class="mi">60</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_send_messages_per_second</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_send_messages_per_second_reserve</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">most_receives_per_second</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">monitoring_api_server</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">monitoring_total_received_bytes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">monitoring_total_receives</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_default</span> <span class="o">=</span> <span class="n">output_default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_response</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_response_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconnects</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconnects_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_id_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restart_timeout</span> <span class="o">=</span> <span class="n">restart_timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">return_response</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">return_response_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ringbuffer_error</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ringbuffer_error_max_size</span> <span class="o">=</span> <span class="mi">500</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ringbuffer_result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ringbuffer_result_max_size</span> <span class="o">=</span> <span class="mi">500</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_secrets_in_logs</span> <span class="o">=</span> <span class="n">show_secrets_in_logs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_buffer_maxlen</span> <span class="o">=</span> <span class="n">stream_buffer_maxlen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_buffer</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_buffer_maxlen</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_buffer_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_buffer_locks</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_buffers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_signal_buffer</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_signal_buffer_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">socket_is_ready</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sockets</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_threads</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_received_bytes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_received_bytes_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_receives</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_receives_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_transmitted</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_transmitted_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_timeout_default</span> <span class="o">=</span> <span class="n">close_timeout_default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ping_interval_default</span> <span class="o">=</span> <span class="n">ping_interval_default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ping_timeout_default</span> <span class="o">=</span> <span class="n">ping_timeout_default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replacement_text</span> <span class="o">=</span> <span class="s2">&quot;***SECRET_REMOVED***&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api</span> <span class="o">=</span> <span class="n">BinanceWebSocketApiApi</span><span class="p">(</span><span class="n">manager</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warn_on_update</span> <span class="o">=</span> <span class="n">warn_on_update</span>
        <span class="k">if</span> <span class="n">warn_on_update</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_update_available</span><span class="p">():</span>
            <span class="n">update_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Release </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_latest_version</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; is available, &quot;</span> \
                         <span class="sa">f</span><span class="s2">&quot;please consider updating! Changelog: &quot;</span> \
                         <span class="sa">f</span><span class="s2">&quot;https://unicorn-binance-websocket-api.docs.lucit.tech/changelog.html&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">update_msg</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">update_msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restclient</span> <span class="o">=</span> <span class="n">BinanceWebSocketApiRestclient</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
                                                        <span class="n">disable_colorama</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">disable_colorama</span><span class="p">,</span>
                                                        <span class="n">exchange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">,</span>
                                                        <span class="n">lucit_api_secret</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lucit_api_secret</span><span class="p">,</span>
                                                        <span class="n">lucit_license_ini</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lucit_license_ini</span><span class="p">,</span>
                                                        <span class="n">lucit_license_profile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lucit_license_profile</span><span class="p">,</span>
                                                        <span class="n">lucit_license_token</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lucit_license_token</span><span class="p">,</span>
                                                        <span class="n">socks5_proxy_server</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">socks5_proxy_server</span><span class="p">,</span>
                                                        <span class="n">socks5_proxy_user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">socks5_proxy_user</span><span class="p">,</span>
                                                        <span class="n">socks5_proxy_pass</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">socks5_proxy_pass</span><span class="p">,</span>
                                                        <span class="n">stream_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">,</span>
                                                        <span class="n">warn_on_update</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">warn_on_update</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Entering with-context of BinanceWebSocketApiManager() ...&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">error_traceback</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Leaving with-context of BinanceWebSocketApiManager() ...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_manager</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">exc_type</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An exception occurred: </span><span class="si">{</span><span class="n">exc_type</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">exc_value</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">error_traceback</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_run_process_asyncio_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stream_id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Execute a provided coroutine within the loop and process the exception results asynchronously.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stream_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">stream_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stream_label</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">stream_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stream_label</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stream_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">stream_label</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">scope</span> <span class="o">==</span> <span class="s2">&quot;global&quot;</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_asyncio_queue</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">scope</span> <span class="o">==</span> <span class="s2">&quot;specific&quot;</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">specific_process_asyncio_queue</span><span class="p">[</span><span class="n">stream_id</span><span class="p">](</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`process_asyncio_queue` of stream_id </span><span class="si">{</span><span class="n">stream_id</span><span class="si">}{</span><span class="n">stream_label</span><span class="si">}</span><span class="s2"> completed successfully.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
            <span class="n">error_msg_wrapper</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exception within to UBWA`s provided `process_asyncio_queue`-coroutine of stream &quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">stream_label</span><span class="si">}</span><span class="s2">: &quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m</span><span class="se">\033</span><span class="s2">[31m</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m</span><span class="se">\r\n</span><span class="s2">&quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="si">{</span><span class="n">error_msg_wrapper</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">error_msg_wrapper</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exception within to UBWA`s provided `process_asyncio_queue`-coroutine of stream &quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">stream_label</span><span class="si">}</span><span class="s2">: &quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="se">\r\n</span><span class="s2">&quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">error_msg_wrapper</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_crash_stream</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">error_msg</span><span class="o">=</span><span class="n">error_msg_wrapper</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_shutdown_asyncgens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">loop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._shutdown_asyncgens(stream_id=</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">) started ...&quot;</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">loop</span><span class="o">.</span><span class="n">shutdown_asyncgens</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_run_socket</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">markets</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_stop_request</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span> \
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_crash_request</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">async</span> <span class="k">with</span> <span class="n">BinanceWebSocketApiSocket</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">markets</span><span class="p">)</span> <span class="k">as</span> <span class="n">socket</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">socket</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">await</span> <span class="n">socket</span><span class="o">.</span><span class="n">start_socket</span><span class="p">()</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_stop_request</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_stream_is_restarting</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._run_socket(stream_id=</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">), channels=&quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">channels</span><span class="si">}</span><span class="s2">), markets=</span><span class="si">{</span><span class="n">markets</span><span class="si">}</span><span class="s2">) - asyncio.CancelledError: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_stream_is_stopping</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">except</span> <span class="n">StreamIsCrashing</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._run_socket(stream_id=</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">), channels=&quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">channels</span><span class="si">}</span><span class="s2">), markets=</span><span class="si">{</span><span class="n">markets</span><span class="si">}</span><span class="s2">) - StreamIsCrashing: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_stream_is_crashing</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">error_msg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">except</span> <span class="n">StreamIsStopping</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._run_socket(stream_id=</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">), channels=&quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">channels</span><span class="si">}</span><span class="s2">), markets=</span><span class="si">{</span><span class="n">markets</span><span class="si">}</span><span class="s2">) - StreamIsStopping: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_stream_is_stopping</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">except</span> <span class="ne">ConnectionResetError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._run_socket(stream_id=</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">), channels=&quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">channels</span><span class="si">}</span><span class="s2">), markets=</span><span class="si">{</span><span class="n">markets</span><span class="si">}</span><span class="s2">) - ConnectionResetError: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_stream_is_restarting</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">error_msg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._run_socket(stream_id=</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">), channels=&quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">channels</span><span class="si">}</span><span class="s2">), markets=</span><span class="si">{</span><span class="n">markets</span><span class="si">}</span><span class="s2">) - ssl.SSLError: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_stream_is_restarting</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">error_msg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._run_socket(stream_id=</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">), channels=&quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">channels</span><span class="si">}</span><span class="s2">), markets=</span><span class="si">{</span><span class="n">markets</span><span class="si">}</span><span class="s2">) - OSError: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_stream_is_restarting</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">error_msg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">websockets</span><span class="o">.</span><span class="n">ConnectionClosed</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._run_socket(stream_id=</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">), channels=&quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">channels</span><span class="si">}</span><span class="s2">), markets=</span><span class="si">{</span><span class="n">markets</span><span class="si">}</span><span class="s2">) - websockets.ConnectionClosed: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_stream_is_restarting</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">error_msg</span><span class="o">=</span><span class="n">error_msg</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">websockets</span><span class="o">.</span><span class="n">InvalidStatusCode</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._run_socket(stream_id=</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">), channels=&quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">channels</span><span class="si">}</span><span class="s2">), markets=</span><span class="si">{</span><span class="n">markets</span><span class="si">}</span><span class="s2">) - websockets.InvalidStatusCode: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_stream_is_restarting</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">error_msg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
                <span class="k">if</span> <span class="s2">&quot;Status code not 101: 400&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._run_socket(stream_id=</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">), channels=&quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">channels</span><span class="si">}</span><span class="s2">), markets=</span><span class="si">{</span><span class="n">markets</span><span class="si">}</span><span class="s2">) - websockets.InvalidStatusCode: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_stream_is_restarting</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">error_msg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
                <span class="k">elif</span> <span class="s2">&quot;Status code not 101: 429&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._run_socket(stream_id=</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">), channels=&quot;</span>
                                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">channels</span><span class="si">}</span><span class="s2">), markets=</span><span class="si">{</span><span class="n">markets</span><span class="si">}</span><span class="s2">) - websockets.InvalidStatusCode: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_stream_is_crashing</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">error_msg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
                    <span class="k">return</span> <span class="kc">None</span>
                <span class="k">elif</span> <span class="s2">&quot;Status code not 101: 500&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._run_socket(stream_id=</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">), channels=&quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">channels</span><span class="si">}</span><span class="s2">), markets=</span><span class="si">{</span><span class="n">markets</span><span class="si">}</span><span class="s2">) - websockets.InvalidStatusCode: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_stream_is_restarting</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">error_msg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._run_socket(stream_id=</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">), channels=&quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">channels</span><span class="si">}</span><span class="s2">), markets=</span><span class="si">{</span><span class="n">markets</span><span class="si">}</span><span class="s2">) - websockets.InvalidStatusCode: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_stream_is_restarting</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">error_msg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">websockets</span><span class="o">.</span><span class="n">InvalidMessage</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._run_socket(stream_id=</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">), channels=&quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">channels</span><span class="si">}</span><span class="s2">), markets=</span><span class="si">{</span><span class="n">markets</span><span class="si">}</span><span class="s2">) - websockets.InvalidMessage: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_stream_is_restarting</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">error_msg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">websockets</span><span class="o">.</span><span class="n">NegotiationError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._run_socket(stream_id=</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">), channels=&quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">channels</span><span class="si">}</span><span class="s2">), markets=</span><span class="si">{</span><span class="n">markets</span><span class="si">}</span><span class="s2">) - websockets.NegotiationError: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_stream_is_restarting</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">error_msg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">StreamIsRestarting</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._run_socket(stream_id=</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">), channels=&quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">channels</span><span class="si">}</span><span class="s2">), markets=</span><span class="si">{</span><span class="n">markets</span><span class="si">}</span><span class="s2">) - StreamIsRestarting: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_stream_is_restarting</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">error_msg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">Socks5ProxyConnectionError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._run_socket(stream_id=</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">), channels=&quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">channels</span><span class="si">}</span><span class="s2">), markets=</span><span class="si">{</span><span class="n">markets</span><span class="si">}</span><span class="s2">) - Socks5ProxyConnectionError: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_stream_is_restarting</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">error_msg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_stop_request</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stream_is_stopping</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_crash_request</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stream_is_crashing</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="BinanceWebSocketApiManager.get_stream_data_from_asyncio_queue">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_stream_data_from_asyncio_queue">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_stream_data_from_asyncio_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the oldest entry from the FIFO stack.</span>

<span class="sd">        :param stream_id: provide a stream_id - only needed for userData Streams (acquiring a listenKey)</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :return: stream_data - str, dict or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stream_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">asyncio_queue</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.asyncio_queue_task_done">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.asyncio_queue_task_done">[docs]</a>
    <span class="k">def</span> <span class="nf">asyncio_queue_task_done</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If `get_stream_data_from_asyncio_queue()` was used, `asyncio_queue_task_done()` must be executed at the end of</span>
<span class="sd">        the loop.</span>

<span class="sd">        :param stream_id: provide a stream_id - only needed for userData Streams (acquiring a listenKey)</span>
<span class="sd">        :type stream_id: str</span>

<span class="sd">        :return: bool</span>

<span class="sd">        Example:</span>

<span class="sd">        . code-block:: python</span>

<span class="sd">            while True:</span>
<span class="sd">                data = await ubwa.get_stream_data_from_asyncio_queue(stream_id)</span>
<span class="sd">                print(data)</span>
<span class="sd">                ubwa.asyncio_queue_task_done(stream_id)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stream_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">asyncio_queue</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.send_stream_signal">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.send_stream_signal">[docs]</a>
    <span class="k">def</span> <span class="nf">send_stream_signal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stream_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_record</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">error_msg</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send a stream signal</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Stream with stream_id=&quot;</span><span class="p">):</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Reason:\s*(.*)&#39;</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">error_msg</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_stream_signals</span><span class="p">(</span><span class="n">signal_type</span><span class="o">=</span><span class="n">signal_type</span><span class="p">,</span>
                                    <span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span>
                                    <span class="n">data_record</span><span class="o">=</span><span class="n">data_record</span><span class="p">,</span>
                                    <span class="n">error_msg</span><span class="o">=</span><span class="n">error_msg</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.send_stream_signal() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;last_stream_signal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">signal_type</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.send_stream_signal() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.send_with_stream">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.send_with_stream">[docs]</a>
    <span class="k">def</span> <span class="nf">send_with_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send a payload with a specific stream.</span>

<span class="sd">        :param stream_id: id of the stream to be used for sending.</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :param payload: The payload to add.</span>
<span class="sd">        :type payload: dict or str(JSON)</span>
<span class="sd">        :param timeout: Timeout to wait for a ready stream.</span>
<span class="sd">        :type timeout: float or int</span>

<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span>
                                 <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">timeout</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_event_loop_by_stream_id</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">timeout_time</span> <span class="o">=</span> <span class="n">start_time</span> <span class="o">+</span> <span class="n">timeout</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_socket_ready</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_stop_request</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span> \
                        <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_crash_request</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span> \
                        <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;crashed&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.send_with_stream(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2"> - Socket is stopping!&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">timeout_time</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.send_with_stream(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2"> - Timeout exceeded!&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">asyncio</span><span class="o">.</span><span class="n">run_coroutine_threadsafe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sockets</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span><span class="o">.</span><span class="n">websocket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">),</span>
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">get_event_loop_by_stream_id</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.send_with_stream(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2"> - Sent payload: </span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.send_with_stream(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2"> - KeyError: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.send_with_stream(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2"> - AttributeError: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.send_with_stream(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2"> - No valid asyncio loop!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


    <span class="k">def</span> <span class="nf">_add_stream_to_stream_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                   <span class="n">stream_id</span><span class="p">,</span>
                                   <span class="n">channels</span><span class="p">,</span>
                                   <span class="n">markets</span><span class="p">,</span>
                                   <span class="n">stream_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">stream_buffer_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                   <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">api_secret</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">symbols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                   <span class="n">ping_interval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">ping_timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">close_timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">provided_listen_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">keep_listen_key_alive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">stream_buffer_maxlen</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">api</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                   <span class="n">process_stream_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">process_stream_data_async</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">process_asyncio_queue</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a list entry for new streams</span>

<span class="sd">        :param stream_id: provide a stream_id - only needed for userData Streams (acquiring a listenKey)</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :param channels: provide the channels to create the URI</span>
<span class="sd">        :type channels: str, tuple, list, set</span>
<span class="sd">        :param markets: provide the markets to create the URI</span>
<span class="sd">        :type markets: str, tuple, list, set</span>
<span class="sd">        :param stream_label: provide a stream_label for the stream</span>
<span class="sd">        :type stream_label: str</span>
<span class="sd">        :param stream_buffer_name: If `False` the data is going to get written to the default stream_buffer,</span>
<span class="sd">                                   set to `True` to read the data via `pop_stream_data_from_stream_buffer(stream_id)` or</span>
<span class="sd">                                   provide a string to create and use a shared stream_buffer and read it via</span>
<span class="sd">                                   `pop_stream_data_from_stream_buffer(&#39;string&#39;)`.</span>
<span class="sd">        :type stream_buffer_name: bool or str</span>
<span class="sd">        :param api_key: provide a valid Binance API key</span>
<span class="sd">        :type api_key: str</span>
<span class="sd">        :param api_secret: provide a valid Binance API secret</span>
<span class="sd">        :type api_secret: str</span>
<span class="sd">        :param symbols: provide the symbols for isolated_margin user_data streams</span>
<span class="sd">        :type symbols: str</span>
<span class="sd">        :param output: the default setting `raw_data` can be globaly overwritten with the parameter</span>
<span class="sd">                       `output_default &lt;https://unicorn-binance-websocket-api.docs.lucit.tech/unicorn_binance_websocket_api.html?highlight=output_default#module-unicorn_binance_websocket_api.unicorn_binance_websocket_api_manager&gt;`_</span>
<span class="sd">                       of BinanceWebSocketApiManager`. To overrule the `output_default` value for this specific stream,</span>
<span class="sd">                       set `output` to &quot;dict&quot; to convert the received raw data to a python dict,  set to &quot;UnicornFy&quot; to</span>
<span class="sd">                       convert with `UnicornFy &lt;https://github.com/LUCIT-Systems-and-Development/unicorn-fy&gt;`_ -  otherwise with</span>
<span class="sd">                       the default setting &quot;raw_data&quot; the output remains unchanged and gets delivered as received from</span>
<span class="sd">                       the endpoints</span>
<span class="sd">        :type output: str</span>
<span class="sd">        :param ping_interval: Once the connection is open, a `Ping frame` is sent every</span>
<span class="sd">                              `ping_interval` seconds. This serves as a keepalive. It helps keeping</span>
<span class="sd">                              the connection open, especially in the presence of proxies with short</span>
<span class="sd">                              timeouts on inactive connections. Set `ping_interval` to `None` to</span>
<span class="sd">                              disable this behavior. (default: 20)</span>
<span class="sd">                              This parameter is passed through to the `websockets.client.connect()</span>
<span class="sd">                              &lt;https://websockets.readthedocs.io/en/stable/topics/timeouts.html?highlight=ping_interval#keepalive-in-websockets&gt;`_</span>
<span class="sd">        :type ping_interval: int or None</span>
<span class="sd">        :param ping_timeout: If the corresponding `Pong frame` isn&#39;t received within</span>
<span class="sd">                             `ping_timeout` seconds, the connection is considered unusable and is closed with</span>
<span class="sd">                             code 1011. This ensures that the remote endpoint remains responsive. Set</span>
<span class="sd">                             `ping_timeout` to `None` to disable this behavior. (default: 20)</span>
<span class="sd">                             This parameter is passed through to the `websockets.client.connect()</span>
<span class="sd">                             &lt;https://websockets.readthedocs.io/en/stable/topics/timeouts.html?highlight=ping_interval#keepalive-in-websockets&gt;`_</span>
<span class="sd">        :type ping_timeout: int or None</span>
<span class="sd">        :param close_timeout: The `close_timeout` parameter defines a maximum wait time in seconds for</span>
<span class="sd">                              completing the closing handshake and terminating the TCP connection. (default: 10)</span>
<span class="sd">                              This parameter is passed through to the `websockets.client.connect()</span>
<span class="sd">                              &lt;https://websockets.readthedocs.io/en/stable/topics/design.html?highlight=close_timeout#closing-handshake&gt;`_</span>
<span class="sd">        :type close_timeout: int or None</span>
<span class="sd">        :param stream_buffer_maxlen: Set a max len for the `stream_buffer`. Only used in combination with a non-generic</span>
<span class="sd">                                     `stream_buffer`. The generic `stream_buffer` uses always the value of</span>
<span class="sd">                                     `BinanceWebSocketApiManager()`.</span>
<span class="sd">        :type stream_buffer_maxlen: int or None</span>
<span class="sd">        :param api: Setting this to `True` activates the creation of a Websocket API stream to send API requests via Websocket.</span>
<span class="sd">                    Needs `api_key` and `api_secret` in combination. This type of stream can not be combined with a UserData</span>
<span class="sd">                    stream or another public endpoint. (Default is `False`)</span>
<span class="sd">        :type api: bool</span>
<span class="sd">        :param process_stream_data: Provide a function/method to process the received webstream data. The function</span>
<span class="sd">                            will be called instead of</span>
<span class="sd">                            `add_to_stream_buffer() &lt;unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.add_to_stream_buffer&gt;`_</span>
<span class="sd">                            like `process_stream_data(stream_data, stream_buffer_name)` where</span>
<span class="sd">                            `stream_data` cointains the raw_stream_data. If not provided, the raw stream_data will</span>
<span class="sd">                            get stored in the stream_buffer! `How to read from stream_buffer!</span>
<span class="sd">                            &lt;https://unicorn-binance-websocket-api.docs.lucit.tech/README.html#and-4-more-lines-to-print-the-receives&gt;`_</span>
<span class="sd">        :type process_stream_data: function</span>
<span class="sd">        :param process_stream_data_async: Provide an asynchronous function/method to process the received webstream data.</span>
<span class="sd">                            The function will be called instead of</span>
<span class="sd">                            `add_to_stream_buffer() &lt;unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.add_to_stream_buffer&gt;`_</span>
<span class="sd">                            like `process_stream_data(stream_data, stream_buffer_name)` where</span>
<span class="sd">                            `stream_data` cointains the raw_stream_data. If not provided, the raw stream_data will</span>
<span class="sd">                            get stored in the stream_buffer! `How to read from stream_buffer!</span>
<span class="sd">                            &lt;https://unicorn-binance-websocket-api.docs.lucit.tech/README.html#and-4-more-lines-to-print-the-receives&gt;`_</span>
<span class="sd">        :type process_stream_data_async: function</span>
<span class="sd">        :param process_asyncio_queue: Insert your Asyncio function into the same AsyncIO loop in which the websocket data</span>
<span class="sd">                                      is received. This method guarantees the fastest possible asynchronous processing of</span>
<span class="sd">                                      the data in the correct receiving sequence.</span>
<span class="sd">                                      https://unicorn-binance-websocket-api.docs.lucit.tech/readme.html#or-await-the-webstream-data-in-an-asyncio-coroutine</span>
<span class="sd">        :type process_asyncio_queue: Optional[Callable]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">output</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_default</span>
        <span class="n">close_timeout</span> <span class="o">=</span> <span class="n">close_timeout</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">close_timeout_default</span>
        <span class="n">ping_interval</span> <span class="o">=</span> <span class="n">ping_interval</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">ping_interval_default</span>
        <span class="n">ping_timeout</span> <span class="o">=</span> <span class="n">ping_timeout</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">ping_timeout_default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specific_process_asyncio_queue</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">process_asyncio_queue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specific_process_stream_data</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">process_stream_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specific_process_stream_data_async</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">process_stream_data_async</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._add_stream_to_stream_list() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;exchange&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">,</span>
                                           <span class="s1">&#39;stream_id&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">stream_id</span><span class="p">),</span>
                                           <span class="s1">&#39;recent_socket_id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                           <span class="s1">&#39;channels&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">channels</span><span class="p">),</span>
                                           <span class="s1">&#39;markets&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">markets</span><span class="p">),</span>
                                           <span class="s1">&#39;stream_label&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">stream_label</span><span class="p">),</span>
                                           <span class="s1">&#39;stream_buffer_name&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">stream_buffer_name</span><span class="p">),</span>
                                           <span class="s1">&#39;stream_buffer_maxlen&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">stream_buffer_maxlen</span><span class="p">),</span>
                                           <span class="s1">&#39;symbols&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symbols</span><span class="p">),</span>
                                           <span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">output</span><span class="p">),</span>
                                           <span class="s1">&#39;subscriptions&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                           <span class="s1">&#39;payload&#39;</span><span class="p">:</span> <span class="p">[],</span>
                                           <span class="s1">&#39;api&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">api</span><span class="p">),</span>
                                           <span class="s1">&#39;api_key&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">api_key</span><span class="p">),</span>
                                           <span class="s1">&#39;api_secret&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">api_secret</span><span class="p">),</span>
                                           <span class="s1">&#39;dex_user_address&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dex_user_address</span><span class="p">),</span>
                                           <span class="s1">&#39;ping_interval&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">ping_interval</span><span class="p">),</span>
                                           <span class="s1">&#39;ping_timeout&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">ping_timeout</span><span class="p">),</span>
                                           <span class="s1">&#39;close_timeout&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">close_timeout</span><span class="p">),</span>
                                           <span class="s1">&#39;provided_listen_key&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">provided_listen_key</span><span class="p">),</span>
                                           <span class="s1">&#39;keep_listen_key_alive&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">keep_listen_key_alive</span><span class="p">),</span>
                                           <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;starting&#39;</span><span class="p">,</span>
                                           <span class="s1">&#39;start_time&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
                                           <span class="s1">&#39;processed_receives_total&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                           <span class="s1">&#39;receives_statistic_last_second&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;most_receives_per_second&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;entries&#39;</span><span class="p">:</span> <span class="p">{}},</span>
                                           <span class="s1">&#39;seconds_to_last_heartbeat&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                           <span class="s1">&#39;last_heartbeat&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                           <span class="s1">&#39;stop_request&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                           <span class="s1">&#39;crash_request&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                           <span class="s1">&#39;crash_request_reason&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                           <span class="s1">&#39;loop_is_closing&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                           <span class="s1">&#39;seconds_since_has_stopped&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                           <span class="s1">&#39;has_stopped&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                           <span class="s1">&#39;reconnects&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                           <span class="s1">&#39;last_stream_signal&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                           <span class="s1">&#39;logged_reconnects&#39;</span><span class="p">:</span> <span class="p">[],</span>
                                           <span class="s1">&#39;processed_transmitted_total&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                           <span class="s1">&#39;last_static_ping_listen_key&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                           <span class="s1">&#39;listen_key&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                           <span class="s1">&#39;listen_key_cache_time&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">listen_key_refresh_interval</span><span class="p">,</span>
                                           <span class="s1">&#39;last_received_data_record&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                           <span class="s1">&#39;processed_receives_statistic&#39;</span><span class="p">:</span> <span class="p">{},</span>
                                           <span class="s1">&#39;transfer_rate_per_second&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;bytes&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;speed&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
                                           <span class="s1">&#39;websocket_uri&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                           <span class="s1">&#39;3rd-party-future&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._add_stream_to_stream_list() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager._add_stream_to_stream_list(&quot;</span> <span class="o">+</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_label</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_buffer_name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_buffer_maxlen</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_stream_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                              <span class="n">stream_id</span><span class="p">,</span>
                              <span class="n">channels</span><span class="p">,</span>
                              <span class="n">markets</span><span class="p">,</span>
                              <span class="n">stream_buffer_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="n">stream_buffer_maxlen</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Co function of self.create_stream to create a thread for the socket and to manage the coroutine</span>

<span class="sd">        :param stream_id: provide a stream_id - only needed for userData Streams (acquiring a listenKey)</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :param channels: provide the channels to create the URI</span>
<span class="sd">        :type channels: str, tuple, list, set</span>
<span class="sd">        :param markets: provide the markets to create the URI</span>
<span class="sd">        :type markets: str, tuple, list, set</span>
<span class="sd">        :param stream_buffer_name: If `False` the data is going to get written to the default stream_buffer,</span>
<span class="sd">                           set to `True` to read the data via `pop_stream_data_from_stream_buffer(stream_id)` or</span>
<span class="sd">                           provide a string to create and use a shared stream_buffer and read it via</span>
<span class="sd">                           `pop_stream_data_from_stream_buffer(&#39;string&#39;)`.</span>
<span class="sd">        :type stream_buffer_name: bool or str</span>
<span class="sd">        :param stream_buffer_maxlen: Set a max len for the `stream_buffer`. Only used in combination with a non-generic</span>
<span class="sd">                                     `stream_buffer`. The generic `stream_buffer` uses always the value of</span>
<span class="sd">                                     `BinanceWebSocketApiManager()`.</span>
<span class="sd">        :type stream_buffer_maxlen: int or None</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stream_buffer_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_buffer_locks</span><span class="p">[</span><span class="n">stream_buffer_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Not resetting the stream_buffer during a restart:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_buffers</span><span class="p">[</span><span class="n">stream_buffer_name</span><span class="p">]:</span>
                    <span class="k">pass</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="c1"># Resetting</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_buffers</span><span class="p">[</span><span class="n">stream_buffer_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="n">stream_buffer_maxlen</span><span class="p">)</span>
        <span class="n">loop</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">new_event_loop</span><span class="p">()</span>
            <span class="n">asyncio</span><span class="o">.</span><span class="n">set_event_loop</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">loop</span><span class="o">.</span><span class="n">set_debug</span><span class="p">(</span><span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">event_loops</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">loop</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">asyncio_queue</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;api&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span>
                    <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;!userData&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;markets&#39;</span><span class="p">]</span>
                         <span class="ow">or</span> <span class="s2">&quot;!userData&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">])):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._create_stream_thread(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2"> - &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;Adding `_ping_listen_key(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">)` to asyncio loop ...&quot;</span><span class="p">)</span>
                <span class="n">loop</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ping_listen_key</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._create_stream_thread(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2"> - &quot;</span>
                         <span class="sa">f</span><span class="s2">&quot;Adding `_run_socket(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">)` to asyncio loop ...&quot;</span><span class="p">)</span>
            <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_run_socket</span><span class="p">(</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">markets</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._create_stream_thread(</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span><span class="si">}</span><span class="s2"> - OSError  - can not &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;create stream - error_msg: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._create_stream_thread() stream_id=</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span>
                         <span class="sa">f</span><span class="s2">&quot; - RuntimeError `error: 12` - error_msg: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
            <span class="n">stream_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stream_label</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">stream_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">stream_label</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stream_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">stream_label</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="n">error_msg_wrapper</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exception within a coroutine of stream &#39;</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">stream_label</span><span class="si">}</span><span class="s2">: &quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m</span><span class="se">\033</span><span class="s2">[31m</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m</span><span class="se">\r\n</span><span class="s2">&quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="si">{</span><span class="n">error_msg_wrapper</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">error_msg_wrapper</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exception within a coroutine of stream &#39;</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">stream_label</span><span class="si">}</span><span class="s2">: &quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="se">\r\n</span><span class="s2">&quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">error_msg_wrapper</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_crash_stream</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">error_msg</span><span class="o">=</span><span class="n">error_msg_wrapper</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finally closing the loop stream_id=</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._create_stream_thread() - `stream_list_lock` was &quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;entered!&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;loop_is_closing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._create_stream_thread() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">if</span> <span class="n">loop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">loop</span><span class="o">.</span><span class="n">is_running</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">tasks</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">all_tasks</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span>
                        <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shutdown_asyncgens</span><span class="p">(</span><span class="n">loop</span><span class="p">))</span>
                        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
                            <span class="n">task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
                            <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">:</span>
                                <span class="k">pass</span>
                    <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._create_stream_thread() stream_id=</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span><span class="si">}</span><span class="s2"> - &quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot;RuntimeError `error: 14` - </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">RuntimeWarning</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._create_stream_thread() stream_id=</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span><span class="si">}</span><span class="s2"> - &quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot;RuntimeWarning `error: 21` - </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._create_stream_thread() finally - </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">loop</span><span class="o">.</span><span class="n">is_closed</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">wait_till_stream_has_stopped</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                    <span class="n">loop</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._create_stream_thread() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;loop_is_closing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._create_stream_thread() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._create_stream_thread() stream_id=</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span><span class="si">}</span><span class="s2"> - &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;KeyError `error: 15` - </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_socket_is_ready</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>

<div class="viewcode-block" id="BinanceWebSocketApiManager.generate_signature">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.generate_signature">[docs]</a>
    <span class="k">def</span> <span class="nf">generate_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_secret</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Signe the request.</span>

<span class="sd">        :param api_secret:</span>
<span class="sd">        :param data:</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ordered_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_params</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">query_string</span> <span class="o">=</span> <span class="s1">&#39;&amp;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">ordered_data</span><span class="p">])</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">api_secret</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="n">query_string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.order_params">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.order_params">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">order_params</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert params to list with signature as last element</span>

<span class="sd">        :param data:</span>
<span class="sd">        :return:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">has_signature</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;signature&#39;</span><span class="p">:</span>
                <span class="n">has_signature</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="c1"># sort parameters by key</span>
        <span class="n">params</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">has_signature</span><span class="p">:</span>
            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;signature&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;signature&#39;</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">params</span></div>


    <span class="k">async</span> <span class="k">def</span> <span class="nf">_auto_data_cleanup_stopped_streams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">interval</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">age</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._auto_data_cleanup_stopped_streams() - Starting with an interval &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;of </span><span class="si">{</span><span class="n">interval</span><span class="si">}</span><span class="s2"> seconds!&quot;</span><span class="p">)</span>
        <span class="n">timestamp_last_check</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_manager_stopping</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timestamp_unix</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">timestamp_last_check</span> <span class="o">+</span> <span class="n">interval</span><span class="p">:</span>
                <span class="n">timestamp_last_check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timestamp_unix</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_data_cleanup_stopped_streams</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">stopped_streams</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._auto_data_cleanup_stopped_streams() - &quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot;`stream_list_lock` was entered!&quot;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">stream_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">:</span>
                            <span class="n">stopped_streams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._auto_data_cleanup_stopped_streams() - Leaving&quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot;`stream_list_lock`!&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">stream_id</span> <span class="ow">in</span> <span class="n">stopped_streams</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;stopped&quot;</span>
                                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;crashed&quot;</span><span class="p">)):</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stream_info</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)[</span><span class="s1">&#39;seconds_since_has_stopped&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">age</span><span class="p">:</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._auto_data_cleanup_stopped_streams() - &quot;</span>
                                            <span class="sa">f</span><span class="s2">&quot;Removing all remaining data of stream with stream_id=</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2"> from &quot;</span>
                                            <span class="sa">f</span><span class="s2">&quot;this instance!&quot;</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">remove_all_data_of_stream_id</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._auto_data_cleanup_stopped_streams() - &quot;</span>
                                            <span class="sa">f</span><span class="s2">&quot;Remaining data of stream with stream_id=</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2"> successfully removed &quot;</span>
                                            <span class="sa">f</span><span class="s2">&quot;from this instance!&quot;</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">interval</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_frequent_checks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method gets started in a loop and is doing the frequent checks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">frequent_checks_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timestamp_unix</span><span class="p">()</span>
        <span class="n">cpu_usage_time</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequent_checks_list_lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequent_checks_list</span><span class="p">[</span><span class="n">frequent_checks_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;last_heartbeat&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                                             <span class="s1">&#39;stop_request&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                                             <span class="s1">&#39;has_stopped&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._frequent_checks() new instance created with frequent_checks_id&quot;</span>
                     <span class="sa">f</span><span class="s2">&quot;=</span><span class="si">{</span><span class="n">frequent_checks_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># threaded loop for min 1 check per second</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_manager_request</span> <span class="ow">is</span> <span class="kc">False</span> \
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequent_checks_list</span><span class="p">[</span><span class="n">frequent_checks_id</span><span class="p">][</span><span class="s1">&#39;stop_request&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequent_checks_list_lock</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequent_checks_list</span><span class="p">[</span><span class="n">frequent_checks_id</span><span class="p">][</span><span class="s1">&#39;last_heartbeat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">current_timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
            <span class="n">last_timestamp</span> <span class="o">=</span> <span class="n">current_timestamp</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">next_to_last_timestamp</span> <span class="o">=</span> <span class="n">current_timestamp</span> <span class="o">-</span> <span class="mi">2</span>
            <span class="n">total_most_stream_receives_last_timestamp</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">total_most_stream_receives_next_to_last_timestamp</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">active_stream_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_stream_list</span><span class="p">()</span>
            <span class="c1"># check CPU stats</span>
            <span class="n">cpu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_process_usage_cpu</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">cpu</span> <span class="o">&gt;=</span> <span class="mi">95</span><span class="p">:</span>
                <span class="n">time_of_waiting</span> <span class="o">=</span> <span class="mi">5</span>
                <span class="k">if</span> <span class="n">cpu_usage_time</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">cpu_usage_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">cpu_usage_time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">time_of_waiting</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._frequent_checks() - High CPU usage since &quot;</span>
                                   <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">time_of_waiting</span><span class="p">)</span><span class="si">}</span><span class="s2"> seconds: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">cpu</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">cpu_usage_time</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cpu_usage_time</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># count most_receives_per_second total last second</span>
            <span class="k">if</span> <span class="n">active_stream_list</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">stream_id</span> <span class="ow">in</span> <span class="n">active_stream_list</span><span class="p">:</span>
                    <span class="c1"># set the streams `most_receives_per_second` value</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;receives_statistic_last_second&#39;</span><span class="p">][</span><span class="s1">&#39;entries&#39;</span><span class="p">][</span><span class="n">last_timestamp</span><span class="p">]</span> <span class="o">&gt;</span> \
                                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;receives_statistic_last_second&#39;</span><span class="p">][</span><span class="s1">&#39;most_receives_per_second&#39;</span><span class="p">]:</span>
                            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._frequent_checks() - `stream_list_lock` was &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;entered!&quot;</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;receives_statistic_last_second&#39;</span><span class="p">][</span><span class="s1">&#39;most_receives_per_second&#39;</span><span class="p">]</span> <span class="o">=</span> \
                                    <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;receives_statistic_last_second&#39;</span><span class="p">][</span><span class="s1">&#39;entries&#39;</span><span class="p">][</span><span class="n">last_timestamp</span><span class="p">]</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._frequent_checks() - Leaving &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;`stream_list_lock`!&quot;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">total_most_stream_receives_last_timestamp</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;receives_statistic_last_second&#39;</span><span class="p">][</span><span class="s1">&#39;entries&#39;</span><span class="p">][</span><span class="n">last_timestamp</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">total_most_stream_receives_next_to_last_timestamp</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;receives_statistic_last_second&#39;</span><span class="p">][</span><span class="s1">&#39;entries&#39;</span><span class="p">][</span><span class="n">next_to_last_timestamp</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="c1"># delete list entries older than `keep_max_received_last_second_entries`</span>
                    <span class="c1"># receives_statistic_last_second</span>
                    <span class="n">delete_index</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;receives_statistic_last_second&#39;</span><span class="p">][</span><span class="s1">&#39;entries&#39;</span><span class="p">])</span> <span class="o">&gt;</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">keep_max_received_last_second_entries</span><span class="p">:</span>
                        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._frequent_checks() - `stream_list_lock` was &quot;</span>
                                         <span class="sa">f</span><span class="s2">&quot;entered!&quot;</span><span class="p">)</span>
                            <span class="n">temp_entries</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;receives_statistic_last_second&#39;</span><span class="p">][</span><span class="s1">&#39;entries&#39;</span><span class="p">])</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._frequent_checks() - Leaving &quot;</span>
                                         <span class="sa">f</span><span class="s2">&quot;`stream_list_lock`!&quot;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">timestamp_key</span> <span class="ow">in</span> <span class="n">temp_entries</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">timestamp_key</span> <span class="o">&lt;</span> <span class="n">current_timestamp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_max_received_last_second_entries</span><span class="p">:</span>
                                    <span class="n">delete_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">timestamp_key</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager._frequent_checks() timestamp_key=&quot;</span> <span class="o">+</span>
                                             <span class="nb">str</span><span class="p">(</span><span class="n">timestamp_key</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; current_timestamp=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_timestamp</span><span class="p">)</span> <span class="o">+</span>
                                             <span class="s2">&quot; keep_max_received_last_second_entries=&quot;</span> <span class="o">+</span>
                                             <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keep_max_received_last_second_entries</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; error_msg=&quot;</span> <span class="o">+</span>
                                             <span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">timestamp_key</span> <span class="ow">in</span> <span class="n">delete_index</span><span class="p">:</span>
                        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._frequent_checks() - `stream_list_lock` was &quot;</span>
                                         <span class="sa">f</span><span class="s2">&quot;entered!&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;receives_statistic_last_second&#39;</span><span class="p">][</span><span class="s1">&#39;entries&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">timestamp_key</span><span class="p">,</span>
                                                                                                         <span class="kc">None</span><span class="p">)</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._frequent_checks() - Leaving &quot;</span>
                                         <span class="sa">f</span><span class="s2">&quot;`stream_list_lock`!&quot;</span><span class="p">)</span>
                    <span class="c1"># transfer_rate_per_second</span>
                    <span class="n">delete_index</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;transfer_rate_per_second&#39;</span><span class="p">][</span><span class="s1">&#39;bytes&#39;</span><span class="p">])</span> <span class="o">&gt;</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">keep_max_received_last_second_entries</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">temp_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;transfer_rate_per_second&#39;</span><span class="p">][</span><span class="s1">&#39;bytes&#39;</span><span class="p">]</span>
                            <span class="k">for</span> <span class="n">timestamp_key</span> <span class="ow">in</span> <span class="n">temp_bytes</span><span class="p">:</span>
                                <span class="k">try</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="n">timestamp_key</span> <span class="o">&lt;</span> <span class="n">current_timestamp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_max_received_last_second_entries</span><span class="p">:</span>
                                        <span class="n">delete_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">timestamp_key</span><span class="p">)</span>
                                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                                        <span class="s2">&quot;BinanceWebSocketApiManager._frequent_checks() timestamp_key=&quot;</span>
                                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestamp_key</span><span class="p">)</span> <span class="o">+</span>
                                        <span class="s2">&quot; current_timestamp=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_timestamp</span><span class="p">)</span> <span class="o">+</span>
                                        <span class="s2">&quot; keep_max_received_last_second_&quot;</span>
                                        <span class="s2">&quot;entries=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keep_max_received_last_second_entries</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; error_msg=&quot;</span> <span class="o">+</span>
                                        <span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
                        <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager._frequent_checks() - &quot;</span>
                                        <span class="s2">&quot;Catched RuntimeError: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">timestamp_key</span> <span class="ow">in</span> <span class="n">delete_index</span><span class="p">:</span>
                        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._frequent_checks() - `stream_list_lock` was &quot;</span>
                                         <span class="sa">f</span><span class="s2">&quot;entered!&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;transfer_rate_per_second&#39;</span><span class="p">][</span><span class="s1">&#39;bytes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">timestamp_key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._frequent_checks() - Leaving &quot;</span>
                                         <span class="sa">f</span><span class="s2">&quot;`stream_list_lock`!&quot;</span><span class="p">)</span>
            <span class="c1"># set most_receives_per_second</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">most_receives_per_second</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">total_most_stream_receives_last_timestamp</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">most_receives_per_second</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">total_most_stream_receives_last_timestamp</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager._frequent_checks() self.most_receives_per_second&quot;</span>
                             <span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">most_receives_per_second</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; total_most_stream_receives_last_timestamp&quot;</span>
                             <span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">total_most_stream_receives_last_timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; total_most_stream_receives_next_&quot;</span>
                             <span class="s2">&quot;to_last_timestamp=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">total_most_stream_receives_next_to_last_timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; error_&quot;</span>
                             <span class="s2">&quot;msg=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
            <span class="c1"># check receiving_speed_peak</span>
            <span class="n">last_second_receiving_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_receiving_speed_global</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">last_second_receiving_speed</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">receiving_speed_peak</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">receiving_speed_peak</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">last_second_receiving_speed</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">receiving_speed_peak</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._frequent_checks() - reached new &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;`highest_receiving_speed` &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_human_bytesize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">receiving_speed_peak</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;/s&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2"> at &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_date_of_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">receiving_speed_peak</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._frequent_checks() - Leaving thread ...&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_ping_listen_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._ping_listen_key(stream_id=</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">) - asyncio task running!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;markets&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._ping_listen_key() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;markets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;markets&#39;</span><span class="p">],</span> <span class="p">]</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._ping_listen_key() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._ping_listen_key() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">],</span> <span class="p">]</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._ping_listen_key() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;stopped&quot;</span> \
                <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;crashed&quot;</span><span class="p">):</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;keep_listen_key_alive&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span> \
                    <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span> <span class="o">+</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;listen_key_cache_time&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> \
                    <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;last_static_ping_listen_key&#39;</span><span class="p">]</span> <span class="o">+</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;listen_key_cache_time&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">response</span><span class="p">,</span> <span class="n">binance_api_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restclient</span><span class="o">.</span><span class="n">keepalive_listen_key</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">binance_api_status</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">binance_api_status</span> <span class="o">=</span> <span class="n">binance_api_status</span>
                    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._ping_listen_key() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;last_static_ping_listen_key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._ping_listen_key() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_heartbeat</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._ping_listen_key(stream_id=</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">) - pinged &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;listen_key!&quot;</span><span class="p">)</span>
                    <span class="n">sleep_till</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">listen_key_refresh_interval</span>
                    <span class="k">while</span> <span class="n">sleep_till</span> <span class="o">&gt;</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> \
                            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;stopped&quot;</span> \
                            <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;crashed&quot;</span><span class="p">):</span>
                        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">BinanceAPIException</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._ping_listen_key(stream_id=</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">) - &quot;</span>
                                    <span class="sa">f</span><span class="s2">&quot;BinanceAPIException - Not able to ping the listen_key - error: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s2">&quot;IP banned&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">):</span>
                        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;until (\d+)&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                            <span class="n">banned_timeframe</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span> <span class="o">-</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._ping_listen_key(stream_id=&quot;</span>
                                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">) - Wait for </span><span class="si">{</span><span class="n">banned_timeframe</span><span class="si">}</span><span class="s2"> seconds until the &quot;</span>
                                            <span class="sa">f</span><span class="s2">&quot;IP ban has expired.&quot;</span><span class="p">)</span>
                            <span class="k">while</span> <span class="n">banned_timeframe</span> <span class="o">&gt;</span> <span class="mi">0</span> \
                                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;stopped&quot;</span> \
                                    <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;crashed&quot;</span><span class="p">):</span>
                                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                                <span class="n">banned_timeframe</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">-</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._ping_listen_key(stream_id=</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">) - asyncio task stopped!&quot;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_handle_task_result</span><span class="p">(</span><span class="n">task</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Task</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is a callback for `loop.create_task()` to retrive the task exception and avoid the `Task exception</span>
<span class="sd">        was never retrieved` traceback on stdout:</span>
<span class="sd">        https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api/issues/261</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">task</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._handle_task_result() - asyncio.CancelledError raised by task &quot;</span>
                         <span class="sa">f</span><span class="s2">&quot;= </span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">SystemExit</span> <span class="k">as</span> <span class="n">error_code</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._handle_task_result() - SystemExit(</span><span class="si">{</span><span class="n">error_code</span><span class="si">}</span><span class="s2">) raised by task &quot;</span>
                         <span class="sa">f</span><span class="s2">&quot;= </span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._handle_task_result() - Exception(</span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">) raised by task &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;= </span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_start_monitoring_api_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">warn_on_update</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Threaded method that servces the monitoring api</span>

<span class="sd">        :param host: IP or hostname to use</span>
<span class="sd">        :type host: str</span>
<span class="sd">        :param port: Port to use</span>
<span class="sd">        :type port: int</span>
<span class="sd">        :param warn_on_update: Should the monitoring system report available updates?</span>
<span class="sd">        :type warn_on_update: bool</span>

<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager._start_monitoring_api_thread() - Starting monitoring API service ...&quot;</span><span class="p">)</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/status/&#39;</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">redirect_to_wiki</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager._start_monitoring_api_thread() 200 - &quot;</span>
                        <span class="s2">&quot;Visit https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api/wiki/UNICORN-&quot;</span>
                        <span class="s2">&quot;Monitoring-API-Service for further information!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s2">&quot;https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api/wiki/&quot;</span>
                            <span class="s2">&quot;UNICORN-Monitoring-API-Service&quot;</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="mi">302</span><span class="p">)</span>

        <span class="n">api</span> <span class="o">=</span> <span class="n">Api</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
        <span class="n">api</span><span class="o">.</span><span class="n">add_resource</span><span class="p">(</span><span class="n">BinanceWebSocketApiRestServer</span><span class="p">,</span>
                         <span class="s2">&quot;/status/&lt;string:statusformat&gt;/&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;/status/&lt;string:statusformat&gt;/&lt;string:checkcommandversion&gt;&quot;</span><span class="p">,</span>
                         <span class="n">resource_class_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;handler_binance_websocket_api_manager&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="p">,</span>
                                                <span class="s1">&#39;warn_on_update&#39;</span><span class="p">:</span> <span class="n">warn_on_update</span><span class="p">})</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">():</span>
                <span class="n">dispatcher</span> <span class="o">=</span> <span class="n">wsgi</span><span class="o">.</span><span class="n">PathInfoDispatcher</span><span class="p">({</span><span class="s1">&#39;/&#39;</span><span class="p">:</span> <span class="n">app</span><span class="p">})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">monitoring_api_server</span> <span class="o">=</span> <span class="n">wsgi</span><span class="o">.</span><span class="n">WSGIServer</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">),</span> <span class="n">dispatcher</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">monitoring_api_server</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager._start_monitoring_api_thread() - Monitoring API service is &quot;</span>
                            <span class="s2">&quot;going down! - Info: RuntimeError - &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop_monitoring_api</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">ResourceWarning</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager._start_monitoring_api_thread() - Monitoring API service is &quot;</span>
                            <span class="s2">&quot;going down! - Info: ResourceWarning - &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop_monitoring_api</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager._start_monitoring_api_thread() - Monitoring API service is &quot;</span>
                            <span class="s2">&quot;going down! - Info: OSError - &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop_monitoring_api</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

<div class="viewcode-block" id="BinanceWebSocketApiManager.add_payload_to_stream">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.add_payload_to_stream">[docs]</a>
    <span class="k">def</span> <span class="nf">add_payload_to_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a payload to a stream by `stream_id`.</span>

<span class="sd">        :param stream_id: id of a stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :param payload: The payload in JSON to add.</span>
<span class="sd">        :type payload: dict</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">payload</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">stream_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.add_payload_to_stream() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;payload&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.add_payload_to_stream() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.add_to_ringbuffer_error">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.add_to_ringbuffer_error">[docs]</a>
    <span class="k">def</span> <span class="nf">add_to_ringbuffer_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add received error messages from websocket endpoints to the error ringbuffer</span>

<span class="sd">        :param error: The data to add.</span>
<span class="sd">        :type error: string</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ringbuffer_error</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ringbuffer_error_max_size</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ringbuffer_error</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ringbuffer_error</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.add_to_ringbuffer_result">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.add_to_ringbuffer_result">[docs]</a>
    <span class="k">def</span> <span class="nf">add_to_ringbuffer_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add received result messages from websocket endpoints to the result ringbuffer</span>

<span class="sd">        :param result: The data to add.</span>
<span class="sd">        :type result: string</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ringbuffer_result</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ringbuffer_result_max_size</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ringbuffer_result</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ringbuffer_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.add_to_stream_buffer">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.add_to_stream_buffer">[docs]</a>
    <span class="k">def</span> <span class="nf">add_to_stream_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_data</span><span class="p">,</span> <span class="n">stream_buffer_name</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Kick back data to the</span>
<span class="sd">        `stream_buffer &lt;https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api/wiki/%60stream_buffer%60&gt;`_</span>


<span class="sd">        If it is not possible to process received stream data (for example, the database is restarting, so it&#39;s not</span>
<span class="sd">        possible to save the data), you can return the data back into the stream_buffer. After a few seconds you stopped</span>
<span class="sd">        writing data back to the stream_buffer, the BinanceWebSocketApiManager starts flushing back the data to normal</span>
<span class="sd">        processing.</span>

<span class="sd">        :param stream_data: the data you want to write back to the buffer</span>
<span class="sd">        :type stream_data: raw stream_data or unicorn_fied stream data</span>
<span class="sd">        :param stream_buffer_name: If `False` the data is going to get written to the default stream_buffer,</span>
<span class="sd">                                   set to `True` to read the data via `pop_stream_data_from_stream_buffer(stream_id)` or</span>
<span class="sd">                                   provide a string to create and use a shared stream_buffer and read it via</span>
<span class="sd">                                   `pop_stream_data_from_stream_buffer(&#39;string&#39;)`.</span>
<span class="sd">        :type stream_buffer_name: bool or str</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stream_buffer_name</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_buffer_lock</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stream_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_buffer_locks</span><span class="p">[</span><span class="n">stream_buffer_name</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_buffers</span><span class="p">[</span><span class="n">stream_buffer_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stream_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_entry_added_to_stream_buffer</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.add_to_stream_signal_buffer">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.add_to_stream_signal_buffer">[docs]</a>
    <span class="k">def</span> <span class="nf">add_to_stream_signal_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stream_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_record</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">error_msg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add signals about a stream to the</span>
<span class="sd">        `stream_signal_buffer &lt;https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api/wiki/%60stream_signal_buffer%60&gt;`_</span>

<span class="sd">        :param signal_type: &quot;CONNECT&quot;, &quot;DISCONNECT&quot;, &quot;FIRST_RECEIVED_DATA&quot; or &quot;STREAM_UNREPAIRABLE&quot;</span>
<span class="sd">        :type signal_type: str</span>
<span class="sd">        :param stream_id: id of a stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :param data_record: The last or first received data record</span>
<span class="sd">        :type data_record: str or dict</span>
<span class="sd">        :param error_msg: The message of the error.</span>
<span class="sd">        :type error_msg: str or dict</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_stream_signal_buffer</span><span class="p">:</span>
            <span class="n">stream_signal</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">signal_type</span><span class="p">,</span>
                             <span class="s1">&#39;stream_id&#39;</span><span class="p">:</span> <span class="n">stream_id</span><span class="p">,</span>
                             <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()}</span>
            <span class="k">if</span> <span class="n">signal_type</span> <span class="o">==</span> <span class="s2">&quot;CONNECT&quot;</span><span class="p">:</span>
                <span class="c1"># nothing to add ...</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">signal_type</span> <span class="o">==</span> <span class="s2">&quot;STOP&quot;</span><span class="p">:</span>
                <span class="c1"># nothing to add ...</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">signal_type</span> <span class="o">==</span> <span class="s2">&quot;DISCONNECT&quot;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">stream_signal</span><span class="p">[</span><span class="s1">&#39;last_received_data_record&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;last_received_data_record&#39;</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.add_to_stream_signal_buffer(</span><span class="si">{</span><span class="n">signal_type</span><span class="si">}</span><span class="s2">) - &quot;</span>
                                    <span class="sa">f</span><span class="s2">&quot;Cant determine last_received_data_record! - error_msg: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">stream_signal</span><span class="p">[</span><span class="s1">&#39;last_received_data_record&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="n">signal_type</span> <span class="o">==</span> <span class="s2">&quot;FIRST_RECEIVED_DATA&quot;</span><span class="p">:</span>
                <span class="n">stream_signal</span><span class="p">[</span><span class="s1">&#39;first_received_data_record&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_record</span>
            <span class="k">elif</span> <span class="n">signal_type</span> <span class="o">==</span> <span class="s2">&quot;STREAM_UNREPAIRABLE&quot;</span><span class="p">:</span>
                <span class="n">stream_signal</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.add_to_stream_signal_buffer(</span><span class="si">{</span><span class="n">signal_type</span><span class="si">}</span><span class="s2">) - &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;Received invalid `signal_type`!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_signal_buffer_lock</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_signal_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stream_signal</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.add_to_stream_signal_buffer(</span><span class="si">{</span><span class="n">stream_signal</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.add_total_received_bytes">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.add_total_received_bytes">[docs]</a>
    <span class="k">def</span> <span class="nf">add_total_received_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add received bytes to the total received bytes statistic</span>

<span class="sd">        :param size: int value of added bytes</span>
<span class="sd">        :type size: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_received_bytes_lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_received_bytes</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.clear_stream_buffer">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.clear_stream_buffer">[docs]</a>
    <span class="k">def</span> <span class="nf">clear_stream_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_buffer_name</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clear the</span>
<span class="sd">        `stream_buffer &lt;https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api/wiki/%60stream_buffer%60&gt;`_</span>

<span class="sd">        :param stream_buffer_name: `False` to read from generic stream_buffer, the stream_id if you used True in</span>
<span class="sd">                                   create_stream() or the string name of a shared stream_buffer.</span>
<span class="sd">        :type stream_buffer_name: bool or str</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stream_buffer_name</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_buffer</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_buffer_locks</span><span class="p">[</span><span class="n">stream_buffer_name</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stream_buffers</span><span class="p">[</span><span class="n">stream_buffer_name</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.create_payload">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.create_payload">[docs]</a>
    <span class="k">def</span> <span class="nf">create_payload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">markets</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the payload for subscriptions</span>

<span class="sd">        :param stream_id: provide a stream_id</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :param method: `SUBSCRIBE` or `UNSUBSCRIBE`</span>
<span class="sd">        :type method: str</span>
<span class="sd">        :param channels: provide the channels to create the URI</span>
<span class="sd">        :type channels: str, tuple, list, set</span>
<span class="sd">        :param markets: provide the markets to create the URI</span>
<span class="sd">        :type markets: str, tuple, list, set</span>
<span class="sd">        :return: payload (list) or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.create_payload(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) started ...&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">channels</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">markets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_payload(</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span><span class="si">}</span><span class="s2">) - `channels` and `markets` must &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;be specified!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">channels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">channels</span> <span class="o">=</span> <span class="p">[</span><span class="n">channels</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">markets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">markets</span> <span class="o">=</span> <span class="p">[</span><span class="n">markets</span><span class="p">]</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_exchange_type</span><span class="p">(</span><span class="s2">&quot;dex&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;subscribe&quot;</span> <span class="ow">and</span> <span class="n">channels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
                    <span class="n">add_payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
                                   <span class="s2">&quot;topic&quot;</span><span class="p">:</span> <span class="n">channel</span><span class="p">}</span>
                    <span class="n">symbols</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;allMiniTickers&quot;</span> <span class="ow">or</span> \
                            <span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;allTickers&quot;</span> <span class="ow">or</span> \
                            <span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;blockheight&quot;</span><span class="p">:</span>
                        <span class="n">add_payload</span><span class="p">[</span><span class="s2">&quot;symbols&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;$all&quot;</span><span class="p">]</span>
                        <span class="n">payload</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add_payload</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">markets</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">market</span> <span class="ow">in</span> <span class="n">markets</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">market</span> <span class="o">==</span> <span class="s2">&quot;allMiniTickers&quot;</span> <span class="ow">or</span> \
                                    <span class="n">market</span> <span class="o">==</span> <span class="s2">&quot;allTickers&quot;</span> <span class="ow">or</span> \
                                    <span class="n">market</span> <span class="o">==</span> <span class="s2">&quot;blockheight&quot;</span><span class="p">:</span>
                                <span class="n">add_payload_from_market</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
                                                           <span class="s2">&quot;topic&quot;</span><span class="p">:</span> <span class="n">market</span><span class="p">,</span>
                                                           <span class="s2">&quot;symbols&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;$all&quot;</span><span class="p">]}</span>
                                <span class="n">payload</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add_payload_from_market</span><span class="p">)</span>
                                <span class="k">continue</span>
                            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[a-zA-Z0-9]{41,43}&#39;</span><span class="p">,</span> <span class="n">market</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;dex_user_address&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;dex_user_address&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">market</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">market</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s2">&quot;dex_user_address&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">add_payload</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s2">&quot;dex_user_address&quot;</span><span class="p">]</span>
                            <span class="n">payload</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add_payload</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">add_payload</span><span class="p">[</span><span class="s2">&quot;symbols&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">symbols</span>
                        <span class="n">payload</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add_payload</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;unsubscribe&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">markets</span><span class="p">:</span>
                    <span class="n">add_payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">}</span>
                    <span class="k">for</span> <span class="n">market</span> <span class="ow">in</span> <span class="n">markets</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[a-zA-Z0-9]{41,43}&#39;</span><span class="p">,</span> <span class="n">market</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;dex_user_address&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_payload() - `stream_list_lock` &quot;</span>
                                                 <span class="sa">f</span><span class="s2">&quot;was entered!&quot;</span><span class="p">)</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;dex_user_address&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">market</span>
                                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_payload() - Leaving &quot;</span>
                                                 <span class="sa">f</span><span class="s2">&quot;`stream_list_lock`!&quot;</span><span class="p">)</span>
                                <span class="n">markets</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">market</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">add_payload</span><span class="p">[</span><span class="s2">&quot;symbols&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">markets</span>
                        <span class="n">payload</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add_payload</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">channels</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
                        <span class="n">add_payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
                                       <span class="s2">&quot;topic&quot;</span><span class="p">:</span> <span class="n">channel</span><span class="p">}</span>
                        <span class="n">payload</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add_payload</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.create_payload(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
                                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) - Allowed values for `method`: `subscribe` &quot;</span>
                                <span class="s2">&quot;or `unsubscribe`!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_exchange_type</span><span class="p">(</span><span class="s2">&quot;cex&quot;</span><span class="p">):</span>
            <span class="n">final_market</span> <span class="o">=</span> <span class="s2">&quot;@arr&quot;</span>
            <span class="k">if</span> <span class="n">markets</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">market</span> <span class="ow">in</span> <span class="n">markets</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;arr@&quot;</span> <span class="ow">in</span> <span class="n">market</span><span class="p">:</span>
                        <span class="n">final_market</span> <span class="o">=</span> <span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">market</span>
            <span class="n">final_channel</span> <span class="o">=</span> <span class="s2">&quot;@arr&quot;</span>
            <span class="k">if</span> <span class="n">channels</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;arr@&quot;</span> <span class="ow">in</span> <span class="n">channel</span><span class="p">:</span>
                        <span class="n">final_channel</span> <span class="o">=</span> <span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">channel</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;subscribe&quot;</span><span class="p">:</span>
                <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;!&quot;</span> <span class="ow">in</span> <span class="n">channel</span><span class="p">:</span>
                        <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel</span> <span class="o">+</span> <span class="n">final_market</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">market</span> <span class="ow">in</span> <span class="n">markets</span><span class="p">:</span>
                            <span class="k">if</span> <span class="s2">&quot;!&quot;</span> <span class="ow">in</span> <span class="n">market</span><span class="p">:</span>
                                <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">market</span> <span class="o">+</span> <span class="n">final_channel</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">market</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">channel</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">params</span><span class="p">))</span>
                    <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_payload</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="s2">&quot;SUBSCRIBE&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;unsubscribe&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">markets</span><span class="p">:</span>
                    <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_payload() - `stream_list_lock` &quot;</span>
                                         <span class="sa">f</span><span class="s2">&quot;was entered!&quot;</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">]:</span>
                                <span class="k">if</span> <span class="s2">&quot;!&quot;</span> <span class="ow">in</span> <span class="n">channel</span><span class="p">:</span>
                                    <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel</span> <span class="o">+</span> <span class="n">final_market</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="k">for</span> <span class="n">market</span> <span class="ow">in</span> <span class="n">markets</span><span class="p">:</span>
                                        <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">market</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">channel</span><span class="p">)</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_payload() - Leaving &quot;</span>
                                         <span class="sa">f</span><span class="s2">&quot;`stream_list_lock`!&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_payload</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="s2">&quot;UNSUBSCRIBE&quot;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">if</span> <span class="n">channels</span><span class="p">:</span>
                    <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_payload() - `stream_list_lock` &quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot;was entered!&quot;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">market</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;markets&#39;</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="s2">&quot;!&quot;</span> <span class="ow">in</span> <span class="n">market</span><span class="p">:</span>
                                <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">market</span> <span class="o">+</span> <span class="n">final_channel</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
                                    <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">market</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">channel</span><span class="p">)</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_payload() - Leaving &quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot;`stream_list_lock`!&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_payload</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="s2">&quot;UNSUBSCRIBE&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.create_payload(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
                                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) - Allowed values for `method`: `subscribe` &quot;</span>
                                <span class="s2">&quot;or `unsubscribe`!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.create_payload(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) - Payload: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.create_payload(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) finished ...&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">payload</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.create_stream">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.create_stream">[docs]</a>
    <span class="k">def</span> <span class="nf">create_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">channels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">markets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">stream_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">stream_buffer_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">api_secret</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">symbols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">output</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;dict&#39;</span><span class="p">,</span> <span class="s1">&#39;raw_data&#39;</span><span class="p">,</span> <span class="s1">&#39;UnicornFy&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;raw_data&quot;</span><span class="p">,</span>
                      <span class="n">ping_interval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">ping_timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">close_timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">listen_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">keep_listen_key_alive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                      <span class="n">stream_buffer_maxlen</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">api</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                      <span class="n">process_stream_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">process_stream_data_async</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">process_asyncio_queue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a websocket stream</span>

<span class="sd">        If you provide 2 markets and 2 channels, then you are going to create 4 subscriptions (markets * channels).</span>

<span class="sd">            Example:</span>

<span class="sd">                channels = [&#39;trade&#39;, &#39;kline_1&#39;]</span>

<span class="sd">                markets = [&#39;bnbbtc&#39;, &#39;ethbtc&#39;]</span>

<span class="sd">                Finally:  bnbbtc@trade, ethbtc@trade, bnbbtc@kline_1, ethbtc@kline_1</span>

<span class="sd">        `There is a subscriptions limit per stream!</span>
<span class="sd">        &lt;https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api/wiki/Binance-websocket-endpoint-configuration-overview&gt;`_</span>

<span class="sd">        Create `!userData` streams as single streams, because it&#39;s using a different endpoint and can not get combined</span>
<span class="sd">        with other streams in a multiplexed stream!</span>

<span class="sd">            Example CEX:</span>

<span class="sd">                ``binance_websocket_api_manager.create_stream([&quot;arr&quot;], [&quot;!userData&quot;], api_key=&quot;aaa&quot;, api_secret=&quot;bbb&quot;)``</span>

<span class="sd">                Isolated Margin:</span>

<span class="sd">                ``binance_websocket_api_manager.create_stream([&quot;arr&quot;], [&quot;!userData&quot;], api_key=&quot;aaa&quot;, api_secret=&quot;bbb&quot;, symbols=&quot;ankrbtc&quot;)``</span>

<span class="sd">            Example DEX:</span>

<span class="sd">                ``binance_websocket_api_manager.create_stream([&#39;orders&#39;, &#39;transfers&#39;, &#39;accounts&#39;], binance_dex_user_address)``</span>

<span class="sd">        To create a multiplexed stream which includes also `!miniTicker@arr`, `!ticker@arr`, `!forceOrder@arr` or</span>
<span class="sd">        `!bookTicker@arr` you just need to add `!bookTicker` to the channels list - don&#39;t add `arr` (cex) or `$all`</span>
<span class="sd">        (dex) to the markets list.</span>

<span class="sd">            Example:</span>

<span class="sd">                ``binance_websocket_api_manager.create_stream([&#39;kline_5m&#39;, &#39;marketDepth&#39;, &#39;!miniTicker&#39;], [&#39;bnbbtc&#39;])``</span>

<span class="sd">        But you have to add `arr` or `$all` if you want to start it as a single stream!</span>

<span class="sd">            Example:</span>

<span class="sd">                ``binance_websocket_api_manager.create_stream([&quot;arr&quot;], [&quot;!miniTicker&quot;])``</span>

<span class="sd">        :param channels: provide the channels you wish to stream</span>
<span class="sd">        :type channels: str, tuple, list, set</span>
<span class="sd">        :param markets: provide the markets you wish to stream</span>
<span class="sd">        :type markets: str, tuple, list, set</span>
<span class="sd">        :param stream_label: provide a stream_label to identify the stream</span>
<span class="sd">        :type stream_label: str</span>
<span class="sd">        :param stream_buffer_name: If `False` the data is going to get written to the default stream_buffer,</span>
<span class="sd">                                   set to `True` to read the data via `pop_stream_data_from_stream_buffer(stream_id)` or</span>
<span class="sd">                                   provide a string to create and use a shared stream_buffer and read it via</span>
<span class="sd">                                   `pop_stream_data_from_stream_buffer(&#39;string&#39;)`.</span>
<span class="sd">        :type stream_buffer_name: bool or str</span>
<span class="sd">        :param api_key: provide a valid Binance API key</span>
<span class="sd">        :type api_key: str</span>
<span class="sd">        :param api_secret: provide a valid Binance API secret</span>
<span class="sd">        :type api_secret: str</span>
<span class="sd">        :param symbols: provide the symbols for isolated_margin user_data streams</span>
<span class="sd">        :type symbols: str</span>
<span class="sd">        :param output: the default setting `raw_data` can be globaly overwritten with the parameter</span>
<span class="sd">                       `output_default &lt;https://unicorn-binance-websocket-api.docs.lucit.tech/unicorn_binance_websocket_api.html?highlight=output_default#module-unicorn_binance_websocket_api.unicorn_binance_websocket_api_manager&gt;`_</span>
<span class="sd">                       of BinanceWebSocketApiManager`. To overrule the `output_default` value for this specific stream,</span>
<span class="sd">                       set `output` to &quot;dict&quot; to convert the received raw data to a python dict,  set to &quot;UnicornFy&quot; to</span>
<span class="sd">                       convert with `UnicornFy &lt;https://github.com/LUCIT-Systems-and-Development/unicorn-fy&gt;`_ -  otherwise with</span>
<span class="sd">                       the default setting &quot;raw_data&quot; the output remains unchanged and gets delivered as received from</span>
<span class="sd">                       the endpoints</span>
<span class="sd">        :type output: str</span>
<span class="sd">        :param ping_interval: Once the connection is open, a `Ping frame` is sent every</span>
<span class="sd">                              `ping_interval` seconds. This serves as a keepalive. It helps keeping</span>
<span class="sd">                              the connection open, especially in the presence of proxies with short</span>
<span class="sd">                              timeouts on inactive connections. Set `ping_interval` to `None` to</span>
<span class="sd">                              disable this behavior. (default: 20)</span>
<span class="sd">                              This parameter is passed through to the `websockets.client.connect()</span>
<span class="sd">                              &lt;https://websockets.readthedocs.io/en/stable/topics/timeouts.html?highlight=ping_interval#keepalive-in-websockets&gt;`_</span>
<span class="sd">        :type ping_interval: int or None</span>
<span class="sd">        :param ping_timeout: If the corresponding `Pong frame` isn&#39;t received within</span>
<span class="sd">                             `ping_timeout` seconds, the connection is considered unusable and is closed with</span>
<span class="sd">                             code 1011. This ensures that the remote endpoint remains responsive. Set</span>
<span class="sd">                             `ping_timeout` to `None` to disable this behavior. (default: 20)</span>
<span class="sd">                             This parameter is passed through to the `websockets.client.connect()</span>
<span class="sd">                             &lt;https://websockets.readthedocs.io/en/stable/topics/timeouts.html?highlight=ping_interval#keepalive-in-websockets&gt;`_</span>
<span class="sd">        :type ping_timeout: int or None</span>
<span class="sd">        :param close_timeout: The `close_timeout` parameter defines a maximum wait time in seconds for</span>
<span class="sd">                              completing the closing handshake and terminating the TCP connection. (default: 10)</span>
<span class="sd">                              This parameter is passed through to the `websockets.client.connect()</span>
<span class="sd">                              &lt;https://websockets.readthedocs.io/en/stable/topics/design.html?highlight=close_timeout#closing-handshake&gt;`_</span>
<span class="sd">        :type close_timeout: int or None</span>
<span class="sd">        :param keep_listen_key_alive: `True` (default) or `False`.</span>
<span class="sd">        :type keep_listen_key_alive: str</span>
<span class="sd">        :param listen_key: Provide the Binance listenKey for the userData stream.</span>
<span class="sd">        :type listen_key: str</span>
<span class="sd">        :param stream_buffer_maxlen: Set a max len for the `stream_buffer`. Only used in combination with a non-generic</span>
<span class="sd">                                     `stream_buffer`. The generic `stream_buffer` uses always the value of</span>
<span class="sd">                                     `BinanceWebSocketApiManager()`.</span>
<span class="sd">        :type stream_buffer_maxlen: int or None</span>
<span class="sd">        :param api: Setting this to `True` activates the creation of a Websocket API stream to send API requests via Websocket.</span>
<span class="sd">                    Needs `api_key` and `api_secret` in combination. This type of stream can not be combined with a UserData</span>
<span class="sd">                    stream or another public endpoint. (Default is `False`)</span>
<span class="sd">        :type api: bool</span>
<span class="sd">        :param process_stream_data: Provide a function/method to process the received webstream data (callback). The</span>
<span class="sd">                            function will be called instead of</span>
<span class="sd">                            `add_to_stream_buffer() &lt;unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.add_to_stream_buffer&gt;`_</span>
<span class="sd">                            like `process_stream_data(stream_data)` where</span>
<span class="sd">                            `stream_data` cointains the raw_stream_data. If not provided, the raw stream_data will</span>
<span class="sd">                            get stored in the stream_buffer or provided to the global callback function provided during</span>
<span class="sd">                            object instantiation! `How to read from stream_buffer!</span>
<span class="sd">                            &lt;https://unicorn-binance-websocket-api.docs.lucit.tech/README.html?highlight=pop_stream_data_from_stream_buffer#and-4-more-lines-to-print-the-receives&gt;`_</span>
<span class="sd">        :type process_stream_data: function</span>
<span class="sd">        :param process_stream_data_async: Provide an asynchronous function/method to process the received webstream data (callback). The</span>
<span class="sd">                            function will be called instead of</span>
<span class="sd">                            `add_to_stream_buffer() &lt;unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.add_to_stream_buffer&gt;`_</span>
<span class="sd">                            like `process_stream_data(stream_data)` where</span>
<span class="sd">                            `stream_data` cointains the raw_stream_data. If not provided, the raw stream_data will</span>
<span class="sd">                            get stored in the stream_buffer or provided to the global callback function provided during</span>
<span class="sd">                            object instantiation! `How to read from stream_buffer!</span>
<span class="sd">                            &lt;https://unicorn-binance-websocket-api.docs.lucit.tech/README.html?highlight=pop_stream_data_from_stream_buffer#and-4-more-lines-to-print-the-receives&gt;`_</span>
<span class="sd">        :type process_stream_data_async: function</span>
<span class="sd">        :param process_asyncio_queue: Insert your Asyncio function into the same AsyncIO loop in which the websocket data</span>
<span class="sd">                                      is received. This method guarantees the fastest possible asynchronous processing of</span>
<span class="sd">                                      the data in the correct receiving sequence.</span>
<span class="sd">                                      https://unicorn-binance-websocket-api.docs.lucit.tech/readme.html#or-await-the-webstream-data-in-an-asyncio-coroutine</span>
<span class="sd">        :type process_asyncio_queue: Optional[Callable]</span>

<span class="sd">        :return: stream_id or &#39;None&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">channels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">channels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">markets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">markets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># handle Websocket API streams: https://developers.binance.com/docs/binance-trading-api/websocket_api</span>
        <span class="k">if</span> <span class="n">api</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">api_key</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">api_secret</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_stream(api=</span><span class="si">{</span><span class="n">api</span><span class="si">}</span><span class="s2">) - `api_key` and `api_secret` are &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;mandatory if `api=True`&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># create an ordinary stream</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channels</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_stream(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
                             <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_label</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_buffer_name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span>
                             <span class="nb">str</span><span class="p">(</span><span class="n">stream_buffer_maxlen</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) - Parameter &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;`channels` must be str, tuple, list or a set!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">markets</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channels</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_stream(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
                                 <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_label</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_buffer_name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span>
                                 <span class="nb">str</span><span class="p">(</span><span class="n">stream_buffer_maxlen</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) - Parameter &quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;`markets` must be str, tuple, list or a set!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">channels</span> <span class="o">=</span> <span class="p">[</span><span class="n">channels</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">markets</span> <span class="o">=</span> <span class="p">[</span><span class="n">markets</span><span class="p">]</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">output</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_default</span>
        <span class="n">close_timeout</span> <span class="o">=</span> <span class="n">close_timeout</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">close_timeout_default</span>
        <span class="n">ping_interval</span> <span class="o">=</span> <span class="n">ping_interval</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">ping_interval_default</span>
        <span class="n">ping_timeout</span> <span class="o">=</span> <span class="n">ping_timeout</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">ping_timeout_default</span>
        <span class="n">provided_listen_key</span> <span class="o">=</span> <span class="n">listen_key</span>
        <span class="n">stream_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_uuid_id</span><span class="p">()</span>
        <span class="n">markets_new</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">stream_buffer_name</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">stream_buffer_name</span> <span class="o">=</span> <span class="n">stream_id</span>
        <span class="k">for</span> <span class="n">market</span> <span class="ow">in</span> <span class="n">markets</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;!&quot;</span> <span class="ow">in</span> <span class="n">market</span> \
                    <span class="ow">or</span> <span class="n">market</span> <span class="o">==</span> <span class="s2">&quot;allMiniTickers&quot;</span> \
                    <span class="ow">or</span> <span class="n">market</span> <span class="o">==</span> <span class="s2">&quot;allTickers&quot;</span> \
                    <span class="ow">or</span> <span class="n">market</span> <span class="o">==</span> <span class="s2">&quot;blockheight&quot;</span> \
                    <span class="ow">or</span> <span class="n">market</span> <span class="o">==</span> <span class="s2">&quot;$all&quot;</span><span class="p">:</span>
                <span class="n">markets_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">market</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_exchange_type</span><span class="p">(</span><span class="s1">&#39;dex&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[a-zA-Z0-9]{41,43}&#39;</span><span class="p">,</span> <span class="n">market</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">markets_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">market</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">markets_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">market</span><span class="p">))</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_exchange_type</span><span class="p">(</span><span class="s1">&#39;cex&#39;</span><span class="p">):</span>
                    <span class="n">markets_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">market</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.create_stream(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">markets_new</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_label</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_buffer_name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">+</span>
                    <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">api</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) with stream_id=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_stream_to_stream_list</span><span class="p">(</span><span class="n">stream_id</span><span class="p">,</span>
                                        <span class="n">channels</span><span class="p">,</span>
                                        <span class="n">markets_new</span><span class="p">,</span>
                                        <span class="n">stream_label</span><span class="p">,</span>
                                        <span class="n">stream_buffer_name</span><span class="p">,</span>
                                        <span class="n">symbols</span><span class="o">=</span><span class="n">symbols</span><span class="p">,</span>
                                        <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
                                        <span class="n">api_secret</span><span class="o">=</span><span class="n">api_secret</span><span class="p">,</span>
                                        <span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">,</span>
                                        <span class="n">ping_interval</span><span class="o">=</span><span class="n">ping_interval</span><span class="p">,</span>
                                        <span class="n">ping_timeout</span><span class="o">=</span><span class="n">ping_timeout</span><span class="p">,</span>
                                        <span class="n">close_timeout</span><span class="o">=</span><span class="n">close_timeout</span><span class="p">,</span>
                                        <span class="n">provided_listen_key</span><span class="o">=</span><span class="n">provided_listen_key</span><span class="p">,</span>
                                        <span class="n">keep_listen_key_alive</span><span class="o">=</span><span class="n">keep_listen_key_alive</span><span class="p">,</span>
                                        <span class="n">stream_buffer_maxlen</span><span class="o">=</span><span class="n">stream_buffer_maxlen</span><span class="p">,</span>
                                        <span class="n">api</span><span class="o">=</span><span class="n">api</span><span class="p">,</span>
                                        <span class="n">process_stream_data</span><span class="o">=</span><span class="n">process_stream_data</span><span class="p">,</span>
                                        <span class="n">process_stream_data_async</span><span class="o">=</span><span class="n">process_stream_data_async</span><span class="p">,</span>
                                        <span class="n">process_asyncio_queue</span><span class="o">=</span><span class="n">process_asyncio_queue</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_socket_is_not_ready</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_loops</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_create_stream_thread</span><span class="p">,</span>
                                  <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">stream_id</span><span class="p">,</span>
                                        <span class="n">channels</span><span class="p">,</span>
                                        <span class="n">markets_new</span><span class="p">,</span>
                                        <span class="n">stream_buffer_name</span><span class="p">,</span>
                                        <span class="n">stream_buffer_maxlen</span><span class="p">),</span>
                                  <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;_create_stream_thread:  stream_id=</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">, time=</span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_threads</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">thread</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_socket_ready</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_stop_request</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span> \
                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_crash_request</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span> \
                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;crashed&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">stream_id</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">high_performance</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_loops</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_loops</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span><span class="o">.</span><span class="n">is_closed</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">stream_id</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specific_process_asyncio_queue</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_stream(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2"> - Adding &quot;</span>
                         <span class="sa">f</span><span class="s2">&quot;`specific_process_asyncio_queue[</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">]()` to asyncio loop ...&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_event_loop_by_stream_id</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">asyncio</span><span class="o">.</span><span class="n">run_coroutine_threadsafe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_run_process_asyncio_queue</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">&quot;specific&quot;</span><span class="p">,</span>
                                                                                 <span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">),</span>
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">get_event_loop_by_stream_id</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_stream(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2"> - No valid asyncio loop!&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_asyncio_queue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># The global process_asyncio_queue can be overwritten by specific process stream (async) functions</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">specific_process_stream_data</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> \
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">specific_process_stream_data_async</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_stream(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2"> - &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;Adding `process_asyncio_queue()` to asyncio loop ...&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_event_loop_by_stream_id</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">asyncio</span><span class="o">.</span><span class="n">run_coroutine_threadsafe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_run_process_asyncio_queue</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">&quot;global&quot;</span><span class="p">,</span>
                                                                                     <span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">),</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">get_event_loop_by_stream_id</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_stream(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2"> - No valid asyncio loop!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stream_id</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.create_websocket_uri">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.create_websocket_uri">[docs]</a>
    <span class="k">def</span> <span class="nf">create_websocket_uri</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">markets</span><span class="p">,</span> <span class="n">stream_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">api</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a websocket URI</span>

<span class="sd">        :param channels: provide the channels to create the URI</span>
<span class="sd">        :type channels: str, tuple, list, set</span>
<span class="sd">        :param markets: provide the markets to create the URI</span>
<span class="sd">        :type markets: str, tuple, list, set</span>
<span class="sd">        :param stream_id: provide a stream_id - only needed for userData Streams (acquiring a listenKey)</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :param symbols: provide the symbols for isolated_margin user_data streams</span>
<span class="sd">        :type symbols: str</span>
<span class="sd">        :param api: Setting this to `True` activates the creation of a Websocket API stream to send API requests via</span>
<span class="sd">                    Websocket. Needs `api_key` and `api_secret` in combination. This type of stream can not be combined</span>
<span class="sd">                    with a UserData stream or another public endpoint. (Default is `False`)</span>
<span class="sd">        :type api: bool</span>
<span class="sd">        :return: str or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">api</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">api</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) - Created websocket URI for &quot;</span>
                        <span class="s2">&quot;stream_id=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; is &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">websocket_api_base_uri</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">websocket_api_base_uri</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channels</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri(</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                         <span class="sa">f</span><span class="s2">&quot;, </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span><span class="si">}</span><span class="s2">) - error_msg: Parameter `channels` must be str, tuple, list &quot;</span>
                         <span class="sa">f</span><span class="s2">&quot;or a set!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">markets</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri(</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                         <span class="sa">f</span><span class="s2">&quot;, </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span><span class="si">}</span><span class="s2">) - error_msg: Parameter `markets` must be str, tuple, list &quot;</span>
                         <span class="sa">f</span><span class="s2">&quot;or a set!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">channels</span> <span class="o">=</span> <span class="p">[</span><span class="n">channels</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">markets</span> <span class="o">=</span> <span class="p">[</span><span class="n">markets</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;!userData&quot;</span> <span class="ow">in</span> <span class="n">channels</span> <span class="ow">or</span> <span class="s2">&quot;!userData&quot;</span> <span class="ow">in</span> <span class="n">markets</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">stream_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;provided_listen_key&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">response</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;listenKey&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;provided_listen_key&#39;</span><span class="p">]}</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;listen_key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;listenKey&#39;</span><span class="p">])</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_listen_key_from_restclient</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1102</span> <span class="ow">or</span> \
                                <span class="n">response</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2008</span> <span class="ow">or</span> \
                                <span class="n">response</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2014</span> <span class="ow">or</span> \
                                <span class="n">response</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2015</span> <span class="ow">or</span> \
                                <span class="n">response</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">11001</span><span class="p">:</span>
                            <span class="c1"># -1102 = Mandatory parameter &#39;symbol&#39; was not sent, was empty/null, or malformed.</span>
                            <span class="c1"># -2008 = Invalid Api-Key ID</span>
                            <span class="c1"># -2014 = API-key format invalid</span>
                            <span class="c1"># -2015 = Invalid API-key, IP, or permissions for action</span>
                            <span class="c1"># -11001 = Isolated margin account does not exist.</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">+</span>
                                            <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) - Received known &quot;</span>
                                            <span class="s2">&quot;error code from rest client: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>
                            <span class="k">return</span> <span class="n">response</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">+</span>
                                            <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) - Received unknown &quot;</span>
                                            <span class="s2">&quot;error code from rest client: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>
                            <span class="k">return</span> <span class="n">response</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">if</span> <span class="n">response</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">uri</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">websocket_base_uri</span> <span class="o">+</span> <span class="s2">&quot;ws/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;listenKey&#39;</span><span class="p">])</span>
                            <span class="n">uri_hidden</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">websocket_base_uri</span> <span class="o">+</span> <span class="s2">&quot;ws/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">replacement_text</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_secrets_in_logs</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">+</span>
                                            <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) - result: &quot;</span> <span class="o">+</span> <span class="n">uri</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">+</span>
                                            <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) - result: &quot;</span> <span class="o">+</span>
                                            <span class="n">uri_hidden</span><span class="p">)</span>
                            <span class="n">subscriptions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_subscriptions</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>
                            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri() response - `stream_list_lock` &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;was entered!&quot;</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;subscriptions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subscriptions</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri() - Leaving &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;`stream_list_lock`&quot;</span><span class="p">)</span>
                            <span class="k">return</span> <span class="n">uri</span>
                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
                                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) - error_msg: can not &quot;</span>
                                            <span class="s2">&quot;create URI!!&quot;</span><span class="p">)</span>
                            <span class="k">return</span> <span class="kc">None</span>
                        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
                                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) - error_msg: can not &quot;</span>
                                            <span class="s2">&quot;create URI!!&quot;</span><span class="p">)</span>
                            <span class="k">return</span> <span class="kc">None</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span>
                                        <span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) - error_msg: can not create &quot;</span>
                                        <span class="s2">&quot;URI!!&quot;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span>
                                    <span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) - error_msg: can not create URI!!&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="s2">&quot;!bookTicker&quot;</span> <span class="ow">in</span> <span class="n">channels</span> <span class="ow">or</span> <span class="s2">&quot;!bookTicker&quot;</span> <span class="ow">in</span> <span class="n">markets</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">stream_id</span><span class="p">:</span>
                    <span class="n">subscriptions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_subscriptions</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>
                    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri() response - `stream_list_lock` &quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot;was entered!&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;subscriptions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subscriptions</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri() - Leaving &quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot;`stream_list_lock`&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">websocket_base_uri</span> <span class="o">+</span> <span class="s2">&quot;ws/!bookTicker&quot;</span>
            <span class="k">elif</span> <span class="s2">&quot;arr&quot;</span> <span class="ow">in</span> <span class="n">channels</span> <span class="ow">or</span> <span class="s2">&quot;$all&quot;</span> <span class="ow">in</span> <span class="n">markets</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">stream_id</span><span class="p">:</span>
                    <span class="n">subscriptions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_subscriptions</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>
                    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri() response - `stream_list_lock` &quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot;was entered!&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;subscriptions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subscriptions</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri() - Leaving &quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot;`stream_list_lock`&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">websocket_base_uri</span> <span class="o">+</span> <span class="s2">&quot;ws/&quot;</span> <span class="o">+</span> <span class="n">markets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="s2">&quot;arr&quot;</span> <span class="ow">in</span> <span class="n">markets</span> <span class="ow">or</span> <span class="s2">&quot;$all&quot;</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">stream_id</span><span class="p">:</span>
                    <span class="n">subscriptions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_subscriptions</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>
                    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri() response - `stream_list_lock` &quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot;was entered!&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;subscriptions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subscriptions</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri() - Leaving &quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot;`stream_list_lock`&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">websocket_base_uri</span> <span class="o">+</span> <span class="s2">&quot;ws/&quot;</span> <span class="o">+</span> <span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">markets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_exchange_type</span><span class="p">(</span><span class="s2">&quot;dex&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[a-zA-Z0-9]{41,43}&#39;</span><span class="p">,</span> <span class="n">markets</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;dex_user_address&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;dex_user_address&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">markets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;dex_user_address&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">markets</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) - Error: once set, the &quot;</span>
                                         <span class="s2">&quot;dex_user_address is not allowed to get changed anymore!&quot;</span><span class="p">)</span>
                            <span class="k">return</span> <span class="kc">None</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="n">add_payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;subscribe&quot;</span><span class="p">,</span>
                                   <span class="s2">&quot;topic&quot;</span><span class="p">:</span> <span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                   <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="n">markets</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span>
                    <span class="n">payload</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add_payload</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">stream_id</span><span class="p">:</span>
                        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;payload&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">payload</span>
                        <span class="n">subscriptions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_subscriptions</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>
                        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri() response - `stream_list_lock` &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;was entered!&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;subscriptions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subscriptions</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri() - Leaving &quot;</span>
                                         <span class="sa">f</span><span class="s2">&quot;`stream_list_lock`&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">websocket_base_uri</span> <span class="o">+</span> <span class="s2">&quot;ws/&quot;</span> <span class="o">+</span> <span class="n">markets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">markets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">websocket_base_uri</span> <span class="o">+</span> <span class="s2">&quot;ws/&quot;</span> <span class="o">+</span> <span class="n">markets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span>
                                 <span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) - Error: not able to create websocket &quot;</span>
                                 <span class="s2">&quot;URI for DEX&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_exchange_type</span><span class="p">(</span><span class="s2">&quot;dex&quot;</span><span class="p">):</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;ws&quot;</span>
            <span class="k">if</span> <span class="n">stream_id</span><span class="p">:</span>
                <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_payload</span><span class="p">(</span><span class="n">stream_id</span><span class="p">,</span> <span class="s2">&quot;subscribe&quot;</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="n">channels</span><span class="p">,</span> <span class="n">markets</span><span class="o">=</span><span class="n">markets</span><span class="p">)</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;payload&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">payload</span>
                <span class="n">subscriptions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_subscriptions</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri() response - `stream_list_lock` &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;was entered!&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;subscriptions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subscriptions</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri() - Leaving &quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;`stream_list_lock`&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">websocket_base_uri</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;stream?streams=&quot;</span>
            <span class="n">final_market</span> <span class="o">=</span> <span class="s2">&quot;@arr&quot;</span>
            <span class="n">market</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">market</span> <span class="ow">in</span> <span class="n">markets</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;arr@&quot;</span> <span class="ow">in</span> <span class="n">market</span><span class="p">:</span>
                    <span class="n">final_market</span> <span class="o">=</span> <span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">market</span>
            <span class="n">final_channel</span> <span class="o">=</span> <span class="s2">&quot;@arr&quot;</span>
            <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;arr@&quot;</span> <span class="ow">in</span> <span class="n">channel</span><span class="p">:</span>
                    <span class="n">final_channel</span> <span class="o">=</span> <span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">channel</span>
            <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;!userData&quot;</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span>
                                 <span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) - Can not create &quot;</span>
                                 <span class="s2">&quot;&#39;outboundAccountInfo&#39; in a multi channel socket! &quot;</span>
                                 <span class="s2">&quot;Unfortunately Binance only stream it in a single stream socket! ./&quot;</span>
                                 <span class="s2">&quot;Use create_stream([</span><span class="se">\&quot;</span><span class="s2">arr</span><span class="se">\&quot;</span><span class="s2">], [</span><span class="se">\&quot;</span><span class="s2">!userData</span><span class="se">\&quot;</span><span class="s2">]) to &quot;</span>
                                 <span class="s2">&quot;initiate an extra connection.&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">market</span> <span class="ow">in</span> <span class="n">markets</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">market</span> <span class="o">==</span> <span class="s2">&quot;!userData&quot;</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span>
                                 <span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) - Can not create &quot;</span>
                                 <span class="s2">&quot;&#39;outboundAccountInfo&#39; in a multi channel socket! &quot;</span>
                                 <span class="s2">&quot;Unfortunately Binance only stream it in a single stream socket! ./&quot;</span>
                                 <span class="s2">&quot;Use create_stream([</span><span class="se">\&quot;</span><span class="s2">arr</span><span class="se">\&quot;</span><span class="s2">], [</span><span class="se">\&quot;</span><span class="s2">!userData</span><span class="se">\&quot;</span><span class="s2">]) to &quot;</span>
                                 <span class="s2">&quot;initiate an extra connection.&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="s2">&quot;!&quot;</span> <span class="ow">in</span> <span class="n">channel</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">+=</span> <span class="n">channel</span> <span class="o">+</span> <span class="n">final_market</span>
            <span class="k">elif</span> <span class="s2">&quot;!&quot;</span> <span class="ow">in</span> <span class="n">market</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">+=</span> <span class="n">market</span> <span class="o">+</span> <span class="n">final_channel</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">+=</span> <span class="n">market</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">channel</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscribe_to_stream</span><span class="p">(</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">markets</span><span class="o">=</span><span class="n">markets</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="n">channels</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.create_websocket_uri(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) - Created websocket URI for stream_id=&quot;</span> <span class="o">+</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; is &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">websocket_base_uri</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">websocket_base_uri</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="p">)</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.delete_listen_key_by_stream_id">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.delete_listen_key_by_stream_id">[docs]</a>
    <span class="k">def</span> <span class="nf">delete_listen_key_by_stream_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete a binance listen_key from a specific !userData stream</span>

<span class="sd">        :param stream_id: id of a !userData stream</span>
<span class="sd">        :type stream_id: str</span>

<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;listen_key&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.delete_listen_key_by_stream_id(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>
                <span class="n">response</span><span class="p">,</span> <span class="n">binance_api_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restclient</span><span class="o">.</span><span class="n">delete_listen_key</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">binance_api_status</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">binance_api_status</span> <span class="o">=</span> <span class="n">binance_api_status</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ReadTimeout</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.delete_listen_key_by_stream_id() - Not able to delete &quot;</span>
                         <span class="sa">f</span><span class="s2">&quot;listen_key - requests.exceptions.ReadTimeout: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.delete_stream_from_stream_list">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.delete_stream_from_stream_list">[docs]</a>
    <span class="k">def</span> <span class="nf">delete_stream_from_stream_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete a stream from the stream_list</span>

<span class="sd">        Even if a stream crashes or get stopped, its data remains in the BinanceWebSocketApiManager till you stop the</span>
<span class="sd">        BinanceWebSocketApiManager itself. If you want to tidy up the stream_list you can use this method.</span>

<span class="sd">        :param stream_id: id of a stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :param timeout: The timeout for how long to wait for the stream to stop. The function aborts if the waiting</span>
<span class="sd">                        time is exceeded and returns False.</span>
<span class="sd">        :type timeout: float</span>

<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.delete_stream_from_stream_list(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;`BinanceWebSocketApiManager.delete_stream_from_stream_list()` is deprecated, use &quot;</span>
                       <span class="s2">&quot;`BinanceWebSocketApiManager.remove_all_data_of_stream_id()` instead!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_till_stream_has_stopped</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.delete_stream_from_stream_list() - `stream_list_lock` &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;was entered!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">stream_id</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.delete_stream_from_stream_list() - Leaving &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;`stream_list_lock`!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.remove_all_data_of_stream_id">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.remove_all_data_of_stream_id">[docs]</a>
    <span class="k">def</span> <span class="nf">remove_all_data_of_stream_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete all remaining data within the UBWA instance of a stopped stream.</span>

<span class="sd">        Even if a stream crashes or get stopped, its data remains in the BinanceWebSocketApiManager till you stop the</span>
<span class="sd">        BinanceWebSocketApiManager itself. If you want to tidy up the entire UBWA instance you can use this method.</span>

<span class="sd">        UnicornBinanceWebSocketApiManager accepts the parameter `auto_data_cleanup_stopped_streams`. If this is set</span>
<span class="sd">        to `True` (`auto_data_cleanup_stopped_streams=True`), the UBWA instance performs the cleanup with this function</span>
<span class="sd">        `remove_all_data_of_stream_id()` automatically and regularly.</span>

<span class="sd">        :param stream_id: id of a stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :param timeout: The timeout for how long to wait for the stream to stop. The function aborts if the waiting</span>
<span class="sd">                        time is exceeded and returns False.</span>
<span class="sd">        :type timeout: float</span>

<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.remove_all_data_of_stream_id(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">) started ...&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_till_stream_has_stopped</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.remove_all_data_of_stream_id() - `stream_list_lock` &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;was entered!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">stream_id</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.remove_all_data_of_stream_id() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_loops</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">specific_process_asyncio_queue</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">specific_process_stream_data</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">specific_process_stream_data_async</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket_is_ready</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_threads</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.remove_all_data_of_stream_id(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">) successfully finished!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.remove_all_data_of_stream_id(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">) timeout! Stream not &quot;</span>
                         <span class="sa">f</span><span class="s2">&quot;stopped!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.fill_up_space_left">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.fill_up_space_left">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fill_up_space_left</span><span class="p">(</span><span class="n">demand_of_chars</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">filling</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add whitespaces to `string` to a length of `demand_of_chars` on the left side</span>

<span class="sd">        :param demand_of_chars: how much chars does the string have to have?</span>
<span class="sd">        :type demand_of_chars: int</span>
<span class="sd">        :param string: the string that has to get filled up with spaces</span>
<span class="sd">        :type string: str</span>
<span class="sd">        :param filling: filling char (default: blank space)</span>
<span class="sd">        :type filling: str</span>
<span class="sd">        :return: the filled up string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blanks_pre</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">blanks_post</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">demand_of_blanks</span> <span class="o">=</span> <span class="n">demand_of_chars</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">string</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">blanks_pre</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">demand_of_blanks</span><span class="p">:</span>
            <span class="n">blanks_pre</span> <span class="o">+=</span> <span class="n">filling</span>
            <span class="n">blanks_post</span> <span class="o">=</span> <span class="n">filling</span>
        <span class="k">return</span> <span class="n">blanks_pre</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">+</span> <span class="n">blanks_post</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.fill_up_space_centered">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.fill_up_space_centered">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fill_up_space_centered</span><span class="p">(</span><span class="n">demand_of_chars</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">filling</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add whitespaces to `string` to a length of `demand_of_chars`</span>

<span class="sd">        :param demand_of_chars: how much chars does the string have to have?</span>
<span class="sd">        :type demand_of_chars: int</span>
<span class="sd">        :param string: the string that has to get filled up with spaces</span>
<span class="sd">        :type string: str</span>
<span class="sd">        :param filling: filling char (default: blank space)</span>
<span class="sd">        :type filling: str</span>
<span class="sd">        :return: the filled up string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blanks_pre</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">blanks_post</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">demand_of_blanks</span> <span class="o">=</span> <span class="n">demand_of_chars</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">string</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">blanks_pre</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">blanks_post</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">demand_of_blanks</span><span class="p">:</span>
            <span class="n">blanks_pre</span> <span class="o">+=</span> <span class="n">filling</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">blanks_pre</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">blanks_post</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">demand_of_blanks</span><span class="p">:</span>
                <span class="n">blanks_post</span> <span class="o">+=</span> <span class="n">filling</span>
        <span class="k">return</span> <span class="n">blanks_pre</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">+</span> <span class="n">blanks_post</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.fill_up_space_right">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.fill_up_space_right">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fill_up_space_right</span><span class="p">(</span><span class="n">demand_of_chars</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">filling</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add whitespaces to `string` to a length of `demand_of_chars` on the right side</span>

<span class="sd">        :param demand_of_chars: how much chars does the string have to have?</span>
<span class="sd">        :type demand_of_chars: int</span>
<span class="sd">        :param string: the string that has to get filled up with spaces</span>
<span class="sd">        :type string: str</span>
<span class="sd">        :param filling: filling char (default: blank space)</span>
<span class="sd">        :type filling: str</span>
<span class="sd">        :return: the filled up string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blanks_pre</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span>
        <span class="n">blanks_post</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">demand_of_blanks</span> <span class="o">=</span> <span class="n">demand_of_chars</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">blanks_post</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">demand_of_blanks</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">blanks_pre</span> <span class="o">=</span> <span class="n">filling</span>
            <span class="n">blanks_post</span> <span class="o">+=</span> <span class="n">filling</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">blanks_pre</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">+</span> <span class="n">blanks_post</span>
        <span class="k">return</span> <span class="n">string</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">demand_of_chars</span><span class="p">]</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_active_stream_list">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_active_stream_list">[docs]</a>
    <span class="k">def</span> <span class="nf">get_active_stream_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a list of all active streams</span>

<span class="sd">        :return: set or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get the stream_list without stopped and crashed streams</span>
        <span class="n">stream_list_with_active_streams</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_active_stream_list() - `stream_list_lock` &quot;</span>
                         <span class="sa">f</span><span class="s2">&quot;was entered!&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">stream_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;running&quot;</span><span class="p">:</span>
                    <span class="n">stream_list_with_active_streams</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_active_stream_list() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stream_list_with_active_streams</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">stream_list_with_active_streams</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_all_receives_last_second">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_all_receives_last_second">[docs]</a>
    <span class="k">def</span> <span class="nf">get_all_receives_last_second</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the number of all receives of the last second</span>

<span class="sd">        :return: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_receives_last_second</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">last_second_timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_all_receives_last_second() - `stream_list_lock` &quot;</span>
                         <span class="sa">f</span><span class="s2">&quot;was entered!&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">stream_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">all_receives_last_second</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;receives_statistic_last_second&#39;</span><span class="p">][</span><span class="s1">&#39;entries&#39;</span><span class="p">][</span>
                        <span class="n">last_second_timestamp</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_all_receives_last_second() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_receives_last_second</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_binance_api_status">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_binance_api_status">[docs]</a>
    <span class="k">def</span> <span class="nf">get_binance_api_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        `get_binance_api_status()` is obsolete and will be removed in future releases, please use `get_used_weight()`</span>
<span class="sd">        instead!</span>

<span class="sd">        :return: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;`get_binance_api_status()` is obsolete and will be removed in future releases, please use&quot;</span>
                       <span class="s2">&quot;`get_used_weight()` instead!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binance_api_status</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_debug_log">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_debug_log">[docs]</a>
    <span class="k">def</span> <span class="nf">get_debug_log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the debug log string.</span>

<span class="sd">        :return: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="n">debug_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; - called by </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_stack</span><span class="p">()[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">debug_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="n">debug_msg</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_timestamp">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_timestamp">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_timestamp</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a Binance conform Timestamp.</span>

<span class="sd">        :return: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_timestamp_unix">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_timestamp_unix">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_timestamp_unix</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a Binance conform Timestamp.</span>

<span class="sd">        :return: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_used_weight">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_used_weight">[docs]</a>
    <span class="k">def</span> <span class="nf">get_used_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get used_weight, last status_code and the timestamp of the last status update</span>

<span class="sd">        :return: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binance_api_status</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_current_receiving_speed">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_current_receiving_speed">[docs]</a>
    <span class="k">def</span> <span class="nf">get_current_receiving_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the receiving speed of the last second in Bytes</span>

<span class="sd">        :return: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="n">last_timestamp</span> <span class="o">=</span> <span class="n">current_timestamp</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;transfer_rate_per_second&#39;</span><span class="p">][</span><span class="s1">&#39;bytes&#39;</span><span class="p">][</span><span class="n">last_timestamp</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_current_receiving_speed() - `stream_list_lock` &quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;was entered!&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;transfer_rate_per_second&#39;</span><span class="p">][</span><span class="s1">&#39;speed&#39;</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;transfer_rate_per_second&#39;</span><span class="p">][</span><span class="s1">&#39;bytes&#39;</span><span class="p">][</span><span class="n">last_timestamp</span><span class="p">]</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_current_receiving_speed() - Leaving &quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;`stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">current_receiving_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;transfer_rate_per_second&#39;</span><span class="p">][</span><span class="s1">&#39;speed&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">current_receiving_speed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">current_receiving_speed</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_current_receiving_speed_global">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_current_receiving_speed_global">[docs]</a>
    <span class="k">def</span> <span class="nf">get_current_receiving_speed_global</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the receiving speed of the last second in Bytes from all streams!</span>

<span class="sd">        :return: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_receiving_speed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_current_receiving_speed_global() - `stream_list_lock` &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;was entered!&quot;</span><span class="p">)</span>
                <span class="n">temp_stream_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_current_receiving_speed_global() - Leaving &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;`stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_current_receiving_speed_global() - RuntimeError: &quot;</span>
                         <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_current_receiving_speed_global() - RuntimeError: &quot;</span>
                         <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">stream_id</span> <span class="ow">in</span> <span class="n">temp_stream_list</span><span class="p">:</span>
            <span class="n">current_receiving_speed</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_receiving_speed</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">current_receiving_speed</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_date_of_timestamp">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_date_of_timestamp">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_date_of_timestamp</span><span class="p">(</span><span class="n">timestamp</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a timestamp into a readable date/time format for humans</span>

<span class="sd">        :param timestamp: provide the timestamp you want to convert into a date</span>
<span class="sd">        :type timestamp: timestamp</span>
<span class="sd">        :return: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">date</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">, %H:%M:%S UTC&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">date</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_errors_from_endpoints">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_errors_from_endpoints">[docs]</a>
    <span class="k">def</span> <span class="nf">get_errors_from_endpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all the stored error messages from the ringbuffer sent by the endpoints.</span>

<span class="sd">        :return: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ringbuffer_error</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_event_loop_by_stream_id">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_event_loop_by_stream_id">[docs]</a>
    <span class="k">def</span> <span class="nf">get_event_loop_by_stream_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">asyncio</span><span class="o">.</span><span class="n">AbstractEventLoop</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the asyncio event loop used by a specific stream.</span>

<span class="sd">        :return: asyncio.AbstractEventLoop or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stream_id</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_loops</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_event_loop_by_stream_id() - KeyError - </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_exchange">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_exchange">[docs]</a>
    <span class="k">def</span> <span class="nf">get_exchange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the name of the used exchange like &quot;binance.com&quot; or &quot;binance.org-testnet&quot;</span>

<span class="sd">        :return: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_human_bytesize">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_human_bytesize">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_human_bytesize</span><span class="p">(</span><span class="n">amount_bytes</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert the bytes to something readable</span>

<span class="sd">        :param amount_bytes: amount of bytes</span>
<span class="sd">        :type amount_bytes: int</span>
<span class="sd">        :param suffix: add a string after</span>
<span class="sd">        :type suffix: str</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">amount_bytes</span> <span class="o">&gt;</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span><span class="mi">1024</span><span class="p">:</span>
            <span class="n">amount_bytes</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">amount_bytes</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; tB&quot;</span> <span class="o">+</span> <span class="n">suffix</span>
        <span class="k">elif</span> <span class="n">amount_bytes</span> <span class="o">&gt;</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>
            <span class="n">amount_bytes</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">amount_bytes</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; gB&quot;</span> <span class="o">+</span> <span class="n">suffix</span>
        <span class="k">elif</span> <span class="n">amount_bytes</span> <span class="o">&gt;</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>
            <span class="n">amount_bytes</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">amount_bytes</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; mB&quot;</span> <span class="o">+</span> <span class="n">suffix</span>
        <span class="k">elif</span> <span class="n">amount_bytes</span> <span class="o">&gt;</span> <span class="mi">1024</span><span class="p">:</span>
            <span class="n">amount_bytes</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">amount_bytes</span> <span class="o">/</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; kB&quot;</span> <span class="o">+</span> <span class="n">suffix</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">amount_bytes</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">amount_bytes</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; B&quot;</span> <span class="o">+</span> <span class="n">suffix</span>
        <span class="k">return</span> <span class="n">amount_bytes</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_human_uptime">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_human_uptime">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_human_uptime</span><span class="p">(</span><span class="n">uptime</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a timespan of seconds into hours, days, ...</span>

<span class="sd">        :param uptime: Uptime in seconds</span>
<span class="sd">        :type uptime: int</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">uptime</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span><span class="p">):</span>
            <span class="n">uptime_days</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">uptime</span> <span class="o">/</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span><span class="p">))</span>
            <span class="n">uptime_hours</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(((</span><span class="n">uptime</span> <span class="o">-</span> <span class="p">(</span><span class="n">uptime_days</span> <span class="o">*</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span><span class="p">)))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)))</span>
            <span class="n">uptime_minutes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">uptime</span> <span class="o">-</span> <span class="p">((</span><span class="n">uptime_days</span> <span class="o">*</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">uptime_hours</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)))</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)</span>
            <span class="n">uptime_seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                <span class="n">uptime</span> <span class="o">-</span> <span class="p">((</span><span class="n">uptime_days</span> <span class="o">*</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span><span class="p">))</span> <span class="o">+</span> <span class="p">((</span><span class="n">uptime_hours</span> <span class="o">*</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">uptime_minutes</span> <span class="o">*</span> <span class="mi">60</span><span class="p">))))</span>
            <span class="n">uptime</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uptime_days</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;d:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uptime_hours</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;h:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">uptime_minutes</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;m:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">uptime_seconds</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;s&quot;</span>
        <span class="k">elif</span> <span class="n">uptime</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">):</span>
            <span class="n">uptime_hours</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">uptime</span> <span class="o">/</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">))</span>
            <span class="n">uptime_minutes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">uptime</span> <span class="o">-</span> <span class="p">(</span><span class="n">uptime_hours</span> <span class="o">*</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)))</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)</span>
            <span class="n">uptime_seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">uptime</span> <span class="o">-</span> <span class="p">((</span><span class="n">uptime_hours</span> <span class="o">*</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">uptime_minutes</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)))</span>
            <span class="n">uptime</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uptime_hours</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;h:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">uptime_minutes</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;m:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">uptime_seconds</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;s&quot;</span>
        <span class="k">elif</span> <span class="n">uptime</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">uptime_minutes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">uptime</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)</span>
            <span class="n">uptime_seconds</span> <span class="o">=</span> <span class="n">uptime</span> <span class="o">-</span> <span class="n">uptime_minutes</span> <span class="o">*</span> <span class="mi">60</span>
            <span class="n">uptime</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uptime_minutes</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;m:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">uptime_seconds</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;s&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">uptime</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">uptime</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; seconds&quot;</span>
        <span class="k">return</span> <span class="n">uptime</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_latest_release_info">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_latest_release_info">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_latest_release_info</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get infos about the latest available release</span>

<span class="sd">        :return: dict or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">respond</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;https://api.github.com/repos/LUCIT-Systems-and-Development/&#39;</span>
                                   <span class="sa">f</span><span class="s1">&#39;unicorn-binance-websocket-api/releases/latest&#39;</span><span class="p">)</span>
            <span class="n">latest_release_info</span> <span class="o">=</span> <span class="n">respond</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">latest_release_info</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_latest_release_info_check_command">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_latest_release_info_check_command">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_latest_release_info_check_command</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get infos about the latest available `check_lucit_collector` release</span>
<span class="sd">        </span>
<span class="sd">        :return: dict or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">respond</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://api.github.com/repos/LUCIT-Development/check_lucit_collector.py/&#39;</span>
                                   <span class="s1">&#39;releases/latest&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">respond</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_latest_version">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_latest_version">[docs]</a>
    <span class="k">def</span> <span class="nf">get_latest_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the version of the latest available release (cache time 1 hour)</span>

<span class="sd">        :return: str or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Do a fresh request if status is None or last timestamp is older 1 hour</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_update_check_github</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_update_check_github</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_update_check_github</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_latest_release_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_update_check_github</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_update_check_github</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">][</span><span class="s1">&#39;tag_name&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;unknown&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;unknown&quot;</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_latest_version_check_command">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_latest_version_check_command">[docs]</a>
    <span class="k">def</span> <span class="nf">get_latest_version_check_command</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the version of the latest available `check_lucit_collector.py` release (cache time 1 hour)</span>
<span class="sd">        </span>
<span class="sd">        :return: str or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Do a fresh request if status is None or last timestamp is older 1 hour</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_update_check_github_check_command</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_update_check_github_check_command</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_update_check_github_check_command</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_latest_release_info_check_command</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_update_check_github_check_command</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_update_check_github_check_command</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">][</span><span class="s2">&quot;tag_name&quot;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;unknown&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;unknown&quot;</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_limit_of_subscriptions_per_stream">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_limit_of_subscriptions_per_stream">[docs]</a>
    <span class="k">def</span> <span class="nf">get_limit_of_subscriptions_per_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the number of allowed active subscriptions per stream (limit of binance API)</span>

<span class="sd">        :return: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_subscriptions_per_stream</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_number_of_all_subscriptions">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_number_of_all_subscriptions">[docs]</a>
    <span class="k">def</span> <span class="nf">get_number_of_all_subscriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the amount of all stream subscriptions</span>

<span class="sd">        :return: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">subscriptions</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">active_stream_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_active_stream_list</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">active_stream_list</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">stream_id</span> <span class="ow">in</span> <span class="n">active_stream_list</span><span class="p">:</span>
                    <span class="n">subscriptions</span> <span class="o">+=</span> <span class="n">active_stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;subscriptions&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">all_subscriptions_number</span> <span class="o">=</span> <span class="n">subscriptions</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_subscriptions_number</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_subscriptions_number</span>
        <span class="k">return</span> <span class="n">subscriptions</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_number_of_free_subscription_slots">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_number_of_free_subscription_slots">[docs]</a>
    <span class="k">def</span> <span class="nf">get_number_of_free_subscription_slots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the number of free subscription slots (max allowed subscriptions - subscriptions) of a specific stream</span>

<span class="sd">        :return: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">free_slots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_subscriptions_per_stream</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;subscriptions&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">free_slots</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_listen_key_from_restclient">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_listen_key_from_restclient">[docs]</a>
    <span class="k">def</span> <span class="nf">get_listen_key_from_restclient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a new or cached (&lt;30m) listen_key</span>

<span class="sd">        :param stream_id: provide a stream_id</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;listen_key_cache_time&#39;</span><span class="p">])</span> <span class="o">&gt;</span> \
                    <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;last_static_ping_listen_key&#39;</span><span class="p">]</span> <span class="o">+</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;listen_key_cache_time&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">():</span>
                <span class="c1"># listen_key is not older than 30 min</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;listen_key&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;listenKey&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;listen_key&#39;</span><span class="p">]}</span>
                    <span class="k">return</span> <span class="n">response</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_listen_key_from_restclient() - KeyError&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># no cached listen_key or listen_key is older than 30 min</span>
        <span class="c1"># acquire a new listen_key:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span><span class="p">,</span> <span class="n">binance_api_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restclient</span><span class="o">.</span><span class="n">get_listen_key</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">binance_api_status</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binance_api_status</span> <span class="o">=</span> <span class="n">binance_api_status</span>
        <span class="k">except</span> <span class="ne">ResourceWarning</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_listen_key_from_restclient() - ResourceWarning: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">response</span><span class="p">:</span>
            <span class="c1"># save and return the valid listen_key</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_listen_key_from_restclient() - `stream_list_lock` &quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;was entered!&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;listen_key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;listenKey&#39;</span><span class="p">])</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_listen_key_from_restclient() - Leaving &quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;`stream_list_lock`!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="c1"># no valid listen_key, but a response from endpoint</span>
                <span class="k">return</span> <span class="n">response</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">response</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># no valid listen_key</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_most_receives_per_second">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_most_receives_per_second">[docs]</a>
    <span class="k">def</span> <span class="nf">get_most_receives_per_second</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the highest total receives per second value</span>

<span class="sd">        :return: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">most_receives_per_second</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_number_of_streams_in_stream_list">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_number_of_streams_in_stream_list">[docs]</a>
    <span class="k">def</span> <span class="nf">get_number_of_streams_in_stream_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the number of streams that are stored in the stream_list</span>

<span class="sd">        :return: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">)</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_number_of_subscriptions">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_number_of_subscriptions">[docs]</a>
    <span class="k">def</span> <span class="nf">get_number_of_subscriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the number of subscriptions of a specific stream</span>

<span class="sd">        :return: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">count_subscriptions</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_number_of_subscriptions() - `stream_list_lock` &quot;</span>
                         <span class="sa">f</span><span class="s2">&quot;was entered!&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="s2">&quot;!&quot;</span> <span class="ow">in</span> <span class="n">channel</span> \
                        <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;orders&quot;</span> \
                        <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;accounts&quot;</span> \
                        <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;transfers&quot;</span> \
                        <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;allTickers&quot;</span> \
                        <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;allMiniTickers&quot;</span> \
                        <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;blockheight&quot;</span><span class="p">:</span>
                    <span class="n">count_subscriptions</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">market</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;markets&#39;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="s2">&quot;!&quot;</span> <span class="ow">in</span> <span class="n">market</span> \
                                <span class="ow">or</span> <span class="n">market</span> <span class="o">==</span> <span class="s2">&quot;orders&quot;</span> \
                                <span class="ow">or</span> <span class="n">market</span> <span class="o">==</span> <span class="s2">&quot;accounts&quot;</span> \
                                <span class="ow">or</span> <span class="n">market</span> <span class="o">==</span> <span class="s2">&quot;transfers&quot;</span> \
                                <span class="ow">or</span> <span class="n">market</span> <span class="o">==</span> <span class="s2">&quot;allTickers&quot;</span> \
                                <span class="ow">or</span> <span class="n">market</span> <span class="o">==</span> <span class="s2">&quot;allMiniTickers&quot;</span> \
                                <span class="ow">or</span> <span class="n">market</span> <span class="o">==</span> <span class="s2">&quot;blockheight&quot;</span><span class="p">:</span>
                            <span class="n">count_subscriptions</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">count_subscriptions</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_number_of_subscriptions() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">count_subscriptions</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_keep_max_received_last_second_entries">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_keep_max_received_last_second_entries">[docs]</a>
    <span class="k">def</span> <span class="nf">get_keep_max_received_last_second_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the number of how much received_last_second entries are stored till they get deleted</span>

<span class="sd">        :return: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_max_received_last_second_entries</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_monitoring_status_icinga">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_monitoring_status_icinga">[docs]</a>
    <span class="k">def</span> <span class="nf">get_monitoring_status_icinga</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">check_command_version</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">warn_on_update</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get status and perfdata to monitor and collect metrics with ICINGA/Nagios</span>

<span class="sd">        status: OK, WARNING, CRITICAL</span>
<span class="sd">        - WARNING: on restarts, available updates</span>
<span class="sd">        - CRITICAL: crashed streams</span>

<span class="sd">        perfdata:</span>
<span class="sd">        - average receives per second since last status check</span>
<span class="sd">        - average speed per second since last status check</span>
<span class="sd">        - total received bytes since start</span>
<span class="sd">        - total received length since start</span>
<span class="sd">        - stream_buffer size</span>
<span class="sd">        - stream_buffer length</span>
<span class="sd">        - reconnects</span>
<span class="sd">        - uptime</span>

<span class="sd">        :param check_command_version: is the version of the calling `check_command &lt;https://github.com/LUCIT-Systems-and-Development/check_lucit_collector.py&gt;`_</span>
<span class="sd">        :type check_command_version: str</span>
<span class="sd">        :param warn_on_update: set to `False` to disable the update warning</span>
<span class="sd">        :type warn_on_update: bool</span>
<span class="sd">        :return: dict (text, time, return_code)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_monitoring_status_plain</span><span class="p">(</span><span class="n">check_command_version</span><span class="o">=</span><span class="n">check_command_version</span><span class="p">,</span>
                                                  <span class="n">warn_on_update</span><span class="o">=</span><span class="n">warn_on_update</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;update_msg&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;status_msg&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">text_msg</span> <span class="o">=</span> <span class="s2">&quot; -&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;status_msg&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;update_msg&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">text_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">check_message</span> <span class="o">=</span> <span class="s2">&quot;BINANCE WEBSOCKETS (&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span> <span class="o">+</span> <span class="s2">&quot;) - &quot;</span> <span class="o">+</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;status_text&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;: O:&quot;</span> <span class="o">+</span> \
                        <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;active_streams&#39;</span><span class="p">])</span> <span class="o">+</span> \
                        <span class="s2">&quot;/R:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;restarting_streams&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;/C:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;crashed_streams&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;/S:&quot;</span> <span class="o">+</span> \
                        <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;stopped_streams&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">text_msg</span> <span class="o">+</span> <span class="s2">&quot; | &quot;</span> <span class="o">+</span> \
                        <span class="s2">&quot;active streams=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;active_streams&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;;;;0 &quot;</span> <span class="o">+</span> \
                        <span class="s2">&quot;average_receives_per_second=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;average_receives_per_second&#39;</span><span class="p">])</span> <span class="o">+</span> \
                        <span class="s2">&quot;;;;0 current_receiving_speed_per_second=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;average_speed_per_second&#39;</span><span class="p">])</span> <span class="o">+</span> \
                        <span class="s2">&quot;KB;;;0 total_received_length=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;total_received_length&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;c;;;0 total_&quot;</span> \
                        <span class="s2">&quot;received_size=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;total_received_mb&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;MB;;;0 stream_buffer_size=&quot;</span> <span class="o">+</span> \
                        <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;stream_buffer_mb&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;MB;;;0 stream_buffer_length=&quot;</span> <span class="o">+</span> \
                        <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;stream_buffer_items&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;;;;0 reconnects=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;reconnects&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;c;;;0 &quot;</span> \
                        <span class="s2">&quot;uptime_days=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;uptime&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;c;;;0&quot;</span>
        <span class="n">status</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">check_message</span><span class="p">,</span>
                  <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]),</span>
                  <span class="s1">&#39;return_code&#39;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;return_code&#39;</span><span class="p">]}</span>
        <span class="k">return</span> <span class="n">status</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_monitoring_status_plain">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_monitoring_status_plain">[docs]</a>
    <span class="k">def</span> <span class="nf">get_monitoring_status_plain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">check_command_version</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">warn_on_update</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get plain monitoring status data:</span>
<span class="sd">        active_streams, crashed_streams, restarting_streams, stopped_streams, return_code, status_text,</span>
<span class="sd">        timestamp, update_msg, average_receives_per_second, average_speed_per_second, total_received_mb,</span>
<span class="sd">        stream_buffer_items, stream_buffer_mb, reconnects, uptime</span>

<span class="sd">        :param check_command_version: is the version of the calling `check_command &lt;https://github.com/LUCIT-Systems-and-Development/check_lucit_collector.py&gt;`_</span>
<span class="sd">        :type check_command_version: False or str</span>
<span class="sd">        :param warn_on_update: set to `False` to disable the update warning</span>
<span class="sd">        :type warn_on_update: bool</span>
<span class="sd">        :return: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;active_streams&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;crashed_streams&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;restarting_streams&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;highest_restart_per_stream_last_hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;return_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;status_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;OK&quot;</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;status_msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;stopped_streams&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;update_msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">time_period</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_monitoring_check</span>
        <span class="n">timestamp_last_hour</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">unicorn_fy.unicorn_fy</span> <span class="kn">import</span> <span class="n">UnicornFy</span>
            <span class="n">unicorn_fy</span> <span class="o">=</span> <span class="n">UnicornFy</span><span class="p">()</span>
            <span class="n">is_update_available_unicorn_fy</span> <span class="o">=</span> <span class="n">unicorn_fy</span><span class="o">.</span><span class="n">is_update_available</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.get_monitoring_status_plain() - UnicornFy not installed!&quot;</span><span class="p">)</span>
            <span class="n">is_update_available_unicorn_fy</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.get_monitoring_status_plain() - UnicornFy outdated!&quot;</span><span class="p">)</span>
            <span class="n">is_update_available_unicorn_fy</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">check_command_version</span><span class="p">:</span>
            <span class="n">is_update_available_check_command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_update_availabe_check_command</span><span class="p">(</span>
                                                                    <span class="n">check_command_version</span><span class="o">=</span><span class="n">check_command_version</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">is_update_available_check_command</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_monitoring_status_plain() - `stream_list_lock` &quot;</span>
                         <span class="sa">f</span><span class="s2">&quot;was entered!&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">stream_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">:</span>
                <span class="n">stream_restarts_last_hour</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">reconnect</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;logged_reconnects&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">reconnect</span> <span class="o">&gt;</span> <span class="n">timestamp_last_hour</span><span class="p">:</span>
                        <span class="n">stream_restarts_last_hour</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">stream_restarts_last_hour</span> <span class="o">&gt;</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;highest_restart_per_stream_last_hour&#39;</span><span class="p">]:</span>
                    <span class="n">result</span><span class="p">[</span><span class="s1">&#39;highest_restart_per_stream_last_hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stream_restarts_last_hour</span>
            <span class="k">for</span> <span class="n">stream_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;running&quot;</span><span class="p">:</span>
                    <span class="n">result</span><span class="p">[</span><span class="s1">&#39;active_streams&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;stopped&quot;</span><span class="p">:</span>
                    <span class="n">result</span><span class="p">[</span><span class="s1">&#39;stopped_streams&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;restarting&quot;</span><span class="p">:</span>
                    <span class="n">result</span><span class="p">[</span><span class="s1">&#39;restarting_streams&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="s2">&quot;crashed&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]:</span>
                    <span class="n">result</span><span class="p">[</span><span class="s1">&#39;crashed_streams&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_monitoring_status_plain() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_update_available</span><span class="p">()</span> <span class="ow">and</span> <span class="n">is_update_available_unicorn_fy</span> <span class="ow">and</span> <span class="n">is_update_available_check_command</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;update_msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; Update available: UNICORN Binance WebSocket API, UnicornFy and &quot;</span> \
                                   <span class="s2">&quot;check_lucit_collector.py!&quot;</span>
            <span class="k">if</span> <span class="n">warn_on_update</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="s1">&#39;status_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;WARNING&quot;</span>
                <span class="n">result</span><span class="p">[</span><span class="s1">&#39;return_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_update_available</span><span class="p">()</span> <span class="ow">and</span> <span class="n">is_update_available_unicorn_fy</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;update_msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; Update available: UNICORN Binance WebSocket API and UnicornFy&quot;</span>
            <span class="k">if</span> <span class="n">warn_on_update</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="s1">&#39;status_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;WARNING&quot;</span>
                <span class="n">result</span><span class="p">[</span><span class="s1">&#39;return_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_update_available</span><span class="p">()</span> <span class="ow">and</span> <span class="n">is_update_available_check_command</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;update_msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; Update available: UNICORN Binance WebSocket API and check_lucit_collector.py!&quot;</span>
            <span class="k">if</span> <span class="n">warn_on_update</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="s1">&#39;status_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;WARNING&quot;</span>
                <span class="n">result</span><span class="p">[</span><span class="s1">&#39;return_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">is_update_available_unicorn_fy</span> <span class="ow">and</span> <span class="n">is_update_available_check_command</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;update_msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; Update available: UnicornFy and check_lucit_collector.py!&quot;</span>
            <span class="k">if</span> <span class="n">warn_on_update</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="s1">&#39;status_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;WARNING&quot;</span>
                <span class="n">result</span><span class="p">[</span><span class="s1">&#39;return_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_update_available</span><span class="p">():</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;update_msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; Update &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_latest_version</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot; available!&quot;</span>
            <span class="k">if</span> <span class="n">warn_on_update</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="s1">&#39;status_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;WARNING&quot;</span>
                <span class="n">result</span><span class="p">[</span><span class="s1">&#39;return_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">is_update_available_unicorn_fy</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;update_msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; Update UnicornFy &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">unicorn_fy</span><span class="o">.</span><span class="n">get_latest_version</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot; available!&quot;</span>
            <span class="k">if</span> <span class="n">warn_on_update</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="s1">&#39;status_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;WARNING&quot;</span>
                <span class="n">result</span><span class="p">[</span><span class="s1">&#39;return_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">is_update_available_check_command</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;update_msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; Update `check_lucit_collector.py` &quot;</span> <span class="o">+</span> \
                                   <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_latest_version_check_command</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot; available!&quot;</span>
            <span class="k">if</span> <span class="n">warn_on_update</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="s1">&#39;status_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;WARNING&quot;</span>
                <span class="n">result</span><span class="p">[</span><span class="s1">&#39;return_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;highest_restart_per_stream_last_hour&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;status_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;CRITICAL&quot;</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;return_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;status_msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; Restart rate per stream last hour: &quot;</span> <span class="o">+</span> \
                                   <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;highest_restart_per_stream_last_hour&#39;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;crashed_streams&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;status_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;CRITICAL&quot;</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;return_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;highest_restart_per_stream_last_hour&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;status_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;WARNING&quot;</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;return_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;status_msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; Restart rate per stream last hour: &quot;</span> <span class="o">+</span> \
                                   <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;highest_restart_per_stream_last_hour&#39;</span><span class="p">])</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;average_receives_per_second&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">total_receives</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitoring_total_receives</span><span class="p">)</span> <span class="o">/</span>
                                                 <span class="n">time_period</span><span class="p">)</span><span class="o">.</span><span class="fm">__round__</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;average_speed_per_second&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="bp">self</span><span class="o">.</span><span class="n">total_received_bytes</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitoring_total_received_bytes</span><span class="p">)</span> <span class="o">/</span>
                                               <span class="n">time_period</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span><span class="p">)</span><span class="o">.</span><span class="fm">__round__</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;total_received_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_total_received_bytes</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">))</span><span class="o">.</span><span class="fm">__round__</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;total_received_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_receives</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;stream_buffer_items&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_stream_buffer_length</span><span class="p">())</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;stream_buffer_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_stream_buffer_byte_size</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">))</span><span class="o">.</span><span class="fm">__round__</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;reconnects&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reconnects</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">monitoring_total_receives</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_total_receives</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">monitoring_total_received_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_total_received_bytes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_monitoring_check</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;uptime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span><span class="p">))</span><span class="o">.</span><span class="fm">__round__</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_new_uuid_id">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_new_uuid_id">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_new_uuid_id</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a new unique uuid in string format. This is used as &#39;stream_id&#39; or &#39;socket_id&#39;.</span>

<span class="sd">        :return: uuid (str)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stream_id</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span>
        <span class="n">new_id_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="n">new_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_id_hash</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">new_id_hash</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">16</span><span class="p">]</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">new_id_hash</span><span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">new_id_hash</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="mi">24</span><span class="p">]</span><span class="si">}</span><span class="s2">-&quot;</span> \
                 <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_id_hash</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">32</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_id</span><span class="p">)</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_process_usage_memory">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_process_usage_memory">[docs]</a>
    <span class="k">def</span> <span class="nf">get_process_usage_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the used memory of this process</span>

<span class="sd">        :return: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
        <span class="n">memory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_human_bytesize</span><span class="p">(</span><span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">memory</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_process_usage_cpu">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_process_usage_cpu">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_process_usage_cpu</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the used cpu power of this process</span>

<span class="sd">        :return: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cpu</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_percent</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_process_usage_cpu() - OSError - error_msg: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">cpu</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_process_usage_threads">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_process_usage_threads">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_process_usage_threads</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the amount of threads that this process is using</span>

<span class="sd">        :return: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">threads</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">active_count</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">threads</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_reconnects">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_reconnects">[docs]</a>
    <span class="k">def</span> <span class="nf">get_reconnects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the number of total reconnects</span>

<span class="sd">        :return: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconnects</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_request_id">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_request_id">[docs]</a>
    <span class="k">def</span> <span class="nf">get_request_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a unique `request_id`</span>

<span class="sd">        :return: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_id_lock</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_monitoring_status_plain() - `stream_list_lock` &quot;</span>
                         <span class="sa">f</span><span class="s2">&quot;was entered!&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_result_by_request_id">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_result_by_request_id">[docs]</a>
    <span class="k">def</span> <span class="nf">get_result_by_request_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the result related to the provided `request_id`</span>

<span class="sd">        :param request_id: if you run `get_stream_subscriptions()</span>
<span class="sd">                           &lt;https://unicorn-binance-websocket-api.docs.lucit.tech/unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_stream_subscriptions&gt;`_</span>
<span class="sd">                           it returns a unique `request_id` - provide it to this method to receive the result.</span>
<span class="sd">        :type request_id: stream_id (uuid)</span>
<span class="sd">        :param timeout: seconds to wait to receive the result. If not there it returns &#39;False&#39;</span>
<span class="sd">        :type timeout: int</span>
<span class="sd">        :return: `result` or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">request_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">wait_till_timestamp</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">timeout</span>
        <span class="k">while</span> <span class="n">wait_till_timestamp</span> <span class="o">&gt;=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ringbuffer_result</span><span class="p">:</span>
                <span class="n">result_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">result_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">request_id</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">result</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_results_from_endpoints">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_results_from_endpoints">[docs]</a>
    <span class="k">def</span> <span class="nf">get_results_from_endpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all the stored result messages from the ringbuffer sent by the endpoints.</span>

<span class="sd">        :return: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ringbuffer_result</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_ringbuffer_error_max_size">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_ringbuffer_error_max_size">[docs]</a>
    <span class="k">def</span> <span class="nf">get_ringbuffer_error_max_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        How many entries should be stored in the ringbuffer?</span>

<span class="sd">        :return: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ringbuffer_error_max_size</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_ringbuffer_result_max_size">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_ringbuffer_result_max_size">[docs]</a>
    <span class="k">def</span> <span class="nf">get_ringbuffer_result_max_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        How many entries should be stored in the ringbuffer?</span>

<span class="sd">        :return: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ringbuffer_result_max_size</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_start_time">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_start_time">[docs]</a>
    <span class="k">def</span> <span class="nf">get_start_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the start_time of the  BinanceWebSocketApiManager instance</span>

<span class="sd">        :return: timestamp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_stream_buffer_byte_size">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_stream_buffer_byte_size">[docs]</a>
    <span class="k">def</span> <span class="nf">get_stream_buffer_byte_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the current byte size estimation of the stream_buffer</span>

<span class="sd">        :return: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">total_received_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_total_received_bytes</span><span class="p">()</span>
        <span class="n">total_receives</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_total_receives</span><span class="p">()</span>
        <span class="n">stream_buffer_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stream_buffer_length</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">total_received_bytes</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">total_receives</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">total_received_bytes</span> <span class="o">/</span> <span class="n">total_receives</span> <span class="o">*</span> <span class="n">stream_buffer_length</span><span class="p">)</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_stream_buffer_length">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_stream_buffer_length">[docs]</a>
    <span class="k">def</span> <span class="nf">get_stream_buffer_length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_buffer_name</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the current number of items in all stream_buffer or of a specific stream_buffer</span>

<span class="sd">        :param stream_buffer_name: Name of the stream_buffer</span>
<span class="sd">        :type stream_buffer_name: str or stream_id</span>
<span class="sd">        :return: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">stream_buffer_name</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_buffers</span><span class="p">[</span><span class="n">stream_buffer_name</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_stream_buffer_length() - KeyError - &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;error_msg: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">number</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_buffer</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">stream_buffer_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_buffers</span><span class="p">:</span>
                <span class="n">number</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_buffers</span><span class="p">[</span><span class="n">stream_buffer_name</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">number</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_stream_id_by_label">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_stream_id_by_label">[docs]</a>
    <span class="k">def</span> <span class="nf">get_stream_id_by_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the stream_id of a specific stream by stream label</span>

<span class="sd">        :param stream_label: stream_label of the stream you search</span>
<span class="sd">        :type stream_label: str</span>
<span class="sd">        :return: stream_id or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stream_label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_stream_id_by_label() - `stream_list_lock` &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;was entered!&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">stream_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;stream_label&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">stream_label</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_stream_id_by_label() - Found `stream_id` via &quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot;`stream_label` `</span><span class="si">{</span><span class="n">stream_label</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="n">stream_id</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_stream_id_by_label() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_stream_id_by_label() - No `stream_id` found via `stream_label` &quot;</span>
                     <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">stream_label</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_stream_info">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_stream_info">[docs]</a>
    <span class="k">def</span> <span class="nf">get_stream_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all infos about a specific stream</span>

<span class="sd">        :param stream_id: id of a stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :return: set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_timestamp</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_stream_info() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
                <span class="n">temp_stream_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">])</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_stream_info() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.get_stream_info(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) Info: RuntimeError&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stream_info</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.get_stream_info(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) Info: KeyError&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">temp_stream_list</span><span class="p">[</span><span class="s1">&#39;last_heartbeat&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">temp_stream_list</span><span class="p">[</span><span class="s1">&#39;seconds_to_last_heartbeat&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">current_timestamp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;last_heartbeat&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">temp_stream_list</span><span class="p">[</span><span class="s1">&#39;has_stopped&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">temp_stream_list</span><span class="p">[</span><span class="s1">&#39;seconds_since_has_stopped&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="nb">int</span><span class="p">(</span><span class="n">current_timestamp</span><span class="p">)</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;has_stopped&#39;</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_stream_info() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;processed_receives_statistic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stream_statistic</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_stream_info() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">current_receiving_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_receiving_speed</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_stream_info() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;transfer_rate_per_second&#39;</span><span class="p">][</span><span class="s1">&#39;speed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_receiving_speed</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_stream_info() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">temp_stream_list</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_stream_label">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_stream_label">[docs]</a>
    <span class="k">def</span> <span class="nf">get_stream_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the stream_label of a specific stream</span>

<span class="sd">        :param stream_id: id of a stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :return: str or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stream_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;stream_label&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_stream_subscriptions">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_stream_subscriptions">[docs]</a>
    <span class="k">def</span> <span class="nf">get_stream_subscriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">,</span> <span class="n">request_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a list of subscriptions of a specific stream from Binance endpoints - the result can be received via</span>
<span class="sd">        the `stream_buffer` and is also added to the results ringbuffer - `get_results_from_endpoints()</span>
<span class="sd">        &lt;https://unicorn-binance-websocket-api.docs.lucit.tech/unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_results_from_endpoints&gt;`_</span>
<span class="sd">        to get all results or use `get_result_by_request_id(request_id)</span>
<span class="sd">        &lt;https://unicorn-binance-websocket-api.docs.lucit.tech/unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_result_by_request_id&gt;`_</span>
<span class="sd">        to get a specific one!</span>

<span class="sd">        This function is supported by CEX endpoints only!</span>

<span class="sd">        Info: https://github.com/binance-exchange/binance-official-api-docs/blob/master/web-socket-streams.md#listing-subscriptions</span>

<span class="sd">        :param stream_id: id of a stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :param request_id: id to use for the request - use `get_request_id()` to create a unique id. If not provided or</span>
<span class="sd">                           `False`, then this method is using `get_request_id()</span>
<span class="sd">                           &lt;https://unicorn-binance-websocket-api.docs.lucit.tech/unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_request_id&gt;`_</span>
<span class="sd">                           automatically.</span>
<span class="sd">        :type request_id: int</span>
<span class="sd">        :return: request_id (int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">request_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">request_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_request_id</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_exchange_type</span><span class="p">(</span><span class="s1">&#39;dex&#39;</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.get_stream_subscriptions(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span>
                         <span class="nb">str</span><span class="p">(</span><span class="n">request_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) DEX websockets dont support the listing of subscriptions! Request not &quot;</span>
                         <span class="s2">&quot;sent!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_exchange_type</span><span class="p">(</span><span class="s1">&#39;cex&#39;</span><span class="p">):</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;LIST_SUBSCRIPTIONS&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">request_id</span><span class="p">}</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_stream_subscriptions() - `stream_list_lock` was &quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;entered!&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;payload&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_stream_subscriptions() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.get_stream_subscriptions(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">request_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) payload added!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">request_id</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_stream_list">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_stream_list">[docs]</a>
    <span class="k">def</span> <span class="nf">get_stream_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a list of all streams</span>

<span class="sd">        :return: set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">temp_stream_list</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">stream_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">:</span>
            <span class="n">temp_stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stream_info</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">temp_stream_list</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_stream_buffer_maxlen">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_stream_buffer_maxlen">[docs]</a>
    <span class="k">def</span> <span class="nf">get_stream_buffer_maxlen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_buffer_name</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the maxlen value of the</span>
<span class="sd">        `stream_buffer &lt;https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api/wiki/%60stream_buffer%60&gt;`_</span>

<span class="sd">        If maxlen is not specified or is None, `stream_buffer` may grow to an arbitrary length. Otherwise, the</span>
<span class="sd">        `stream_buffer` is bounded to the specified maximum length. Once a bounded length `stream_buffer` is full, when</span>
<span class="sd">        new items are added, a corresponding number of items are discarded from the opposite end.</span>

<span class="sd">        :param stream_buffer_name: `False` to read from generic stream_buffer, the stream_id if you used True in</span>
<span class="sd">                                   create_stream() or the string name of a shared stream_buffer.</span>
<span class="sd">        :type stream_buffer_name: bool or str</span>
<span class="sd">        :return: int or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stream_buffer_name</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_buffer</span><span class="o">.</span><span class="n">maxlen</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_buffers</span><span class="p">[</span><span class="n">stream_buffer_name</span><span class="p">]</span><span class="o">.</span><span class="n">maxlen</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_stream_receives_last_second">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_stream_receives_last_second">[docs]</a>
    <span class="k">def</span> <span class="nf">get_stream_receives_last_second</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the number of receives of specific stream from the last seconds</span>

<span class="sd">        :param stream_id: id of a stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :return: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">last_second_timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;receives_statistic_last_second&#39;</span><span class="p">][</span><span class="s1">&#39;entries&#39;</span><span class="p">][</span><span class="n">last_second_timestamp</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_stream_statistic">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_stream_statistic">[docs]</a>
    <span class="k">def</span> <span class="nf">get_stream_statistic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the statistic of a specific stream</span>

<span class="sd">        :param stream_id: id of a stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :return: set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stream_statistic</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;stream_receives_per_second&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s1">&#39;stream_receives_per_minute&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s1">&#39;stream_receives_per_hour&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s1">&#39;stream_receives_per_day&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s1">&#39;stream_receives_per_month&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s1">&#39;stream_receives_per_year&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;running&quot;</span><span class="p">:</span>
                <span class="n">stream_statistic</span><span class="p">[</span><span class="s1">&#39;uptime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;stopped&quot;</span><span class="p">:</span>
                <span class="n">stream_statistic</span><span class="p">[</span><span class="s1">&#39;uptime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;has_stopped&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="s2">&quot;crashed&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]:</span>
                <span class="n">stream_statistic</span><span class="p">[</span><span class="s1">&#39;uptime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;has_stopped&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;restarting&quot;</span><span class="p">:</span>
                <span class="n">stream_statistic</span><span class="p">[</span><span class="s1">&#39;uptime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stream_statistic</span><span class="p">[</span><span class="s1">&#39;uptime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">stream_receives_per_second</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;processed_receives_total&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">stream_statistic</span><span class="p">[</span><span class="s1">&#39;uptime&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
                <span class="n">stream_receives_per_second</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">stream_statistic</span><span class="p">[</span><span class="s1">&#39;stream_receives_per_second&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stream_receives_per_second</span>
            <span class="k">if</span> <span class="n">stream_statistic</span><span class="p">[</span><span class="s1">&#39;uptime&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">:</span>
                <span class="n">stream_statistic</span><span class="p">[</span><span class="s1">&#39;stream_receives_per_minute&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stream_receives_per_second</span> <span class="o">*</span> <span class="mi">60</span>
            <span class="k">if</span> <span class="n">stream_statistic</span><span class="p">[</span><span class="s1">&#39;uptime&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">:</span>
                <span class="n">stream_statistic</span><span class="p">[</span><span class="s1">&#39;stream_receives_per_hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stream_receives_per_second</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span>
            <span class="k">if</span> <span class="n">stream_statistic</span><span class="p">[</span><span class="s1">&#39;uptime&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span><span class="p">:</span>
                <span class="n">stream_statistic</span><span class="p">[</span><span class="s1">&#39;stream_receives_per_day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stream_receives_per_second</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span>
            <span class="k">if</span> <span class="n">stream_statistic</span><span class="p">[</span><span class="s1">&#39;uptime&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">30</span><span class="p">:</span>
                <span class="n">stream_statistic</span><span class="p">[</span><span class="s1">&#39;stream_receives_per_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stream_receives_per_second</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">30</span>
            <span class="k">if</span> <span class="n">stream_statistic</span><span class="p">[</span><span class="s1">&#39;uptime&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">12</span><span class="p">:</span>
                <span class="n">stream_statistic</span><span class="p">[</span><span class="s1">&#39;stream_receives_per_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stream_receives_per_second</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">12</span>
            <span class="k">return</span> <span class="n">stream_statistic</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_the_one_active_websocket_api">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_the_one_active_websocket_api">[docs]</a>
    <span class="k">def</span> <span class="nf">get_the_one_active_websocket_api</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is needed to simplify the access to the websocket API, if only one API stream exists it is clear</span>
<span class="sd">        that only this stream can be used for the requests and therefore will be used.</span>

<span class="sd">        :return: stream_id or None (str)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">found_entries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">found_stream_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_the_one_active_websocket_api() - `stream_list_lock` &quot;</span>
                         <span class="sa">f</span><span class="s2">&quot;was entered!&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">stream_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;api&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">found_entries</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">found_stream_id</span> <span class="o">=</span> <span class="n">stream_id</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_the_one_active_websocket_api() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">found_entries</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Its clear, there is only one valid connection to use, so we can take it!</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_the_one_active_websocket_api() - Found `stream_id` &quot;</span>
                         <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">found_stream_id</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">found_stream_id</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.get_the_one_active_websocket_api() - No valid `stream_id` found! &quot;</span>
                         <span class="sa">f</span><span class="s2">&quot;- `found_entries` = </span><span class="si">{</span><span class="n">found_entries</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_total_received_bytes">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_total_received_bytes">[docs]</a>
    <span class="k">def</span> <span class="nf">get_total_received_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get number of total received bytes</span>

<span class="sd">        :return: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># how many bytes did we receive till now?</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_received_bytes</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_total_receives">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_total_receives">[docs]</a>
    <span class="k">def</span> <span class="nf">get_total_receives</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the number of total receives</span>

<span class="sd">        :return: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_receives</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_user_agent">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_user_agent">[docs]</a>
    <span class="k">def</span> <span class="nf">get_user_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the user_agent string &quot;lib name + lib version + python version&quot;</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">user_agent</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_version</span><span class="p">())</span><span class="si">}</span><span class="s2">-python_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">platform</span><span class="o">.</span><span class="n">python_version</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">user_agent</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_version">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_version">[docs]</a>
    <span class="k">def</span> <span class="nf">get_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the package/module version</span>

<span class="sd">        :return: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.get_version_unicorn_fy">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.get_version_unicorn_fy">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_version_unicorn_fy</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the package/module version of `UnicornFy &lt;https://github.com/LUCIT-Systems-and-Development/unicorn-fy&gt;`_</span>

<span class="sd">        :return: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">unicorn_fy.unicorn_fy</span> <span class="kn">import</span> <span class="n">UnicornFy</span>

        <span class="n">unicorn_fy</span> <span class="o">=</span> <span class="n">UnicornFy</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">unicorn_fy</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.help">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.help">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">help</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Help in iPython</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ctrl+D to close&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.increase_received_bytes_per_second">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.increase_received_bytes_per_second">[docs]</a>
    <span class="k">def</span> <span class="nf">increase_received_bytes_per_second</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add the amount of received bytes per second</span>

<span class="sd">        :param stream_id: id of a stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :param size: amount of bytes to add</span>
<span class="sd">        :type size: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;transfer_rate_per_second&#39;</span><span class="p">][</span><span class="s1">&#39;bytes&#39;</span><span class="p">][</span><span class="n">current_timestamp</span><span class="p">]:</span>
                <span class="k">pass</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.increase_received_bytes_per_second() - `stream_list_lock` &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;was entered!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;transfer_rate_per_second&#39;</span><span class="p">][</span><span class="s1">&#39;bytes&#39;</span><span class="p">][</span><span class="n">current_timestamp</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.increase_received_bytes_per_second() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.increase_received_bytes_per_second() - `stream_list_lock` &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;was entered!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;transfer_rate_per_second&#39;</span><span class="p">][</span><span class="s1">&#39;bytes&#39;</span><span class="p">][</span><span class="n">current_timestamp</span><span class="p">]</span> <span class="o">+=</span> <span class="n">size</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.increase_received_bytes_per_second() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.increase_processed_receives_statistic">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.increase_processed_receives_statistic">[docs]</a>
    <span class="k">def</span> <span class="nf">increase_processed_receives_statistic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add the number of processed receives</span>

<span class="sd">        :param stream_id: id of a stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.increase_processed_receives_statistic() - `stream_list_lock` &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;was entered!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;processed_receives_total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.increase_processed_receives_statistic() - Leaving &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;`stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.increase_processed_receives_statistic() - `stream_list_lock` &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;was entered!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;receives_statistic_last_second&#39;</span><span class="p">][</span><span class="s1">&#39;entries&#39;</span><span class="p">][</span><span class="n">current_timestamp</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.increase_processed_receives_statistic() - Leaving &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;`stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.increase_processed_receives_statistic() - `stream_list_lock` &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;was entered!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;receives_statistic_last_second&#39;</span><span class="p">][</span><span class="s1">&#39;entries&#39;</span><span class="p">][</span><span class="n">current_timestamp</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.increase_processed_receives_statistic() - Leaving &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;`stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_receives_lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_receives</span> <span class="o">+=</span> <span class="mi">1</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.increase_reconnect_counter">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.increase_reconnect_counter">[docs]</a>
    <span class="k">def</span> <span class="nf">increase_reconnect_counter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Increase reconnect counter</span>

<span class="sd">        :param stream_id: id of a stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.increase_reconnect_counter() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;logged_reconnects&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;reconnects&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.increase_reconnect_counter() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconnects_lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reconnects</span> <span class="o">+=</span> <span class="mi">1</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.increase_transmitted_counter">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.increase_transmitted_counter">[docs]</a>
    <span class="k">def</span> <span class="nf">increase_transmitted_counter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Increase the counter of transmitted payloads</span>
<span class="sd">        :param stream_id: id of a stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.increase_transmitted_counter() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;processed_transmitted_total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.increase_transmitted_counter() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_transmitted_lock</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.increase_transmitted_counter() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_transmitted</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.increase_transmitted_counter() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.is_manager_stopping">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.is_manager_stopping">[docs]</a>
    <span class="k">def</span> <span class="nf">is_manager_stopping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns `True` if the manager has a stop request, &#39;False&#39; if not.</span>

<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_manager_request</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.is_exchange_type">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.is_exchange_type">[docs]</a>
    <span class="k">def</span> <span class="nf">is_exchange_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exchange_type</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the exchange type!</span>

<span class="sd">        :param exchange_type: Valid types are `dex` and `cex`!</span>
<span class="sd">        :type exchange_type: str</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">exchange_type</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange_type</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange_type</span> <span class="o">==</span> <span class="n">exchange_type</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.is_crash_request">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.is_crash_request">[docs]</a>
    <span class="k">def</span> <span class="nf">is_crash_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Has a specific stream a crash_request?</span>

<span class="sd">        :param stream_id: id of a stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.is_stop_request(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">)</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_debug_log</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;crash_request&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.is_stop_request">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.is_stop_request">[docs]</a>
    <span class="k">def</span> <span class="nf">is_stop_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Has a specific stream a stop_request?</span>

<span class="sd">        :param stream_id: id of a stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.is_stop_request(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">)</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_debug_log</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;stop_request&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_manager_stopping</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.is_stream_signal_buffer_enabled">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.is_stream_signal_buffer_enabled">[docs]</a>
    <span class="k">def</span> <span class="nf">is_stream_signal_buffer_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is the stream_signal_buffer enabled?</span>

<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_stream_signal_buffer</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.is_update_available">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.is_update_available">[docs]</a>
    <span class="k">def</span> <span class="nf">is_update_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is a new release of this package available?</span>

<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">installed_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;.dev&quot;</span> <span class="ow">in</span> <span class="n">installed_version</span><span class="p">:</span>
            <span class="n">installed_version</span> <span class="o">=</span> <span class="n">installed_version</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_latest_version</span><span class="p">()</span> <span class="o">==</span> <span class="n">installed_version</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_latest_version</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;unknown&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.is_update_availabe_unicorn_fy">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.is_update_availabe_unicorn_fy">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">is_update_availabe_unicorn_fy</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is a new release of `UnicornFy &lt;https://github.com/LUCIT-Systems-and-Development/unicorn-fy&gt;`_ available?</span>

<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">unicorn_fy.unicorn_fy</span> <span class="kn">import</span> <span class="n">UnicornFy</span>

        <span class="n">unicorn_fy</span> <span class="o">=</span> <span class="n">UnicornFy</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">unicorn_fy</span><span class="o">.</span><span class="n">is_update_available</span><span class="p">()</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.is_update_availabe_check_command">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.is_update_availabe_check_command">[docs]</a>
    <span class="k">def</span> <span class="nf">is_update_availabe_check_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">check_command_version</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is a new release of `check_lucit_collector.py` available?</span>

<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">installed_version</span> <span class="o">=</span> <span class="n">check_command_version</span>
        <span class="n">latest_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_latest_version_check_command</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;.dev&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">installed_version</span><span class="p">):</span>
            <span class="n">installed_version</span> <span class="o">=</span> <span class="n">installed_version</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">latest_version</span> <span class="o">==</span> <span class="n">installed_version</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">latest_version</span> <span class="o">==</span> <span class="s2">&quot;unknown&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.pop_stream_data_from_stream_buffer">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.pop_stream_data_from_stream_buffer">[docs]</a>
    <span class="k">def</span> <span class="nf">pop_stream_data_from_stream_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_buffer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;FIFO&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get oldest or latest entry from</span>
<span class="sd">        `stream_buffer &lt;https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api/wiki/%60stream_buffer%60&gt;`_</span>
<span class="sd">        and remove from FIFO/LIFO stack.</span>

<span class="sd">        :param stream_buffer_name: `False` to read from generic stream_buffer, the stream_id if you used True in</span>
<span class="sd">                                   create_stream() or the string name of a shared stream_buffer.</span>
<span class="sd">        :type stream_buffer_name: bool or str</span>
<span class="sd">        :param mode: How to read from the `stream_buffer` - &quot;FIFO&quot; (default) or &quot;LIFO&quot;.</span>
<span class="sd">        :type mode: str</span>
<span class="sd">        :return: stream_data - str, dict or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stream_buffer_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_buffer_lock</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;FIFO&quot;</span><span class="p">:</span>
                        <span class="n">stream_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_buffer</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
                    <span class="k">elif</span> <span class="n">mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;LIFO&quot;</span><span class="p">:</span>
                        <span class="n">stream_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_buffer</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">None</span>
                <span class="k">return</span> <span class="n">stream_data</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_buffer_locks</span><span class="p">[</span><span class="n">stream_buffer_name</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;FIFO&quot;</span><span class="p">:</span>
                        <span class="n">stream_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_buffers</span><span class="p">[</span><span class="n">stream_buffer_name</span><span class="p">]</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
                    <span class="k">elif</span> <span class="n">mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;LIFO&quot;</span><span class="p">:</span>
                        <span class="n">stream_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_buffers</span><span class="p">[</span><span class="n">stream_buffer_name</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">None</span>
                <span class="k">return</span> <span class="n">stream_data</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.pop_stream_signal_from_stream_signal_buffer">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.pop_stream_signal_from_stream_signal_buffer">[docs]</a>
    <span class="k">def</span> <span class="nf">pop_stream_signal_from_stream_signal_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the oldest entry from</span>
<span class="sd">        `stream_signal_buffer &lt;https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api/wiki/%60stream_signal_buffer%60&gt;`_</span>
<span class="sd">        and remove from stack/pipe (FIFO stack)</span>

<span class="sd">        :return: stream_signal - dict or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_signal_buffer_lock</span><span class="p">:</span>
                <span class="n">stream_signal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_signal_buffer</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">stream_signal</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.print_stream_info">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.print_stream_info">[docs]</a>
    <span class="k">def</span> <span class="nf">print_stream_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">,</span> <span class="n">add_string</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print all infos about a specific stream, helps debugging :)</span>

<span class="sd">        :param stream_id: id of a stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :param add_string: text to add to the output</span>
<span class="sd">        :type add_string: str</span>
<span class="sd">        :param title: set to `True` to use curses instead of print()</span>
<span class="sd">        :type title: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">binance_api_status_row</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">stream_label_row</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">status_row</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">payload_row</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">symbol_row</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">dex_user_address_row</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">last_static_ping_listen_key</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">stream_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stream_info</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_string</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">add_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">add_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">add_string</span><span class="si">}</span><span class="se">\r\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">socks5_proxy_address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">socks5_proxy_port</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">proxy</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2"> proxy: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">socks5_proxy_address</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">socks5_proxy_port</span><span class="si">}</span><span class="s2"> (ssl:&quot;</span> \
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">socks5_proxy_ssl_verification</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">proxy</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;logged_reconnects&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logged_reconnects_row</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2"> logged_reconnects: &quot;</span>
                <span class="n">row_prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.print_stream_info() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">timestamp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;logged_reconnects&#39;</span><span class="p">]:</span>
                        <span class="n">logged_reconnects_row</span> <span class="o">+=</span> <span class="n">row_prefix</span> <span class="o">+</span> \
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">get_date_of_timestamp</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>
                        <span class="n">row_prefix</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.print_stream_info() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logged_reconnects_row</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s2">&quot;running&quot;</span> <span class="ow">in</span> <span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]:</span>
            <span class="n">stream_row_color_prefix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m</span><span class="se">\033</span><span class="s2">[32m&quot;</span>
            <span class="n">stream_row_color_suffix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m</span><span class="se">\r\n</span><span class="s2">&quot;</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.print_stream_info() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">reconnect_timestamp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;logged_reconnects&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">reconnect_timestamp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">stream_row_color_prefix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m</span><span class="se">\033</span><span class="s2">[33m&quot;</span>
                        <span class="n">stream_row_color_suffix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m</span><span class="se">\r\n</span><span class="s2">&quot;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.print_stream_info() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
            <span class="n">status_row</span> <span class="o">=</span> <span class="n">stream_row_color_prefix</span> <span class="o">+</span> <span class="s2">&quot; status: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">stream_row_color_suffix</span>
        <span class="k">elif</span> <span class="s2">&quot;crashed&quot;</span> <span class="ow">in</span> <span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]:</span>
            <span class="n">stream_row_color_prefix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m</span><span class="se">\033</span><span class="s2">[31m&quot;</span>
            <span class="n">stream_row_color_suffix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m</span><span class="se">\r\n</span><span class="s2">&quot;</span>
            <span class="n">status_row</span> <span class="o">=</span> <span class="n">stream_row_color_prefix</span> <span class="o">+</span> <span class="s2">&quot; status: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">stream_row_color_suffix</span>
        <span class="k">elif</span> <span class="s2">&quot;restarting&quot;</span> <span class="ow">in</span> <span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]:</span>
            <span class="n">stream_row_color_prefix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m</span><span class="se">\033</span><span class="s2">[33m&quot;</span>
            <span class="n">stream_row_color_suffix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m</span><span class="se">\r\n</span><span class="s2">&quot;</span>
            <span class="n">status_row</span> <span class="o">=</span> <span class="n">stream_row_color_prefix</span> <span class="o">+</span> <span class="s2">&quot; status: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">stream_row_color_suffix</span>
        <span class="k">elif</span> <span class="s2">&quot;stopped&quot;</span> <span class="ow">in</span> <span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]:</span>
            <span class="n">stream_row_color_prefix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m</span><span class="se">\033</span><span class="s2">[33m&quot;</span>
            <span class="n">stream_row_color_suffix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m</span><span class="se">\r\n</span><span class="s2">&quot;</span>
            <span class="n">status_row</span> <span class="o">=</span> <span class="n">stream_row_color_prefix</span> <span class="o">+</span> <span class="s2">&quot; status: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">stream_row_color_suffix</span>
        <span class="k">if</span> <span class="s2">&quot;!userData&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;markets&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="s2">&quot;!userData&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">]:</span>
            <span class="n">last_static_ping_listen_key</span> <span class="o">=</span> <span class="s2">&quot; last_static_ping_listen_key: &quot;</span> <span class="o">+</span> \
                                          <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;last_static_ping_listen_key&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">binance_api_status</span><span class="p">[</span><span class="s1">&#39;status_code&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">binance_api_status_code</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m</span><span class="se">\033</span><span class="s2">[32m&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binance_api_status</span><span class="p">[</span><span class="s1">&#39;status_code&#39;</span><span class="p">])</span> <span class="o">+</span> \
                                          <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">binance_api_status_code</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m</span><span class="se">\033</span><span class="s2">[31m&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binance_api_status</span><span class="p">[</span><span class="s1">&#39;status_code&#39;</span><span class="p">])</span> <span class="o">+</span> \
                                          <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span>
            <span class="n">binance_api_status_row</span> <span class="o">=</span> <span class="s2">&quot; binance_api_status: used_weight=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binance_api_status</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">])</span> <span class="o">+</span> \
                                     <span class="s2">&quot;, status_code=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">binance_api_status_code</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; (last update &quot;</span> <span class="o">+</span> \
                                     <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_date_of_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binance_api_status</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]))</span> <span class="o">+</span> \
                                     <span class="s2">&quot;)</span><span class="se">\r\n</span><span class="s2">&quot;</span>
        <span class="n">current_receiving_speed</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_human_bytesize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_current_receiving_speed</span><span class="p">(</span><span class="n">stream_id</span><span class="p">),</span> <span class="s2">&quot;/s&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;symbols&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">symbol_row</span> <span class="o">=</span> <span class="s2">&quot; symbols:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;symbols&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s2">&quot;payload&quot;</span><span class="p">]:</span>
            <span class="n">payload_row</span> <span class="o">=</span> <span class="s2">&quot; payload: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s2">&quot;payload&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s2">&quot;dex_user_address&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dex_user_address_row</span> <span class="o">=</span> <span class="s2">&quot; user_address: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s2">&quot;dex_user_address&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s2">&quot;stream_label&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stream_label_row</span> <span class="o">=</span> <span class="s2">&quot; stream_label: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s2">&quot;stream_label&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;ping_interval&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">ping_interval</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;ping_interval&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> seconds&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ping_interval</span> <span class="o">=</span> <span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;ping_interval&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;ping_timeout&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">ping_timeout</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;ping_timeout&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> seconds&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ping_timeout</span> <span class="o">=</span> <span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;ping_timeout&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;close_timeout&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">close_timeout</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;close_timeout&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> seconds&quot;</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">close_timeout</span> <span class="o">=</span> <span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;close_timeout&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">first_row</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_up_space_centered</span><span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
            <span class="n">last_row</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_up_space_centered</span><span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot; Powered by </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_user_agent</span><span class="p">()</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">first_row</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_up_space_centered</span><span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_user_agent</span><span class="p">()</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
            <span class="n">last_row</span> <span class="o">=</span> <span class="s2">&quot;========================================================================================&quot;</span> \
                       <span class="s2">&quot;=======</span><span class="se">\r\n</span><span class="s2">&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">uptime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_human_uptime</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;processed_receives_statistic&#39;</span><span class="p">][</span><span class="s1">&#39;uptime&#39;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">first_row</span> <span class="o">+</span>
                  <span class="s2">&quot; exchange: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;exchange&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                  <span class="nb">str</span><span class="p">(</span><span class="n">add_string</span><span class="p">)</span> <span class="o">+</span>
                  <span class="s2">&quot; stream_id:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                  <span class="nb">str</span><span class="p">(</span><span class="n">stream_label_row</span><span class="p">)</span> <span class="o">+</span>
                  <span class="s2">&quot; stream_buffer_maxlen:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;stream_buffer_maxlen&#39;</span><span class="p">]),</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                  <span class="sa">f</span><span class="s2">&quot; api: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;api&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                  <span class="s2">&quot; channels (&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot;):&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">]),</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                  <span class="s2">&quot; markets (&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;markets&#39;</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot;):&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;markets&#39;</span><span class="p">]),</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                  <span class="sa">f</span><span class="s2">&quot; websocket_uri: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;websocket_uri&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                  <span class="nb">str</span><span class="p">(</span><span class="n">symbol_row</span><span class="p">)</span> <span class="o">+</span>
                  <span class="s2">&quot; subscriptions: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;subscriptions&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                  <span class="nb">str</span><span class="p">(</span><span class="n">payload_row</span><span class="p">)</span> <span class="o">+</span>
                  <span class="nb">str</span><span class="p">(</span><span class="n">status_row</span><span class="p">)</span> <span class="o">+</span>
                  <span class="nb">str</span><span class="p">(</span><span class="n">dex_user_address_row</span><span class="p">)</span> <span class="o">+</span>
                  <span class="sa">f</span><span class="s2">&quot; ping_interval: </span><span class="si">{</span><span class="n">ping_interval</span><span class="si">}</span><span class="se">\r\n</span><span class="s2">&quot;</span>
                  <span class="sa">f</span><span class="s2">&quot; ping_timeout: </span><span class="si">{</span><span class="n">ping_timeout</span><span class="si">}</span><span class="se">\r\n</span><span class="s2">&quot;</span>
                  <span class="sa">f</span><span class="s2">&quot; close_timeout: </span><span class="si">{</span><span class="n">close_timeout</span><span class="si">}</span><span class="se">\r\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot; start_time:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">]),</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot; uptime:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">uptime</span><span class="p">),</span>
                  <span class="sa">f</span><span class="s2">&quot;since </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">, %H:%M:%S UTC&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                  <span class="s2">&quot; reconnects:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;reconnects&#39;</span><span class="p">]),</span> <span class="n">logged_reconnects_row</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                  <span class="nb">str</span><span class="p">(</span><span class="n">binance_api_status_row</span><span class="p">)</span> <span class="o">+</span>
                  <span class="nb">str</span><span class="p">(</span><span class="n">last_static_ping_listen_key</span><span class="p">)</span> <span class="o">+</span>
                  <span class="s2">&quot; last_heartbeat:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;last_heartbeat&#39;</span><span class="p">]),</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot; seconds_to_last_heartbeat:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;seconds_to_last_heartbeat&#39;</span><span class="p">]),</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot; stop_request:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;stop_request&#39;</span><span class="p">]),</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>                                                                      
                  <span class="s2">&quot; has_stopped:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;has_stopped&#39;</span><span class="p">]),</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot; seconds_since_has_stopped:&quot;</span><span class="p">,</span>
                  <span class="nb">str</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;seconds_since_has_stopped&#39;</span><span class="p">]),</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot; current_receiving_speed:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_receiving_speed</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                  <span class="s2">&quot; processed_receives:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;processed_receives_total&#39;</span><span class="p">]),</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                  <span class="s2">&quot; transmitted_payloads:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;processed_transmitted_total&#39;</span><span class="p">]),</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                  <span class="s2">&quot; stream_most_receives_per_second:&quot;</span><span class="p">,</span>
                  <span class="nb">str</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;receives_statistic_last_second&#39;</span><span class="p">][</span><span class="s1">&#39;most_receives_per_second&#39;</span><span class="p">]),</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot; stream_receives_per_second:&quot;</span><span class="p">,</span>
                  <span class="nb">str</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;processed_receives_statistic&#39;</span><span class="p">][</span><span class="s1">&#39;stream_receives_per_second&#39;</span><span class="p">]</span><span class="o">.</span><span class="fm">__round__</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot; stream_receives_per_minute:&quot;</span><span class="p">,</span>
                  <span class="nb">str</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;processed_receives_statistic&#39;</span><span class="p">][</span><span class="s1">&#39;stream_receives_per_minute&#39;</span><span class="p">]</span><span class="o">.</span><span class="fm">__round__</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot; stream_receives_per_hour:&quot;</span><span class="p">,</span>
                  <span class="nb">str</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;processed_receives_statistic&#39;</span><span class="p">][</span><span class="s1">&#39;stream_receives_per_hour&#39;</span><span class="p">]</span><span class="o">.</span><span class="fm">__round__</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot; stream_receives_per_day:&quot;</span><span class="p">,</span>
                  <span class="nb">str</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;processed_receives_statistic&#39;</span><span class="p">][</span><span class="s1">&#39;stream_receives_per_day&#39;</span><span class="p">]</span><span class="o">.</span><span class="fm">__round__</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                  <span class="n">last_row</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_stream_info</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.print_summary">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.print_summary">[docs]</a>
    <span class="k">def</span> <span class="nf">print_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">add_string</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">disable_print</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print an overview of all streams</span>
<span class="sd">        </span>
<span class="sd">        :param add_string: text to add to the output</span>
<span class="sd">        :type add_string: str</span>
<span class="sd">        :param disable_print: set to `True` to use curses instead of print()</span>
<span class="sd">        :type disable_print: bool</span>
<span class="sd">        :param title: set a title (first row) for print_summary output</span>
<span class="sd">        :type title: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">streams</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">)</span>
        <span class="n">active_streams</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">crashed_streams</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">restarting_streams</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">stopped_streams</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">active_streams_row</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">restarting_streams_row</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">stopped_streams_row</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">all_receives_per_second</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">current_receiving_speed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">streams_with_stop_request</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">stream_rows</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">crashed_streams_row</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">binance_api_status_row</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">received_bytes_per_x_row</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">streams_with_stop_request_row</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">stream_buffer_row</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">highest_receiving_speed_row</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_human_bytesize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">receiving_speed_peak</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;/s&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2"> &quot;</span> \
                                      <span class="sa">f</span><span class="s2">&quot;(reached at &quot;</span> \
                                      <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_date_of_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">receiving_speed_peak</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">socks5_proxy_address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">socks5_proxy_port</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">proxy</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2"> proxy: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">socks5_proxy_address</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">socks5_proxy_port</span><span class="si">}</span><span class="s2"> (ssl_verification: &quot;</span> \
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">socks5_proxy_ssl_verification</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">proxy</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="n">add_string</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">add_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">add_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">add_string</span><span class="si">}</span><span class="se">\r\n</span><span class="s2">&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.print_summary() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
                <span class="n">temp_stream_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.print_summary() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">stream_id</span> <span class="ow">in</span> <span class="n">temp_stream_list</span><span class="p">:</span>
            <span class="n">stream_row_color_prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">stream_row_color_suffix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">current_receiving_speed</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_receiving_speed</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>
            <span class="n">stream_statistic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stream_statistic</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;running&quot;</span><span class="p">:</span>
                <span class="n">active_streams</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">all_receives_per_second</span> <span class="o">+=</span> <span class="n">stream_statistic</span><span class="p">[</span><span class="s1">&#39;stream_receives_per_second&#39;</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.print_summary() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">reconnect_timestamp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;logged_reconnects&#39;</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">reconnect_timestamp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">stream_row_color_prefix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m</span><span class="se">\033</span><span class="s2">[31m&quot;</span>
                                <span class="n">stream_row_color_suffix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span>
                            <span class="k">elif</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">reconnect_timestamp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                                <span class="n">stream_row_color_prefix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m</span><span class="se">\033</span><span class="s2">[33m&quot;</span>
                                <span class="n">stream_row_color_suffix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span>
                            <span class="k">elif</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">reconnect_timestamp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                                <span class="n">stream_row_color_prefix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m</span><span class="se">\033</span><span class="s2">[32m&quot;</span>
                                <span class="n">stream_row_color_suffix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.print_summary() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;stopped&quot;</span><span class="p">:</span>
                <span class="n">stopped_streams</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">stream_row_color_prefix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m</span><span class="se">\033</span><span class="s2">[33m&quot;</span>
                <span class="n">stream_row_color_suffix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;restarting&quot;</span><span class="p">:</span>
                <span class="n">restarting_streams</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">stream_row_color_prefix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m</span><span class="se">\033</span><span class="s2">[33m&quot;</span>
                <span class="n">stream_row_color_suffix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span>
            <span class="k">elif</span> <span class="s2">&quot;crashed&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]:</span>
                <span class="n">crashed_streams</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">stream_row_color_prefix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m</span><span class="se">\033</span><span class="s2">[31m&quot;</span>
                <span class="n">stream_row_color_suffix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;stream_label&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;stream_label&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">18</span><span class="p">:</span>
                    <span class="n">stream_label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;stream_label&#39;</span><span class="p">])[:</span><span class="mi">13</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;...&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">stream_label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;stream_label&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stream_label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;stream_label&#39;</span><span class="p">])</span>
            <span class="n">stream_rows</span> <span class="o">+=</span> <span class="n">stream_row_color_prefix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span> <span class="o">+</span> <span class="n">stream_row_color_suffix</span> <span class="o">+</span> <span class="s2">&quot; |&quot;</span> <span class="o">+</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">fill_up_space_right</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="n">stream_label</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span> <span class="o">+</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">fill_up_space_left</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stream_receives_last_second</span><span class="p">(</span><span class="n">stream_id</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span> <span class="o">+</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">fill_up_space_left</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_statistic</span><span class="p">[</span><span class="s1">&#39;stream_receives_per_second&#39;</span><span class="p">]</span><span class="o">.</span><span class="fm">__round__</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span> <span class="o">+</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">fill_up_space_left</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;receives_statistic_last_second&#39;</span><span class="p">][</span><span class="s1">&#39;most_receives_per_second&#39;</span><span class="p">])</span> \
                <span class="o">+</span> <span class="s2">&quot;|&quot;</span> <span class="o">+</span> <span class="n">stream_row_color_prefix</span> <span class="o">+</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">fill_up_space_left</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;logged_reconnects&#39;</span><span class="p">])))</span> <span class="o">+</span> \
                <span class="n">stream_row_color_suffix</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2"> &quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_stop_request</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;running&quot;</span><span class="p">:</span>
                <span class="n">streams_with_stop_request</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">streams_with_stop_request</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">stream_row_color_prefix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m</span><span class="se">\033</span><span class="s2">[33m&quot;</span>
            <span class="n">stream_row_color_suffix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span>
            <span class="n">streams_with_stop_request_row</span> <span class="o">=</span> <span class="p">(</span><span class="n">stream_row_color_prefix</span> <span class="o">+</span> <span class="s2">&quot; streams_with_stop_request: &quot;</span> <span class="o">+</span>
                                             <span class="nb">str</span><span class="p">(</span><span class="n">streams_with_stop_request</span><span class="p">)</span> <span class="o">+</span> <span class="n">stream_row_color_suffix</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">crashed_streams</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">stream_row_color_prefix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m</span><span class="se">\033</span><span class="s2">[31m&quot;</span>
            <span class="n">stream_row_color_suffix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span>
            <span class="n">crashed_streams_row</span> <span class="o">=</span> <span class="p">(</span><span class="n">stream_row_color_prefix</span> <span class="o">+</span> <span class="s2">&quot; crashed_streams: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">crashed_streams</span><span class="p">)</span> <span class="o">+</span>
                                   <span class="n">stream_row_color_suffix</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">total_received_bytes</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_total_received_bytes</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_human_bytesize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_total_received_bytes</span><span class="p">()))</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">received_bytes_per_second</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_total_received_bytes</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">)</span>
            <span class="n">received_bytes_per_x_row</span> <span class="o">+=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_human_bytesize</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">received_bytes_per_second</span><span class="p">),</span> <span class="s1">&#39;/s&#39;</span><span class="p">))</span> <span class="o">+</span>
                                         <span class="s2">&quot; (per day &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(((</span><span class="n">received_bytes_per_second</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span><span class="p">)</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span>
                                                             <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span><span class="p">)</span><span class="o">.</span><span class="fm">__round__</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; gB)&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stream_buffer_length</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
                <span class="n">stream_row_color_prefix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m</span><span class="se">\033</span><span class="s2">[34m&quot;</span>
                <span class="n">stream_row_color_suffix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span>
                <span class="n">stream_buffer_row</span> <span class="o">+=</span> <span class="p">(</span><span class="n">stream_row_color_prefix</span> <span class="o">+</span> <span class="s2">&quot; stream_buffer_stored_items: &quot;</span> <span class="o">+</span>
                                      <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_stream_buffer_length</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">stream_buffer_row</span> <span class="o">+=</span> <span class="s2">&quot; stream_buffer_byte_size: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_stream_buffer_byte_size</span><span class="p">())</span> <span class="o">+</span> \
                                     <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_human_bytesize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_stream_buffer_byte_size</span><span class="p">()))</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span> <span class="o">+</span> \
                                     <span class="n">stream_row_color_suffix</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">active_streams</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">active_streams_row</span> <span class="o">=</span> <span class="s2">&quot; </span><span class="se">\033</span><span class="s2">[1m</span><span class="se">\033</span><span class="s2">[32mactive_streams: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">active_streams</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m</span><span class="se">\r\n</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">restarting_streams</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">restarting_streams_row</span> <span class="o">=</span> <span class="s2">&quot; </span><span class="se">\033</span><span class="s2">[1m</span><span class="se">\033</span><span class="s2">[33mrestarting_streams: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">restarting_streams</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m</span><span class="se">\r\n</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">stopped_streams</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">stopped_streams_row</span> <span class="o">=</span> <span class="s2">&quot; </span><span class="se">\033</span><span class="s2">[1m</span><span class="se">\033</span><span class="s2">[33mstopped_streams: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stopped_streams</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m</span><span class="se">\r\n</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">binance_api_status</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">binance_api_status</span><span class="p">[</span><span class="s1">&#39;status_code&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                    <span class="n">binance_api_status_code</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m</span><span class="se">\033</span><span class="s2">[32m&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binance_api_status</span><span class="p">[</span><span class="s1">&#39;status_code&#39;</span><span class="p">])</span> <span class="o">+</span> \
                                              <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">binance_api_status_code</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m</span><span class="se">\033</span><span class="s2">[31m&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binance_api_status</span><span class="p">[</span><span class="s1">&#39;status_code&#39;</span><span class="p">])</span> <span class="o">+</span> \
                                              <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span>
                <span class="n">binance_api_status_row</span> <span class="o">=</span> <span class="s2">&quot; binance_api_status: used_weight=&quot;</span> <span class="o">+</span> \
                                         <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binance_api_status</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">])</span> <span class="o">+</span> \
                                         <span class="s2">&quot;, status_code=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">binance_api_status_code</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; (last update &quot;</span> <span class="o">+</span> \
                                         <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_date_of_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binance_api_status</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot;)</span><span class="se">\r\n</span><span class="s2">&quot;</span>

            <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">first_row</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_up_space_centered</span><span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
                <span class="n">last_row</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_up_space_centered</span><span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot; Powered by </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_user_agent</span><span class="p">()</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">first_row</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_up_space_centered</span><span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_user_agent</span><span class="p">()</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
                <span class="n">last_row</span> <span class="o">=</span> <span class="s2">&quot;========================================================================================&quot;</span> \
                           <span class="s2">&quot;=======</span><span class="se">\r\n</span><span class="s2">&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">print_text</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">first_row</span> <span class="o">+</span>
                    <span class="s2">&quot; exchange: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                    <span class="s2">&quot; uptime: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_human_uptime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">)))</span> <span class="o">+</span> <span class="s2">&quot; since &quot;</span> <span class="o">+</span>
                    <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_date_of_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                    <span class="s2">&quot; streams: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">streams</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">active_streams_row</span><span class="p">)</span> <span class="o">+</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">crashed_streams_row</span><span class="p">)</span> <span class="o">+</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">restarting_streams_row</span><span class="p">)</span> <span class="o">+</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">stopped_streams_row</span><span class="p">)</span> <span class="o">+</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">streams_with_stop_request_row</span><span class="p">)</span> <span class="o">+</span>
                    <span class="s2">&quot; subscriptions: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_all_subscriptions</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">stream_buffer_row</span><span class="p">)</span> <span class="o">+</span>
                    <span class="s2">&quot; current_receiving_speed: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_human_bytesize</span><span class="p">(</span><span class="n">current_receiving_speed</span><span class="p">,</span> <span class="s2">&quot;/s&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                    <span class="s2">&quot; average_receiving_speed: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">received_bytes_per_x_row</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                    <span class="s2">&quot; highest_receiving_speed: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">highest_receiving_speed_row</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                    <span class="s2">&quot; total_receives: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_receives</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot; total_received_bytes: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">total_received_bytes</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot; total_transmitted_payloads: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_transmitted</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                    <span class="s2">&quot; stream_buffer_maxlen: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_buffer_maxlen</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">binance_api_status_row</span><span class="p">)</span> <span class="o">+</span>
                    <span class="s2">&quot; process_ressource_usage: cpu=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_process_usage_cpu</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;%, memory=&quot;</span> <span class="o">+</span>
                    <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_process_usage_memory</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;, threads=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_process_usage_threads</span><span class="p">())</span> <span class="o">+</span>
                    <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">add_string</span><span class="p">)</span> <span class="o">+</span>
                    <span class="s2">&quot; ---------------------------------------------------------------------------------------------</span><span class="se">\r\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;               stream_id              |   stream_label  |  last  |  average  |  peak  | recon</span><span class="se">\r\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot; ---------------------------------------------------------------------------------------------</span><span class="se">\r\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_rows</span><span class="p">)</span> <span class="o">+</span>
                    <span class="s2">&quot;---------------------------------------------------------------------------------------------</span><span class="se">\r\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot; all_streams                                            |&quot;</span> <span class="o">+</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fill_up_space_left</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_all_receives_last_second</span><span class="p">()))</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span> <span class="o">+</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fill_up_space_left</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">all_receives_per_second</span><span class="o">.</span><span class="fm">__round__</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span> <span class="o">+</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fill_up_space_left</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">most_receives_per_second</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span> <span class="o">+</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fill_up_space_left</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reconnects</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                    <span class="n">last_row</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">disable_print</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Windows&#39;</span><span class="p">):</span>
                        <span class="n">print_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_ansi_escape_codes</span><span class="p">(</span><span class="n">print_text</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">print_text</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">print_text</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="k">pass</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.print_summary_to_png">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.print_summary_to_png">[docs]</a>
    <span class="k">def</span> <span class="nf">print_summary_to_png</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">print_summary_export_path</span><span class="p">,</span> <span class="n">hight_per_row</span><span class="o">=</span><span class="mf">12.5</span><span class="p">,</span> <span class="n">add_string</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a PNG image file with the console output of `print_summary()`</span>

<span class="sd">        *LINUX ONLY* It should not be hard to make it OS independent:</span>
<span class="sd">        https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api/issues/61</span>

<span class="sd">        :param print_summary_export_path: If you want to export the output of print_summary() to an image,</span>
<span class="sd">                                          please provide a path like &quot;/var/www/html/&quot;. `View the Wiki!</span>
<span class="sd">                                          &lt;https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api/wiki/How-to-export-print_summary()-stdout-to-PNG%3F&gt;`_</span>
<span class="sd">        :type print_summary_export_path: str</span>
<span class="sd">        :param hight_per_row: set the hight per row for the image hight calculation</span>
<span class="sd">        :type hight_per_row: float</span>
<span class="sd">        :param add_string: text to add to the output</span>
<span class="sd">        :type add_string: str</span>
<span class="sd">        :param title: set a title (first row) for print_summary output</span>
<span class="sd">        :type title: str</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">print_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_summary</span><span class="p">(</span><span class="n">disable_print</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">add_string</span><span class="o">=</span><span class="n">add_string</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
        <span class="c1"># Todo:</span>
        <span class="c1"># 1. Handle paths right</span>
        <span class="c1"># 2. Use PythonMagick instead of Linux ImageMagick</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">print_summary_export_path</span> <span class="o">+</span> <span class="s2">&quot;print_summary.txt&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">text_file</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_ansi_escape_codes</span><span class="p">(</span><span class="n">print_text</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">text_file</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">image_hight</span> <span class="o">=</span> <span class="n">print_text</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="n">hight_per_row</span> <span class="o">+</span> <span class="mi">15</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;convert -size 720x&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">image_hight</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; xc:black -font &quot;FreeMono&quot; -pointsize 12 -fill white -annotate &#39;</span>
                  <span class="s1">&#39;+30+30 &quot;@&#39;</span> <span class="o">+</span> <span class="n">print_summary_export_path</span> <span class="o">+</span> <span class="s1">&#39;print_summary.txt&#39;</span> <span class="o">+</span> <span class="s1">&#39;&quot; &#39;</span> <span class="o">+</span>
                  <span class="n">print_summary_export_path</span> <span class="o">+</span> <span class="s1">&#39;print_summary_plain.png&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;convert &#39;</span> <span class="o">+</span> <span class="n">print_summary_export_path</span> <span class="o">+</span> <span class="s1">&#39;print_summary_plain.png -font &quot;FreeMono&quot; &#39;</span>
                  <span class="s1">&#39;-pointsize 12 -fill red -undercolor </span><span class="se">\&#39;</span><span class="s1">#00000080</span><span class="se">\&#39;</span><span class="s1"> -gravity North -annotate +0+5 &#39;</span>
                  <span class="s1">&#39;&quot;$(date)&quot; &#39;</span> <span class="o">+</span> <span class="n">print_summary_export_path</span> <span class="o">+</span> <span class="s1">&#39;print_summary.png&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.remove_ansi_escape_codes">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.remove_ansi_escape_codes">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_ansi_escape_codes</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove ansi excape codes from the text string!</span>

<span class="sd">        :param text: The text :)</span>
<span class="sd">        :type text: str</span>

<span class="sd">        :return: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m</span><span class="se">\033</span><span class="s2">[31m&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m</span><span class="se">\033</span><span class="s2">[32m&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m</span><span class="se">\033</span><span class="s2">[33m&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m</span><span class="se">\033</span><span class="s2">[34m&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.replace_stream">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.replace_stream">[docs]</a>
    <span class="k">def</span> <span class="nf">replace_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">stream_id</span><span class="p">,</span>
                       <span class="n">new_channels</span><span class="p">,</span>
                       <span class="n">new_markets</span><span class="p">,</span>
                       <span class="n">new_stream_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">new_stream_buffer_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">new_api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">new_api_secret</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">new_symbols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">new_output</span><span class="o">=</span><span class="s2">&quot;raw_data&quot;</span><span class="p">,</span>
                       <span class="n">new_ping_interval</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                       <span class="n">new_ping_timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                       <span class="n">new_close_timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                       <span class="n">new_stream_buffer_maxlen</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace a stream</span>

<span class="sd">        If you want to start a stream with a new config, its recommended, to first start a new stream with the new</span>
<span class="sd">        settings and close the old stream not before the new stream received its first data. So your data will stay</span>
<span class="sd">        consistent.</span>

<span class="sd">        :param stream_id: id of the old stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :param new_channels: the new channel list for the stream</span>
<span class="sd">        :type new_channels: str, tuple, list, set</span>
<span class="sd">        :param new_markets: the new markets list for the stream</span>
<span class="sd">        :type new_markets: str, tuple, list, set</span>
<span class="sd">        :param new_stream_label: provide a stream_label to identify the stream</span>
<span class="sd">        :type new_stream_label: str</span>
<span class="sd">        :param new_stream_buffer_name: If `False` the data is going to get written to the default stream_buffer,</span>
<span class="sd">                                   set to `True` to read the data via `pop_stream_data_from_stream_buffer(stream_id)` or</span>
<span class="sd">                                   provide a string to create and use a shared stream_buffer and read it via</span>
<span class="sd">                                   `pop_stream_data_from_stream_buffer(&#39;string&#39;)`.</span>
<span class="sd">        :type new_stream_buffer_name: bool or str</span>
<span class="sd">        :param new_api_key: provide a valid Binance API key</span>
<span class="sd">        :type new_api_key: str</span>
<span class="sd">        :param new_api_secret: provide a valid Binance API secret</span>
<span class="sd">        :type new_api_secret: str</span>
<span class="sd">        :param new_symbols: provide the symbols for isolated_margin user_data streams</span>
<span class="sd">        :type new_symbols: str</span>
<span class="sd">        :return: new stream_id</span>
<span class="sd">        :param new_output: set to &quot;dict&quot; to convert the received raw data to a python dict, set to &quot;UnicornFy&quot; to convert</span>
<span class="sd">                           with `UnicornFy &lt;https://github.com/LUCIT-Systems-and-Development/unicorn-fy&gt;`_ - otherwise the output</span>
<span class="sd">                           remains unchanged and gets delivered as received from the endpoints</span>
<span class="sd">        :type new_output: str</span>
<span class="sd">        :param new_ping_interval: Once the connection is open, a `Ping frame` is sent every</span>
<span class="sd">                                  `ping_interval` seconds. This serves as a keepalive. It helps keeping</span>
<span class="sd">                                  the connection open, especially in the presence of proxies with short</span>
<span class="sd">                                  timeouts on inactive connections. Set `ping_interval` to `None` to</span>
<span class="sd">                                  disable this behavior. (default: 20)</span>
<span class="sd">                                  This parameter is passed through to the `websockets.client.connect()</span>
<span class="sd">                                  &lt;https://websockets.readthedocs.io/en/stable/api.html?highlight=ping_interval#websockets.client.connect&gt;`_</span>
<span class="sd">        :type new_ping_interval: int or None</span>
<span class="sd">        :param new_ping_timeout: If the corresponding `Pong frame` isn&#39;t received within</span>
<span class="sd">                                 `ping_timeout` seconds, the connection is considered unusable and is closed with</span>
<span class="sd">                                 code 1011. This ensures that the remote endpoint remains responsive. Set</span>
<span class="sd">                                 `ping_timeout` to `None` to disable this behavior. (default: 20)</span>
<span class="sd">                                 This parameter is passed through to the `websockets.client.connect()</span>
<span class="sd">                                 &lt;https://websockets.readthedocs.io/en/stable/api.html?highlight=ping_interval#websockets.client.connect&gt;`_</span>
<span class="sd">        :type new_ping_timeout: int or None</span>
<span class="sd">        :param new_close_timeout: The `close_timeout` parameter defines a maximum wait time in seconds for</span>
<span class="sd">                                  completing the closing handshake and terminating the TCP connection. (default: 10)</span>
<span class="sd">                                  This parameter is passed through to the `websockets.client.connect()</span>
<span class="sd">                                  &lt;https://websockets.readthedocs.io/en/stable/api.html?highlight=ping_interval#websockets.client.connect&gt;`_</span>
<span class="sd">        :type new_close_timeout: int or None</span>
<span class="sd">        :param new_stream_buffer_maxlen: Set a max len for the `stream_buffer`. Only used in combination with a non-generic</span>
<span class="sd">                                     `stream_buffer`. The generic `stream_buffer` uses always the value of</span>
<span class="sd">                                     `BinanceWebSocketApiManager()`.</span>
<span class="sd">        :type new_stream_buffer_maxlen: int or None</span>
<span class="sd">        :return: stream_id or &#39;None&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># starting a new socket and stop the old stream not before the new stream received its first record</span>
        <span class="n">new_stream_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_stream</span><span class="p">(</span><span class="n">new_channels</span><span class="p">,</span>
                                           <span class="n">new_markets</span><span class="p">,</span>
                                           <span class="n">new_stream_label</span><span class="p">,</span>
                                           <span class="n">new_stream_buffer_name</span><span class="p">,</span>
                                           <span class="n">new_api_key</span><span class="p">,</span>
                                           <span class="n">new_api_secret</span><span class="p">,</span>
                                           <span class="n">new_symbols</span><span class="p">,</span>
                                           <span class="n">new_output</span><span class="p">,</span>
                                           <span class="n">new_ping_interval</span><span class="p">,</span>
                                           <span class="n">new_ping_timeout</span><span class="p">,</span>
                                           <span class="n">new_close_timeout</span><span class="p">,</span>
                                           <span class="n">new_stream_buffer_maxlen</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_till_stream_has_started</span><span class="p">(</span><span class="n">new_stream_id</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop_stream</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">delete_listen_key</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_stream_id</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.run">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.run">[docs]</a>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method overloads `threading.run()` and starts management functions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">loop</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">new_event_loop</span><span class="p">()</span>
            <span class="n">asyncio</span><span class="o">.</span><span class="n">set_event_loop</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">loop</span><span class="o">.</span><span class="n">set_debug</span><span class="p">(</span><span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_data_cleanup_stopped_streams</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">loop</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_auto_data_cleanup_stopped_streams</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">900</span><span class="p">))</span>  <span class="c1"># Interval, Age</span>
            <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_frequent_checks</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.run() - OSError - error_msg: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.run() - RuntimeError - error_msg: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.run() - Finally closing the loop!&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">loop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">loop</span><span class="o">.</span><span class="n">is_running</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">tasks</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">all_tasks</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span>
                        <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shutdown_asyncgens</span><span class="p">(</span><span class="n">loop</span><span class="p">))</span>
                        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
                            <span class="n">task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
                            <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">:</span>
                                <span class="k">pass</span>
                    <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.run() - RuntimeError - error_msg: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">RuntimeWarning</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.run() - RuntimeWarning - error_msg: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.run() finally - error_msg: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">loop</span><span class="o">.</span><span class="n">is_closed</span><span class="p">():</span>
                    <span class="n">loop</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.set_private_dex_config">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.set_private_dex_config">[docs]</a>
    <span class="k">def</span> <span class="nf">set_private_dex_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">binance_dex_user_address</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set binance_dex_user_address</span>

<span class="sd">        Is going to be the default user_address, once the websocket is created with this default value, it&#39;s not possible</span>
<span class="sd">        to change it. If you plan to use different user_address It&#39;s recommended to not use this method! Just provide the</span>
<span class="sd">        user_address with create_stream() in the market parameter.</span>

<span class="sd">        :param binance_dex_user_address: Binance DEX user address</span>
<span class="sd">        :type binance_dex_user_address: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dex_user_address</span> <span class="o">=</span> <span class="n">binance_dex_user_address</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.set_heartbeat">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.set_heartbeat">[docs]</a>
    <span class="k">def</span> <span class="nf">set_heartbeat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set heartbeat for a specific thread (should only be done by the stream itself)</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.set_heartbeat(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.set_heartbeat() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;last_heartbeat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.set_heartbeat() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.set_stop_request">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.set_stop_request">[docs]</a>
    <span class="k">def</span> <span class="nf">set_stop_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a stop request for a specific stream.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stream_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.set_stop_request() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;stop_request&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.set_stop_request() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.set_ringbuffer_error_max_size">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.set_ringbuffer_error_max_size">[docs]</a>
    <span class="k">def</span> <span class="nf">set_ringbuffer_error_max_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_size</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        How many error messages should be kept in the ringbuffer?</span>

<span class="sd">        :param max_size: Max entries of error messages in the ringbuffer.</span>
<span class="sd">        :type max_size: int</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ringbuffer_error_max_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_size</span><span class="p">)</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.set_ringbuffer_result_max_size">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.set_ringbuffer_result_max_size">[docs]</a>
    <span class="k">def</span> <span class="nf">set_ringbuffer_result_max_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_size</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        How many result messages should be kept in the ringbuffer?</span>

<span class="sd">        :param max_size: Max entries of result messages in the ringbuffer.</span>
<span class="sd">        :type max_size: int</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ringbuffer_result_max_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_size</span><span class="p">)</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.is_socket_ready">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.is_socket_ready">[docs]</a>
    <span class="k">def</span> <span class="nf">is_socket_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set `socket_is_ready` for a specific stream to False.</span>

<span class="sd">        :param stream_id: id of the stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.is_socket_ready(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">)</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_debug_log</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket_is_ready</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.set_socket_is_not_ready">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.set_socket_is_not_ready">[docs]</a>
    <span class="k">def</span> <span class="nf">set_socket_is_not_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set `socket_is_ready` for a specific stream to False.</span>

<span class="sd">        :param stream_id: id of the stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.set_socket_is_not_ready(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">)</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_debug_log</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">socket_is_ready</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.set_socket_is_ready">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.set_socket_is_ready">[docs]</a>
    <span class="k">def</span> <span class="nf">set_socket_is_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set `socket_is_ready` for a specific stream to True.</span>

<span class="sd">        :param stream_id: id of the stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.set_socket_is_ready(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">)</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_debug_log</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">socket_is_ready</span><span class="p">[</span><span class="n">stream_id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.set_stream_label">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.set_stream_label">[docs]</a>
    <span class="k">def</span> <span class="nf">set_stream_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">,</span> <span class="n">stream_label</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a stream_label by stream_id</span>

<span class="sd">        :param stream_id: id of the stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :param stream_label: stream_label to set</span>
<span class="sd">        :type stream_label: str</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.set_stream_label() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;stream_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stream_label</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.set_stream_label() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.set_keep_max_received_last_second_entries">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.set_keep_max_received_last_second_entries">[docs]</a>
    <span class="k">def</span> <span class="nf">set_keep_max_received_last_second_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number_of_max_entries</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set how much received_last_second entries are stored till they get deleted!</span>

<span class="sd">        :param number_of_max_entries: number of entries to keep in list</span>
<span class="sd">        :type number_of_max_entries: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keep_max_received_last_second_entries</span> <span class="o">=</span> <span class="n">number_of_max_entries</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.split_payload">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.split_payload">[docs]</a>
    <span class="k">def</span> <span class="nf">split_payload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">max_items_per_request</span><span class="o">=</span><span class="mi">350</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sending more than 8000 chars via websocket.send() leads to a connection loss, 350 list elements is a good limit</span>
<span class="sd">        to keep the payload length under 8000 chars and avoid reconnects</span>

<span class="sd">        :param params: params of subscribe payload</span>
<span class="sd">        :type params: list</span>
<span class="sd">        :param method: SUBSCRIBE or UNSUBSCRIBE</span>
<span class="sd">        :type method: str</span>
<span class="sd">        :param max_items_per_request: max size for params, if more it gets split</span>
<span class="sd">        :return: list or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_exchange_type</span><span class="p">(</span><span class="s1">&#39;cex&#39;</span><span class="p">):</span>
            <span class="n">count_items</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">add_params</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="n">add_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
                <span class="n">count_items</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">count_items</span> <span class="o">&gt;</span> <span class="n">max_items_per_request</span><span class="p">:</span>
                    <span class="n">add_payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
                                   <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">add_params</span><span class="p">,</span>
                                   <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_request_id</span><span class="p">()}</span>
                    <span class="n">payload</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add_payload</span><span class="p">)</span>
                    <span class="n">count_items</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">add_params</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">add_params</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">add_payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
                               <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">add_params</span><span class="p">,</span>
                               <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_request_id</span><span class="p">()}</span>
                <span class="n">payload</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add_payload</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">payload</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.split_payload() CEX result is None!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_exchange_type</span><span class="p">(</span><span class="s1">&#39;dex&#39;</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.split_payload() DEX result is None! (Dev: Todo!)&quot;</span><span class="p">)</span>
            <span class="c1"># Todo:</span>
            <span class="c1">#  return None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.split_payload() result is None!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.start_monitoring_api">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.start_monitoring_api">[docs]</a>
    <span class="k">def</span> <span class="nf">start_monitoring_api</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">64201</span><span class="p">,</span> <span class="n">warn_on_update</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start the monitoring API server</span>

<span class="sd">        Take a look into the</span>
<span class="sd">        `Wiki &lt;https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api/wiki/UNICORN-Monitoring-API-Service&gt;`_</span>
<span class="sd">        to see how this works!</span>

<span class="sd">        :param host: listening ip address, use 0.0.0.0 or a specific address (default: 127.0.0.1)</span>
<span class="sd">        :type host: str</span>
<span class="sd">        :param port: listening port number (default: 64201)</span>
<span class="sd">        :type port: int</span>
<span class="sd">        :param warn_on_update: set to `False` to disable the update warning</span>
<span class="sd">        :type warn_on_update: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_monitoring_api_thread</span><span class="p">,</span>
                                  <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">warn_on_update</span><span class="p">),</span>
                                  <span class="n">name</span><span class="o">=</span><span class="s2">&quot;monitoring_api&quot;</span><span class="p">)</span>
        <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.stop_manager">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.stop_manager">[docs]</a>
    <span class="k">def</span> <span class="nf">stop_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">close_api_session</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop the BinanceWebSocketApiManager with all streams, monitoring and management threads</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.stop_manager() - Stopping &quot;</span>
                    <span class="s2">&quot;unicorn_binance_websocket_api_manager &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">+</span> <span class="s2">&quot; ...&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_manager_request</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="c1"># send signal to all threads</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop_manager_request</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.stop_manager() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
                    <span class="n">stream_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.stop_manager() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">stream_id</span> <span class="ow">in</span> <span class="n">stream_list</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">stop_stream</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.stop_manager() - AttributeError: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># stop monitoring API services</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop_monitoring_api</span><span class="p">()</span>
            <span class="c1"># stop restclient</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span> <span class="ow">in</span> <span class="n">CONNECTION_SETTINGS</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">restclient</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restclient</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;stop_manager() - AttributeError: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># close lucit license manger and the api session</span>
            <span class="k">if</span> <span class="n">close_api_session</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">llm</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.stop_manager_with_all_streams">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.stop_manager_with_all_streams">[docs]</a>
    <span class="k">def</span> <span class="nf">stop_manager_with_all_streams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">close_api_session</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop the BinanceWebSocketApiManager with all streams, monitoring and management threads</span>

<span class="sd">        Alias of &#39;stop_manager()&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;BinanceWebSocketApiManager.stop_manager_with_all_streams() - Stopping &quot;</span>
                    <span class="s2">&quot;unicorn_binance_websocket_api_manager &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">+</span> <span class="s2">&quot; ...&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stop_manager</span><span class="p">(</span><span class="n">close_api_session</span><span class="o">=</span><span class="n">close_api_session</span><span class="p">)</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.stop_monitoring_api">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.stop_monitoring_api">[docs]</a>
    <span class="k">def</span> <span class="nf">stop_monitoring_api</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop the monitoring API service</span>

<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitoring_api_server</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">monitoring_api_server</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.stop_stream">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.stop_stream">[docs]</a>
    <span class="k">def</span> <span class="nf">stop_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">,</span> <span class="n">delete_listen_key</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop a specific stream</span>

<span class="sd">        :param stream_id: id of a stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :param delete_listen_key: If set to `True` (default), the `listen_key` gets deleted. Set to `False` if you run</span>
<span class="sd">                                  more than one userData stream with this `listen_key`!</span>
<span class="sd">        :type delete_listen_key: str</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># stop a specific stream by stream_id</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.stop_stream(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">)</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_debug_log</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.stop_stream() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;stop_request&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.stop_stream() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">delete_listen_key</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange_type</span> <span class="o">!=</span> <span class="s2">&quot;dex&quot;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">delete_listen_key_by_stream_id</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ReadTimeout</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.stop_stream() - Not able to delete listen_key - &quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;requests.exceptions.ReadTimeout: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.stop_stream() - Not able to delete listen_key - &quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;requests.exceptions.ConnectionError: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>


    <span class="k">def</span> <span class="nf">_crash_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">,</span> <span class="n">error_msg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loop inside: Stop a specific stream with &#39;crashed&#39; status</span>

<span class="sd">        :param stream_id: id of a stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :param error_msg: Reason</span>
<span class="sd">        :type error_msg: str</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># stop a specific stream by stream_id</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._crash_stream(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">)</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_debug_log</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._crash_stream() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;crash_request&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;crash_request_reason&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">error_msg</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._crash_stream() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_stream_is_crashing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If a stream can not heal itself in cause of wrong parameter (wrong market, channel type) it calls this method</span>

<span class="sd">        :param stream_id: id of a stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :param error_msg: Error msg to add to the stream status!</span>
<span class="sd">        :type error_msg: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._stream_is_crashing(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">)</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_debug_log</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_stop_request</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._stream_is_crashing() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;has_stopped&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;crashed&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._stream_is_crashing() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_socket_is_ready</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">error_msg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._stream_is_crashing() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._stream_is_crashing() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;crash_request_reason&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">error_msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;crash_request_reason&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_stream_signal</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">signal_type</span><span class="o">=</span><span class="s2">&quot;STREAM_UNREPAIRABLE&quot;</span><span class="p">,</span> <span class="n">error_msg</span><span class="o">=</span><span class="n">error_msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_stream_is_restarting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">,</span> <span class="n">error_msg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Streams report with this call their restarts</span>

<span class="sd">        :param stream_id: id of a stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._stream_is_restarting(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">) - error_msg: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2"> - &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_debug_log</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._stream_is_restarting() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;restarting&quot;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._stream_is_restarting() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_stream_is_stopping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Streams report with this call their shutdowns</span>

<span class="sd">        :param stream_id: id of a stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._stream_is_stopping(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">)</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_debug_log</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._stream_is_stopping() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;has_stopped&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;stopped&quot;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager._stream_is_stopping() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_stream_signal</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">signal_type</span><span class="o">=</span><span class="s2">&quot;STOP&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

<div class="viewcode-block" id="BinanceWebSocketApiManager.subscribe_to_stream">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.subscribe_to_stream">[docs]</a>
    <span class="k">def</span> <span class="nf">subscribe_to_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">markets</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subscribe channels and/or markets to an existing stream</span>

<span class="sd">        If you provide one channel and one market, then every subscribed market is going to get added to the new channel</span>
<span class="sd">        and all subscribed channels are going to get added to the new market!</span>

<span class="sd">        `How are the parameter `channels` and `markets` used with</span>
<span class="sd">        `subscriptions &lt;https://unicorn-binance-websocket-api.docs.lucit.tech/unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.create_stream&gt;`_</span>

<span class="sd">        :param stream_id: id of a stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :param channels: provide the channels you wish to subscribe</span>
<span class="sd">        :type channels: str, tuple, list, set</span>
<span class="sd">        :param markets: provide the markets you wish to subscribe</span>
<span class="sd">        :type markets: str, tuple, list, set</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.subscribe_to_stream(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">+</span>
                    <span class="sa">f</span><span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;)</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_debug_log</span><span class="p">()</span><span class="si">}</span><span class="s2"> - started ... -&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">stream_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.subscribe_to_stream() - Info: `stream_id` is missing!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">channels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">channels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">channels</span> <span class="o">=</span> <span class="p">[</span><span class="n">channels</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">set</span><span class="p">:</span>
                <span class="n">channels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">markets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">markets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">markets</span> <span class="o">=</span> <span class="p">[</span><span class="n">markets</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">set</span><span class="p">:</span>
                <span class="n">markets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.subscribe_to_stream() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">]]</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.subscribe_to_stream() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">set</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.subscribe_to_stream() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">])</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.subscribe_to_stream() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;markets&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.subscribe_to_stream() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;markets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;markets&#39;</span><span class="p">]]</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.subscribe_to_stream() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;markets&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">set</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.subscribe_to_stream() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;markets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;markets&#39;</span><span class="p">])</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.subscribe_to_stream() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.subscribe_to_stream() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">channels</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.subscribe_to_stream() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="n">markets_new</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">market</span> <span class="ow">in</span> <span class="n">markets</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;!&quot;</span> <span class="ow">in</span> <span class="n">market</span> \
                    <span class="ow">or</span> <span class="n">market</span> <span class="o">==</span> <span class="s2">&quot;allMiniTickers&quot;</span> \
                    <span class="ow">or</span> <span class="n">market</span> <span class="o">==</span> <span class="s2">&quot;allTickers&quot;</span> \
                    <span class="ow">or</span> <span class="n">market</span> <span class="o">==</span> <span class="s2">&quot;blockheight&quot;</span> \
                    <span class="ow">or</span> <span class="n">market</span> <span class="o">==</span> <span class="s2">&quot;$all&quot;</span><span class="p">:</span>
                <span class="n">markets_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">market</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_exchange_type</span><span class="p">(</span><span class="s1">&#39;dex&#39;</span><span class="p">):</span>
                    <span class="n">markets_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">market</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_exchange_type</span><span class="p">(</span><span class="s1">&#39;cex&#39;</span><span class="p">):</span>
                    <span class="n">markets_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">market</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.subscribe_to_stream() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;markets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;markets&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">markets_new</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.subscribe_to_stream() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_payload</span><span class="p">(</span><span class="n">stream_id</span><span class="p">,</span> <span class="s2">&quot;subscribe&quot;</span><span class="p">,</span>
                                      <span class="n">channels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">],</span>
                                      <span class="n">markets</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;markets&#39;</span><span class="p">])</span>
        <span class="n">subscriptions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_subscriptions</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.subscribe_to_stream() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;subscriptions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subscriptions</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.subscribe_to_stream() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="c1"># control subscription limit:</span>
        <span class="c1"># https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api/wiki/Binance-websocket-endpoint-configuration-overview</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;subscriptions&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_subscriptions_per_stream</span><span class="p">:</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The limit of </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_subscriptions_per_stream</span><span class="p">)</span><span class="si">}</span><span class="s2"> subscriptions per stream has been &quot;</span>
                         <span class="sa">f</span><span class="s2">&quot;exceeded!&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.subscribe_to_stream(</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span><span class="si">}</span><span class="s2">) - Info: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_crash_stream</span><span class="p">(</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">error_msg</span><span class="o">=</span><span class="n">error_msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">payload</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.subscribe_to_stream(</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span><span class="si">}</span><span class="s2">) - Info: Payload is None!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">payload</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_stream</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">item</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_payload_to_stream</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.subscribe_to_stream(</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span><span class="si">}</span><span class="s2">, &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span><span class="si">}</span><span class="s2">) finished ...&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.subscribe_to_stream(</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span><span class="si">}</span><span class="s2">) - TypeError - &quot;</span>
                         <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.unsubscribe_from_stream">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.unsubscribe_from_stream">[docs]</a>
    <span class="k">def</span> <span class="nf">unsubscribe_from_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">markets</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unsubscribe channels and/or markets to an existing stream</span>

<span class="sd">        If you provide one channel and one market, then all subscribed markets from the specific channel and all</span>
<span class="sd">        subscribed channels from the specific markets are going to be removed!</span>

<span class="sd">        `How are the parameter `channels` and `markets` used with</span>
<span class="sd">        `subscriptions &lt;https://unicorn-binance-websocket-api.docs.lucit.tech/unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.create_stream&gt;`_</span>

<span class="sd">        :param stream_id: id of a stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :param channels: provide the channels you wish to unsubscribe</span>
<span class="sd">        :type channels: str, tuple, list, set</span>
<span class="sd">        :param markets: provide the markets you wish to unsubscribe</span>
<span class="sd">        :type markets: str, tuple, list, set</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.unsubscribe_from_stream(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">+</span>
                    <span class="sa">f</span><span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;)</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_debug_log</span><span class="p">()</span><span class="si">}</span><span class="s2"> - started ... -&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">stream_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.unsubscribe_from_stream() - Info: `stream_id` is missing!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">markets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">markets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">channels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">channels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">channels</span> <span class="o">=</span> <span class="p">[</span><span class="n">channels</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">markets</span> <span class="o">=</span> <span class="p">[</span><span class="n">markets</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.unsubscribe_from_stream() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">]]</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.unsubscribe_from_stream() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;markets&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.unsubscribe_from_stream() - `stream_list_lock` was entered!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;markets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;markets&#39;</span><span class="p">]]</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.unsubscribe_from_stream() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.unsubscribe_from_stream() - `stream_list_lock` was &quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;entered!&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.unsubscribe_from_stream() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">markets</span><span class="p">)):</span>
            <span class="n">markets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">markets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">market</span> <span class="ow">in</span> <span class="n">markets</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[a-zA-Z0-9]{41,43}&#39;</span><span class="p">,</span> <span class="n">market</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.unsubscribe_from_stream() - `stream_list_lock` was &quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot;entered!&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;markets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">market</span><span class="p">)</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.unsubscribe_from_stream() - Leaving &quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot;`stream_list_lock`!&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">pass</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_payload</span><span class="p">(</span><span class="n">stream_id</span><span class="p">,</span> <span class="s2">&quot;unsubscribe&quot;</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="n">channels</span><span class="p">,</span> <span class="n">markets</span><span class="o">=</span><span class="n">markets</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">payload</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.unsubscribe_from_stream(</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span><span class="si">}</span><span class="s2">) - Info: Payload is None!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">payload</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_with_stream</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">item</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_payload_to_stream</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
            <span class="n">subscriptions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_subscriptions</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list_lock</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.unsubscribe_from_stream() - `stream_list_lock` was &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;entered!&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;subscriptions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subscriptions</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.unsubscribe_from_stream() - Leaving `stream_list_lock`!&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.unsubscribe_from_stream(</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span><span class="si">}</span><span class="s2">, &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">markets</span><span class="p">)</span><span class="si">}</span><span class="s2">) finished ...&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">error_msg</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.unsubscribe_from_stream(</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span><span class="si">}</span><span class="s2">) - TypeError - &quot;</span>
                         <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.wait_till_stream_has_started">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.wait_till_stream_has_started">[docs]</a>
    <span class="k">def</span> <span class="nf">wait_till_stream_has_started</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns `True` as soon a specific stream has started and received its first stream data</span>

<span class="sd">        :param stream_id: id of a stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :param timeout: The timeout for how long to wait for the stream to stop. The function aborts if the waiting</span>
<span class="sd">                        time is exceeded and returns False.</span>
<span class="sd">        :type timeout: float</span>

<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timestamp_unix</span><span class="p">()</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="n">timestamp</span> <span class="o">+</span> <span class="n">timeout</span> <span class="k">if</span> <span class="n">timeout</span> <span class="o">!=</span> <span class="mf">0.0</span> <span class="k">else</span> <span class="n">timeout</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.wait_till_stream_has_started(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">) with timeout </span><span class="si">{</span><span class="n">timeout</span><span class="si">}</span><span class="s2"> &quot;</span>
                     <span class="sa">f</span><span class="s2">&quot;started!&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;last_heartbeat&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timestamp_unix</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">timeout</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.wait_till_stream_has_started(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">) finished with `False`!&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.wait_till_stream_has_started(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">) finished with `True`!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.wait_till_stream_has_started(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">) finished with `False`!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="BinanceWebSocketApiManager.wait_till_stream_has_stopped">
<a class="viewcode-back" href="../../unicorn_binance_websocket_api.html#unicorn_binance_websocket_api.manager.BinanceWebSocketApiManager.wait_till_stream_has_stopped">[docs]</a>
    <span class="k">def</span> <span class="nf">wait_till_stream_has_stopped</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns `True` as soon a specific stream has stopped itself</span>

<span class="sd">        :param stream_id: id of a stream</span>
<span class="sd">        :type stream_id: str</span>
<span class="sd">        :param timeout: The timeout for how long to wait for the stream to stop. The function aborts if the waiting</span>
<span class="sd">                        time is exceeded and returns False.</span>
<span class="sd">        :type timeout: float</span>

<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timestamp_unix</span><span class="p">()</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="n">timestamp</span> <span class="o">+</span> <span class="n">timeout</span> <span class="k">if</span> <span class="n">timeout</span> <span class="o">!=</span> <span class="mf">0.0</span> <span class="k">else</span> <span class="n">timeout</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.wait_till_stream_has_stopped(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">) with timeout </span><span class="si">{</span><span class="n">timeout</span><span class="si">}</span><span class="s2"> &quot;</span>
                     <span class="sa">f</span><span class="s2">&quot;started!&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;stopped&quot;</span> \
                    <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">[</span><span class="n">stream_id</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;crashed&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timestamp_unix</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">timeout</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.wait_till_stream_has_stopped(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">) finished with `False`!&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.wait_till_stream_has_stopped(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">) finished with `False`!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BinanceWebSocketApiManager.wait_till_stream_has_stopped(</span><span class="si">{</span><span class="n">stream_id</span><span class="si">}</span><span class="s2">) finished with `True`!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>
</div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo">
                <div style="text-align: center;">
                    <a href="https://www.lucit.tech"><img src="https://www.lucit.tech/files/images/logos/LUCIT-LOGO.png"></a><br>
                    <a href="https://shop.lucit.services/software/unicorn-binance-suite" style="font-size: 0.85em;font-weight: 900">Get a UNICORN Binance Suite License!</a><br>
                    <br>
                    <a href="https://github.com/LUCIT-Systems-and-Development" target="_blank" style="text-decoration:none;"><img src="../../_static/icons8-github-20.png"></a>
                    <a href="https://fb.me/lucit.systems.and.development" target="_blank" style="text-decoration:none;"><img src="../../_static/icons8-facebook-20.png"></a>
                    <a href="https://twitter.com/LUCIT_SysDev" target="_blank" style="text-decoration:none;"><img src="../../_static/icons8-twitter-20.png"></a>
                    <a href="https://www.linkedin.com/company/lucit-systems-and-development" target="_blank" style="text-decoration:none;"><img src="../../_static/icons8-linkedin-20.png"></a>
                    <a href="https://www.xing.com/pages/lucit-systems-and-development" target="_blank" style="text-decoration:none;"><img src="../../_static/icons8-xing-20.png"></a>
                    <a href="https://medium.lucit.tech" target="_blank" style="text-decoration:none;"><img src="../../_static/icons8-medium-monogram-20.png"></a>
                    <a href="https://www.youtube.com/channel/UCp57u8vaPqEWQTlfpYn-KnQ" target="_blank" style="text-decoration:none;"><img src="../../_static/icons8-youtube-20.png"></a>
                </div>
            </p>
<div id="searchbox" style="display: block" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<div role="note" aria-label="source code">
    <h3>GitHub</h3>
    <ul class="this-page-menu">
      <li><a href="https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api">Show Source</a></li>
      
<li>
<a class="github-button" href="https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api"
   data-icon="octicon-star" data-show-count="true"
   aria-label="Star LUCIT-Systems-and-Development/unicorn-binance-websocket-api on GitHub">Star</a>
<br />
<a class="github-button" href="https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api/subscription"
   data-icon="octicon-eye" data-show-count="true"
   aria-label="Watch LUCIT-Systems-and-Development/unicorn-binance-websocket-api on GitHub">Watch</a>
<br />
<a class="github-button" href="https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api/fork"
   data-icon="octicon-repo-forked" data-show-count="true"
   aria-label="Fork LUCIT-Systems-and-Development/unicorn-binance-websocket-api on GitHub">Fork</a>
<br />
<a class="github-button" href="https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api/issues"
   data-icon="octicon-issue-opened"
   data-show-count="true" aria-label="Issue LUCIT-Systems-and-Development/unicorn-binance-websocket-api on GitHub">Issue</a>
    
</li>

    </ul>
</div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
              
                  
                  
              <li><img src="../../_static/lucit.png" alt="LUCIT Logo"
                       style="vertical-align: middle; margin-top: -1px"/></li>
              <li><a href="https://docs.lucit.tech">Docs Index</a> | </li>
              <li><a href="https://www.lucit.tech/unicorn-binance-websocket-api.html">unicorn-binance-websocket-api</a> &#187;</li>
                  
              
              
              <a href="../../index.html">Docs</a> &#187;
              
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">unicorn_binance_websocket_api.manager</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../../search.html" method="get">
          <input placeholder="Quick search" aria-label="Quick search" type="text" name="q" />
          <input type="submit" value="Go" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
                     |
                </li>
            
      </ul>
    </div>  
    <div class="footer">
    <a href="https://docs.lucit.tech">Index of all LUCIT Software Documentation</a><br />
    &copy; <a href="/license.html">Copyright</a> 2023-2023, LUCIT Systems and Development. All Rights Reserved..
    See <a href="/license.html">License</a> for more information.<br />
    Last updated on May 11 2024 at 16:55 (CET).
    <a href="https://github.com/LUCIT-Systems-and-Development/unicorn-binance-websocket-api/issues/new/choose">Found a bug</a>?
    <br />
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
        with <a href="https://github.com/LUCIT-Systems-and-Development/python-docs-theme-lucit">python-docs-theme-lucit</a>
        by <a href="https://www.lucit.tech">LUCIT Systems and Development</a>.
    </div>
    
    <img referrerpolicy="no-referrer-when-downgrade" src="https://webmon.lucit.services/matomo.php?idsite=3&amp;rec=1" style="border:0" alt="" />
    

  </body>
</html>